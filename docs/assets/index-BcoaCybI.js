(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function jo(t){return Math.random().toString(36).substr(2,t)}function oi(t){return new Promise(e=>setTimeout(e,t))}function Ho(t){return t.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}const Vi=class Vi{constructor(){this.removable=!0,this.highlight=()=>{},this.id=jo(6),this.remove=this.moveUp=this.moveDown=function(e){}}newBlockDiv(e,n){const i=this.constructor.type,r=document.createElement("div");e.appendChild(r),r.classList.add("container"),r.classList.add("row"),r.classList.add("block-element"),r.classList.add(`block-${i}`),r.setAttribute("id",this.id);let s=0;this.highlight=()=>{clearTimeout(s);const h="border-primary";r.classList.add(h),s=setTimeout(()=>{r.classList.remove(h)},1e3)};const o=document.createElement("div");if(r.appendChild(o),o.classList.add("col-1"),o.classList.add("left-controls"),o.style.paddingLeft="5px",this.removable){const h=document.createElement("i");o.appendChild(h),h.classList.add("bi"),h.classList.add("bi-chevron-up"),h.classList.add("bi-tiny"),h.classList.add("block-control"),h.style.display="inline-block",h.setAttribute("hover-color","cornflowerblue"),h.addEventListener("click",async()=>{await this.moveUp(this);const f=r.previousSibling;f&&e.insertBefore(r,f)});const p=document.createElement("i");o.appendChild(p),p.classList.add("bi"),p.classList.add("bi-chevron-down"),p.classList.add("bi-tiny"),p.classList.add("block-control"),p.style.display="inline-block",p.setAttribute("hover-color","cornflowerblue"),p.addEventListener("click",async()=>{await this.moveDown(this);const f=r.nextSibling;f&&e.insertBefore(f,r)})}const a=document.createElement("div");r.appendChild(a),a.classList.add("col");const c=document.createElement("div");a.appendChild(c),c.classList.add("row"),c.classList.add("g-0"),c.classList.add("p-0"),c.classList.add("align-items-center");const l=document.createElement("div");c.appendChild(l),l.classList.add("col-1"),l.classList.add("block-title"),l.innerHTML=`<strong>${n.title}</strong>`;for(let h=1;h<=4;h++){const p=document.createElement("div");c.appendChild(p),h===2?p.classList.add("col"):p.classList.add("col-2"),p.innerHTML=n[`col_${h}`]||""}const u=document.createElement("div");if(r.appendChild(u),u.classList.add("col-1"),u.classList.add("right-controls"),this.removable){const h=document.createElement("i");u.appendChild(h),h.classList.add("bi"),h.classList.add("bi-trash"),h.classList.add("bi-tiny"),h.classList.add("block-control"),h.style.display="inline-block",h.setAttribute("hover-color","red"),h.addEventListener("click",()=>{this.removable&&(this.remove(this),r.remove())})}const d=r.getElementsByClassName("block-control");return r.addEventListener("mouseenter",()=>{[...d].forEach(h=>{h.style.color=h.getAttribute("hover-color")||""})}),r.addEventListener("mouseleave",()=>{[...d].forEach(h=>h.style.color="white")}),a}getOpts(){return{}}queryString(){return""}};Vi.type="";let ot=Vi;const ai={linear:t=>{const{thisClick:e,totalClicks:n,initialTempo:i,finalTempo:r}=t,s=n/(i+(r-i)/2),o=(r-i)/2/s,a=i,c=-e;return(-a+Math.sqrt(a**2-4*o*c))/(2*o)},quadratic:t=>{const{thisClick:e,totalClicks:n,initialTempo:i,finalTempo:r}=t,s=(r-i)/n;return Math.abs(s)<1e-15?e/i:Math.log(1+e*s/i)/s},squareRoot:t=>{const{thisClick:e,totalClicks:n,initialTempo:i,finalTempo:r}=t;if(Math.abs(r-i)<1e-15)return e/i;const s=3*n/(i+2*r),o=i,a=2/3*(r-i)/Math.sqrt(s);let c=e/i;for(let l=0;l<50;l++){const u=Math.sqrt(c),d=o*c+a*c*u-e,h=o+1.5*a*u,p=c-d/h;if(Math.abs(p-c)<1e-12)break;c=p}return c},cosine:t=>{const{thisClick:e,totalClicks:n,initialTempo:i,finalTempo:r}=t;if(Math.abs(r-i)<1e-15)return e/i;const s=2*n/(i+r),o=(i+r)/2,a=(r-i)*s/(2*Math.PI);let c=e/o;for(let l=0;l<50;l++){const u=Math.sin(Math.PI*c/s),d=Math.cos(Math.PI*c/s),h=o*c-a*u-e,p=o-(r-i)/2*d,f=c-h/p;if(Math.abs(f-c)<1e-12)break;c=f}return c},circular:t=>{const{thisClick:e,totalClicks:n,initialTempo:i,finalTempo:r}=t,s=1;if(Math.abs(r-i)<1e-15)return e/i;const o=h=>{if(h<=.5)return Math.sqrt(h*(1-h));{const p=2*h-1;return .5+.5*(1-Math.sqrt(1-p*p))}},a=h=>(1-s)*h+s*o(h),c=h=>i+(r-i)*a(h),l=2*n/(i+r),u=h=>{const f=h/100;let v=c(0);for(let S=1;S<100;S++)v+=(S%2===0?2:4)*c(S*f);return v+=c(h),l*(f/3)*v};let d=e/n;for(let h=0;h<50;h++){const f=u(d)-e,v=l*c(d),S=d-f/v;if(Math.abs(S-d)<1e-12)break;d=Math.max(0,Math.min(1,S))}return d*l}},$i=class $i extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Accelerando",col_1:(()=>{let r=`
          <div class="container">
            <div class="row-col input-group">
              <select class="form-select" id="${this.id}-accel-kind">`;for(const s in ai)r+=`<option value="${s}">${Ho(s)}</option>`;return r+=`
              </select>
            </div>
          </div>`,r})()});const i=document.getElementById(`${this.id}-accel-kind`);i.value=n.kind in ai?n.kind:"linear",this.kind=()=>i.value}*clickIntervalGen(e,n){n.accel.start(this.kind())}queryString(){return`kind:${this.kind()}`}};$i.type="accelerando";let Re=$i;class Yi{constructor(e,n,i,r){this.value=n;const s=document.createElement("div");this.buttonDiv=s,s.classList.add("col"),s.classList.add("pattern-btn");const o=document.createElement("div");s.appendChild(o),o.classList.add("btn"),o.classList.add("pattern-level"),o.classList.add(`pattern-level-${n}`),o.classList.add("d-flex"),o.classList.add("align-items-center"),o.classList.add("justify-content-center"),o.innerText=`${i+1}`,o.id=`${e}-${i}`,r.insertBefore(s,r.children[r.children.length-1]);const a=document.createElement("div");this.startDiv=a,s.appendChild(a),a.classList.add("start-beat"),o.addEventListener("click",()=>{this.value=(this.value+1)%4;for(let c=0;c<5;c++)c===this.value?o.classList.add(`pattern-level-${this.value}`):o.classList.remove(`pattern-level-${c}`);o.dispatchEvent(new CustomEvent("input",{bubbles:!0}))})}setStartBeat(e){this.startDiv.innerText=e?"start":""}remove(){this.buttonDiv.remove()}}class Ko{constructor(e,n){this.patternBlock=document.getElementById(e),this.patterns=n.initial.map((i,r)=>new Yi(e,i,r,this.patternBlock)),this.name=e,this.setStartBeat(n.start||1)}values(){return this.patterns.map(e=>e.value)}setBeatCount(e){for(;e<this.patterns.length;)this.patterns.pop()?.remove();for(;e>this.patterns.length;)this.patterns.push(new Yi(this.name,2,this.patterns.length,this.patternBlock))}setStartBeat(e){const n=e-1;for(let i=0;i<this.patterns.length;i++)this.patterns[i].setStartBeat(i===n)}}var A=(t=>(t.UNKNOWN="unknown",t.RECORDING="recording",t.STOPPED="stopped",t.PLAYING="playing",t))(A||{});class Xo{constructor(){this.recordIcon=document.getElementById("record"),this.recordingIcon=document.getElementById("recording"),this.playIcon=document.getElementById("play"),this.playingIcon=document.getElementById("playing"),this.state=A.STOPPED,this.nextState=A.RECORDING,this.offCanvass=!1,this.showControls([this.recordIcon])}initializeEventListeners(e){this.recordIcon?.addEventListener("click",e.record.bind(this)),this.recordingIcon?.addEventListener("click",e.stopRecording.bind(this)),this.playIcon?.addEventListener("click",e.play.bind(this)),this.playingIcon?.addEventListener("click",e.stopPlaying.bind(this)),document.addEventListener("keydown",n=>{if(!this.offCanvass){if(n.key===" ")n.preventDefault(),this.state===A.RECORDING?e.stopRecording():this.state===A.PLAYING?e.stopPlaying():this.state===A.STOPPED&&(this.nextState===A.RECORDING?e.record():this.nextState===A.PLAYING&&e.play());else if(n.key==="Enter"){const i=document.activeElement;i.role==="switch"?i.click():i.blur()}}}),document.addEventListener("hidden.bs.offcanvas",()=>{this.offCanvass=!1}),document.addEventListener("shown.bs.offcanvas",()=>{this.offCanvass=!0})}markRecording(){this.setState(A.RECORDING)}markPlaying(){this.setState(A.PLAYING)}markStopped(){this.setState(A.STOPPED)}reset(){this.setState(A.UNKNOWN)}setState(e){e===A.RECORDING?(this.showControls([this.recordingIcon]),this.state=A.RECORDING,this.nextState=A.STOPPED):e===A.STOPPED?(this.nextState=this.state===A.RECORDING?A.PLAYING:A.RECORDING,this.showControls([this.playIcon,this.recordIcon]),this.state=A.STOPPED):e===A.PLAYING?(this.showControls([this.playingIcon]),this.state=A.PLAYING,this.nextState=A.STOPPED):e==A.UNKNOWN&&(this.showControls([this.recordIcon]),this.state=A.STOPPED,this.nextState=A.RECORDING)}showControls(e){[this.recordIcon,this.recordingIcon,this.playIcon,this.playingIcon].forEach(n=>{n&&(n.style.display=e.includes(n)?"inline-block":"none")})}}function Yo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Nn={exports:{}},Zi;function Zo(){return Zi||(Zi=1,(function(t){var e=(function(){var n=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return i.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(i,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,h=l.length;d<h;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var h=[];return l.forEach(function(p){h.push(n(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return r.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(r,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var d,h,p={},f={},v="",S="",E="",T=2,g=3,b=2,w=[],m=0,y=0,_;for(_=0;_<c.length;_+=1)if(v=c.charAt(_),Object.prototype.hasOwnProperty.call(p,v)||(p[v]=g++,f[v]=!0),S=E+v,Object.prototype.hasOwnProperty.call(p,S))E=S;else{if(Object.prototype.hasOwnProperty.call(f,E)){if(E.charCodeAt(0)<256){for(d=0;d<b;d++)m=m<<1,y==l-1?(y=0,w.push(u(m)),m=0):y++;for(h=E.charCodeAt(0),d=0;d<8;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1}else{for(h=1,d=0;d<b;d++)m=m<<1|h,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1}T--,T==0&&(T=Math.pow(2,b),b++),delete f[E]}else for(h=p[E],d=0;d<b;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1;T--,T==0&&(T=Math.pow(2,b),b++),p[S]=g++,E=String(v)}if(E!==""){if(Object.prototype.hasOwnProperty.call(f,E)){if(E.charCodeAt(0)<256){for(d=0;d<b;d++)m=m<<1,y==l-1?(y=0,w.push(u(m)),m=0):y++;for(h=E.charCodeAt(0),d=0;d<8;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1}else{for(h=1,d=0;d<b;d++)m=m<<1|h,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1}T--,T==0&&(T=Math.pow(2,b),b++),delete f[E]}else for(h=p[E],d=0;d<b;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1;T--,T==0&&(T=Math.pow(2,b),b++)}for(h=2,d=0;d<b;d++)m=m<<1|h&1,y==l-1?(y=0,w.push(u(m)),m=0):y++,h=h>>1;for(;;)if(m=m<<1,y==l-1){w.push(u(m));break}else y++;return w.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],h=4,p=4,f=3,v="",S=[],E,T,g,b,w,m,y,_={val:u(0),position:l,index:1};for(E=0;E<3;E+=1)d[E]=E;for(g=0,w=Math.pow(2,2),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;switch(g){case 0:for(g=0,w=Math.pow(2,8),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;y=n(g);break;case 1:for(g=0,w=Math.pow(2,16),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;y=n(g);break;case 2:return""}for(d[3]=y,T=y,S.push(y);;){if(_.index>c)return"";for(g=0,w=Math.pow(2,f),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;switch(y=g){case 0:for(g=0,w=Math.pow(2,8),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;d[p++]=n(g),y=p-1,h--;break;case 1:for(g=0,w=Math.pow(2,16),m=1;m!=w;)b=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),g|=(b>0?1:0)*m,m<<=1;d[p++]=n(g),y=p-1,h--;break;case 2:return S.join("")}if(h==0&&(h=Math.pow(2,f),f++),d[y])v=d[y];else if(y===p)v=T+T.charAt(0);else return null;S.push(v),d[p++]=T+v.charAt(0),h--,T=v,h==0&&(h=Math.pow(2,f),f++)}}};return a})();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(Nn)),Nn.exports}var Ji=Zo();const yn=class yn{static getDecompressedParams(){const e=this.params.get(this.compressedKey);if(e){const n=Ji.decompressFromEncodedURIComponent(e);if(n)return new URLSearchParams(n)}return new URLSearchParams}static get(e){const n=this.getDecompressedParams();return n.has(e)?n.get(e):this.params.get(e)}static getAll(){const e=this.getDecompressedParams();return[...e.keys()].length>0?e.entries():this.params.entries()}static has(e){return this.getDecompressedParams().has(e)||this.params.has(e)}static set(e,n){this.params.set(e,n),this.updateURL()}static replace(e){this.params=e,this.updateURL()}static updateURL(){let e=`${window.location.pathname}?${this.params.toString()}`;if(e.length>2e3){const n=new URLSearchParams;n.set(this.compressedKey,Ji.compressToEncodedURIComponent(this.params.toString())),e=`${window.location.pathname}?${n.toString()}`}window.history.replaceState({},"",e)}};yn.compressedKey="c",yn.params=new URLSearchParams(window.location.search);let G=yn;class Jo{constructor(e,n){this.name=e,this.elem=document.getElementById(e),this.elem.addEventListener("click",()=>{this.setValue(this.elem.checked)}),this._value=!1;const i=G.get(e);i!==null?this.setValue(i==="true"):this.setValue(n?.initial||!1)}value(){return this._value}setValue(e){this._value=e,this.elem.checked!==e&&(this.elem.checked=e,this.elem.dispatchEvent(new Event("click"))),G.set(this.name,e.toString())}}function Xe(t,e){const n=new Jo(t,e);return n.value.bind(n)}class Qo{constructor(e,n){this.numerator=1,this.denominator=4,this._value=this.numerator/this.denominator,this.numerValueInput=null,this.denomValueInput=null,this.minusButtom=null,this.plusButton=null,this.numerator=n.initNum,this.denominator=n.initDen,this.numerName=`${e}-numer`,this.denomName=`${e}-denom`,G.has(this.numerName)&&G.has(this.denomName)&&(this.numerator=parseInt(G.get(this.numerName)),this.denominator=parseInt(G.get(this.denomName))),this.numerValueInput=document.getElementById(this.numerName),this.denomValueInput=document.getElementById(this.denomName),this.minusButtom=document.getElementById(`${e}-minus`),this.plusButton=document.getElementById(`${e}-plus`),this.numerValueInput?.addEventListener("change",this.setNumerator.bind(this)),this.denomValueInput?.addEventListener("change",this.setDenominator.bind(this)),this.minusButtom?.addEventListener("click",this.minus.bind(this)),this.plusButton?.addEventListener("click",this.plus.bind(this)),n.arrowKeys&&document.addEventListener("keydown",i=>{const r=document.activeElement;(r.tagName!=="INPUT"||r.role==="switch")&&(i.key==="ArrowRight"?(i.preventDefault(),this.plus()):i.key==="ArrowLeft"&&(i.preventDefault(),this.minus()))}),this.updateValueInput()}value(){return this._value}updateValueInput(){this.numerValueInput&&(this.numerValueInput.value=this.numerator.toString()),this.denomValueInput&&(this.denomValueInput.value=this.denominator.toString()),this._value=this.numerator/this.denominator,G.set(this.numerName,this.numerator.toString()),G.set(this.denomName,this.denominator.toString())}setNumerator(e){this.numerator=this.parseValue(e.target)||this.numerator,this.updateValueInput()}setDenominator(e){this.denominator=this.parseValue(e.target)||this.denominator,this.updateValueInput()}parseValue(e){if(!(e instanceof HTMLInputElement))return 0;const n=parseInt(e.value.trim(),10);return isNaN(n)||n<=0?0:n}minus(){this.numerator===1?this.denominator++:this.numerator--,this.updateValueInput()}plus(){this.denominator===1?this.numerator++:this.denominator--,this.updateValueInput()}}function ta(t,e){const n=new Qo(t,e);return n.value.bind(n)}class ea{constructor(e,n){this._value=0,this.valueInput=null,this.minusButton=null,this.plusButton=null,this.minValue=0,this.maxValue=0,this._value=n.initial,this.minValue=n.min,this.maxValue=n.max,this.valueInput=document.getElementById(`${e}-val`),this.minusButton=document.getElementById(`${e}-minus`),this.plusButton=document.getElementById(`${e}-plus`),this.valueInput?.addEventListener("change",this.setVal.bind(this)),this.minusButton?.addEventListener("click",this.minusVal.bind(this)),this.plusButton?.addEventListener("click",this.plusVal.bind(this)),this.valueInput?.addEventListener("keydown",i=>{i.key==="ArrowUp"?(i.preventDefault(),this.plusVal()):i.key==="ArrowDown"&&(i.preventDefault(),this.minusVal())}),this.updateValueInputs()}value(){return this._value}setVal(e){const n=this.parseValue(e.target);this._value=n!==null?n:this._value,this.updateValueInputs()}minusVal(){this._value--,this.updateValueInputs()}plusVal(){this._value++,this.updateValueInputs()}updateValueInputs(){this._value=Math.max(this.minValue,Math.min(this.maxValue,this._value)),this.valueInput&&(this.valueInput.value=this._value.toString(),this.valueInput.dispatchEvent(new CustomEvent("input",{bubbles:!0})))}parseValue(e){if(!(e instanceof HTMLInputElement))return console.error("Invalid target for input."),null;const n=parseInt(e.value.trim(),10);return isNaN(n)?(console.error("Value must be a valid integer."),null):n}}function vt(t,e){const n=new ea(t,e);return n.value.bind(n)}class na{constructor(e,n){if(this._value=0,this.min=0,this.max=10,this.step=.5,this.name="",this.labelText="",this.valueSuffix="",this.labelElement=null,this.slideInput=null,this.minusButton=null,this.plusButton=null,this._value=n.initial,G.has(e)&&(this._value=parseInt(G.get(e))),this.min=n.min,this.max=n.max,this.step=n.step,this.name=e,this.labelText=n.label||"",this.valueSuffix=n.valueSuffix||"",this.slideInput=document.getElementById(e),this.minusButton=document.getElementById(`${e}-minus`),this.plusButton=document.getElementById(`${e}-plus`),this.slideInput?.addEventListener("change",this.setVal.bind(this)),this.minusButton?.addEventListener("click",this.minusVal.bind(this)),this.plusButton?.addEventListener("click",this.plusVal.bind(this)),this.labelElement=document.getElementById(`${e}-label`),this.labelElement){this.labelText=this.labelText||this.labelElement.innerText;let i=this.setLabelText.bind(this);this.slideInput?.addEventListener("input",function(){i(this.value)})}this.updateSlideInput()}value(){return this._value}setVal(e){const n=this.parseValue(e.target);this._value=n!==null?n:this._value,this.updateSlideInput()}minusVal(){this._value-=this.step,this.updateSlideInput()}plusVal(){this._value+=this.step,this.updateSlideInput()}updateSlideInput(){this._value=Math.max(this.min,Math.min(this.max,this._value)),this.slideInput&&(this.slideInput.value=this._value.toString(),this.slideInput.dispatchEvent(new CustomEvent("input"))),this.setLabelText(this._value.toString()),G.set(this.name,this._value.toString())}setLabelText(e){this.labelElement&&(this.labelElement.innerText=`${this.labelText} (${e}${this.valueSuffix}):`)}parseValue(e){if(!(e instanceof HTMLInputElement))return console.error("Invalid target for input."),null;const n=parseFloat(e.value.trim());return isNaN(n)?(console.error("Value must be a valid float."),null):n}}function Kr(t,e){const n=new na(t,e);return n.value.bind(n)}const zi=class zi extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Beats",col_4:`
        <div class="container">
          <div class="row-col">
            Beats:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-beats-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-beats-val" value="0" pattern="[0-9]*">
            <button class="btn" id="${this.id}-beats-plus" type="button" tabindex="-1">+</button>
          </div>`}),this.count=vt(`${this.id}-beats`,{initial:n.count||0,min:0,max:256})}*clickIntervalGen(e,n){const i=function*(l){n.accel.enabled?n.accel.clicks.push(l):yield l};let{bpm:r,subdivisions:s,started:o,recording:a}=n;if(r===0||s===0)return;const c=60/r/s*1e3;for(let l=0;l<this.count();l++){const u=n.getLevel();yield*i({delay:c,level:u,started:o,recording:a});for(let d=0;d<s-1;d++)yield*i({delay:c,level:4,started:o,recording:a});n.beatIndex++}}getOpts(){return{count:this.count()}}queryString(){return`count:${this.count()}`}};zi.type="beats";let Le=zi;const Gi=class Gi extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Duration",col_4:`
        <div class="container">
          <div class="row-col">
            Seconds:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-duration-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-duration-val" value="0" pattern="[0-9]*">
            <button class="btn" id="${this.id}-duration-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>`}),this.seconds=vt(`${this.id}-duration`,{initial:n.seconds||0,min:0,max:600})}*clickIntervalGen(e,n){let{bpm:i,subdivisions:r,started:s,recording:o}=n;if(i>0&&r>0){const a=function*(u){n.accel.enabled?n.accel.clicks.push(u):yield u},c=this.seconds()/60*n.bpm,l=60/i/r*1e3;for(let u=0;u<c;u++){const d=n.getLevel();yield*a({delay:l,level:d,started:s,recording:o});for(let h=0;h<r-1;h++)yield*a({delay:l,level:4,started:s,recording:o});n.beatIndex++}}else yield{delay:this.seconds()*1e3,level:0,started:s,recording:o}}getOpts(){return{seconds:this.seconds()}}queryString(){return`seconds:${this.seconds()}`}};Gi.type="duration";let Oe=Gi;const qi=class qi extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Measures",col_4:`
        <div class="container">
          <div class="row-col">
            Measures:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-measures-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-measures-val" value="0" pattern="[0-9]*">
            <button class="btn" id="${this.id}-measures-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>`}),this.count=vt(`${this.id}-measures`,{initial:n.count||0,min:0,max:256})}*clickIntervalGen(e,n){const i=function*(l){n.accel.enabled?n.accel.clicks.push(l):yield l};let{bpm:r,subdivisions:s,started:o,recording:a}=n;if(r===0||s===0)return;const c=60/r/s*1e3;for(let l=0;l<this.count();l++)for(let u=0;u<n.beatsPerMeasure;u++){const d=n.getLevel();yield*i({delay:c,level:d,started:o,recording:a});for(let h=0;h<s-1;h++)yield*i({delay:c,level:4,started:o,recording:a});n.beatIndex++}}getOpts(){return{count:this.count()}}queryString(){return`count:${this.count()}`}};qi.type="measures";let De=qi;const Wi=class Wi extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Set Metronome",col_1:`
        <div class="container">
          <div class="row-col" id="${this.id}-bpm-label">
            BPM:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-bpm-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-bpm-val" value="60" pattern="[0-9]*">
            <button class="btn" id="${this.id}-bpm-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>`}),this.bpm=vt(`${this.id}-bpm`,{initial:n.bpm||60,min:5,max:512}),this.bpmLabel=document.getElementById(`${this.id}-bpm-label`),this.recSpeed=document.getElementById("rec-speed"),this.recSpeed.addEventListener("input",i=>{this.updateBpmLabel()}),document.getElementById(`${this.id}-bpm-val`)?.addEventListener("input",i=>{this.updateBpmLabel()})}updateBpmLabel(){const e=this.bpm(),n=parseInt(this.recSpeed.value),i=Math.round(e*n/100);this.bpmLabel.innerText=i===e?"BPM:":`BPM (${i}):`}*clickIntervalGen(e,n){if(n.accel.enabled){const i=ai[n.accel.kind];if(!i)throw new Error(`${n.accel.kind} accelerando kind not found`);const r=this.bpm()/60/1e3,s=n.bpm/60/1e3,o=n.accel.clicks.reduce((l,u)=>l+u.delay,0)*s;let a=0,c=0;for(const l of n.accel.clicks){c+=l.delay*s;const u=i({thisClick:c,totalClicks:o,initialTempo:s,finalTempo:r});u&&(l.delay=u-a,a=u),yield l}}n.accel.reset(),n.bpm=this.bpm()}getOpts(){return{bpm:this.bpm()}}queryString(){return`bpm:${this.bpm()}`}};Wi.type="metronome";let Ne=Wi;const ji=class ji extends ot{constructor(e,n){super();const i=this.newBlockDiv(e,{title:"Set Beat Pattern",col_2:`
        <div class="container">
          <div class="row-col">
            Beat Pattern:
          </div>
          <div class="row-col input-group pattern-div" id="${this.id}-pattern">
            <div class="btn-group-vertical" role="group">
              <button class="btn" id="${this.id}-beats-minus" type="button" tabindex="-1">-</button>
              <button class="btn" id="${this.id}-start-minus" type="button" tabindex="-1">-</button>
            </div>
            <input type="text" class="form-control" id="${this.id}-beats-val" hidden>
            <input type="text" class="form-control" id="${this.id}-start-val" hidden>
            <div class="btn-group-vertical" role="group">
              <button class="btn" id="${this.id}-beats-plus" type="button" tabindex="-1">+</button>
              <button class="btn" id="${this.id}-start-plus" type="button" tabindex="-1">+</button>
            </div>
          </div>
        </div>`,col_3:`
        <div class="container">
          <div class="row-col">
            Subdivisions:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-rec-subdivisions-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-rec-subdivisions-val" value="1" pattern="[0-9]*">
            <button class="btn" id="${this.id}-rec-subdivisions-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>
        <div class="container">
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-play-subdivisions-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-play-subdivisions-val" value="1" pattern="[0-9]*">
            <button class="btn" id="${this.id}-play-subdivisions-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>`});this.beats=vt(`${this.id}-beats`,{initial:n.beats||4,min:1,max:16}),this.start=vt(`${this.id}-start`,{initial:n.start||1,min:1,max:16}),this.recordSubdivisions=vt(`${this.id}-rec-subdivisions`,{initial:n.recordSubdivisions||1,min:1,max:64}),this.playbackSubdivisions=vt(`${this.id}-play-subdivisions`,{initial:n.playbackSubdivisions||1,min:1,max:64});const r=(n.pattern||"1,2,2,2").split(",").map(s=>parseInt(s));this.pattern=new Ko(`${this.id}-pattern`,{initial:r,start:parseInt(n.start||"1")}),i.addEventListener("input",s=>{const o=s.target;o.id===`${this.id}-beats-val`&&this.pattern.setBeatCount(parseInt(o.value)),o.id===`${this.id}-start-val`&&this.pattern.setStartBeat(parseInt(o.value))})}*clickIntervalGen(e,n){switch(n.beatIndex=this.start()-1,n.beatsPerMeasure=this.beats(),n.beatPattern=this.pattern.values(),e){case"record":n.subdivisions=this.recordSubdivisions();break;case"play":n.subdivisions=this.playbackSubdivisions();break;default:throw new Error(`Unknown phase type "${e}"`)}}getOpts(){return{beats:this.beats(),start:this.start(),pattern:this.pattern.values().join(),recordSubdivisions:this.recordSubdivisions(),playbackSubdivisions:this.playbackSubdivisions()}}queryString(){return[`beats:${this.beats()}`,`start:${this.start()}`,`pattern:${this.pattern.values().join()}`,`recordSubdivisions:${this.recordSubdivisions()}`,`playbackSubdivisions:${this.playbackSubdivisions()}`].join(" ")}};ji.type="pattern";let Me=ji;const Hi=class Hi extends ot{constructor(e,n){super(),this.newBlockDiv(e,{title:"Pause",col_4:`
        <div class="container">
          <div class="row-col">
            Milliseconds:
          </div>
          <div class="row-col input-group">
            <button class="btn" id="${this.id}-pause-minus" type="button" tabindex="-1">-</button>
            <input type="text" class="form-control" id="${this.id}-pause-val" value="0" pattern="[0-9]*">
            <button class="btn" id="${this.id}-pause-plus" type="button" tabindex="-1">+</button>
          </div>
        </div>`}),this.pause=vt(`${this.id}-pause`,{initial:n.pause||0,min:0,max:60*1e3})}*clickIntervalGen(e,n){yield{delay:this.pause(),level:0,started:n.started,recording:n.recording}}getOpts(){return{pause:this.pause()}}queryString(){return`pause:${this.pause()}`}};Hi.type="pause";let Pe=Hi;var ue;let Mn=(ue=class extends ot{constructor(e){super(),this.removable=!1,this.newBlockDiv(e,{title:"Start"})}*clickIntervalGen(e,n){n.started=!0}},ue.type="start",ue);const Ki=class Ki extends ot{constructor(e){super(),this.removable=!1,this.newBlockDiv(e,{title:"Start Recording"})}*clickIntervalGen(e,n){n.started=!0,n.recording=!0}};Ki.type="record";let Ue=Ki;var de;let Pn=(de=class extends ot{constructor(e){super(),this.removable=!1,this.newBlockDiv(e,{title:"Stop"})}*clickIntervalGen(e,n){n.started=!1}},de.type="done",de);const Xi=class Xi extends ot{constructor(e){super(),this.removable=!1,this.newBlockDiv(e,{title:"Stop Recording"})}*clickIntervalGen(e,n){n.recording=!1}};Xi.type="stop";let Be=Xi;class ia{constructor(){this.enabled=!1,this.clicks=[]}reset(){this.enabled=!1,this.kind=void 0,this.clicks=[]}start(e){this.reset(),this.enabled=!0,this.kind=e}}class ra{constructor(e){this.bpm=0,this.beatsPerMeasure=1,this.subdivisions=1,this.beatIndex=1,this.beatPattern=[1],this.started=!1,this.recording=!1,this.accel=new ia,this.phase=e}getLevel(){let e=this.beatPattern[this.beatIndex%this.beatsPerMeasure];return this.phase=="play"&&e===0&&(e=this.beatIndex%this.beatsPerMeasure===0?1:2),e}}class sa{constructor(){this.blocks=[],this.initialized=!1,this.addButton=document.getElementById("add-block"),this.blockDiv=document.getElementById("blocks"),this.blockTypes=[Re.type,Le.type,Oe.type,De.type,Ne.type,Me.type,Pe.type,Mn.type,Ue.type,Pn.type,Be.type];const e=this.updateQueryParams.bind(this);if(new MutationObserver(n=>{e();for(const i of n)i.addedNodes.forEach(r=>{r.classList?.contains("block-element")&&r.addEventListener("input",e)})}).observe(this.blockDiv,{childList:!0,subtree:!0}),G.has("record")){const n=[];for(const[i,r]of G.getAll()){if(!this.blockTypes.includes(i))continue;const s={};for(let o of decodeURIComponent(r).split(" ")){const[a,c]=o.split(":");c!==void 0&&(s[a]=c)}n.push([i,s])}n.some(([i,r])=>i=="start")||this.newBlock("start"),n.some(([i,r])=>i=="record")||this.newBlock("record");for(const[i,r]of n)this.newBlock(i,r);n.some(([i,r])=>i=="stop")||this.newBlock("stop"),n.some(([i,r])=>i=="done")||this.newBlock("done")}else this.newBlock("start"),this.newBlock("metronome"),this.newBlock("pattern"),this.newBlock("beats",{count:4}),this.newBlock("record"),this.newBlock("beats",{count:16}),this.newBlock("stop"),this.newBlock("done");this.addButton.addEventListener("click",n=>{const i=n.target.value;this.newBlock(i)}),this.initialized=!0}newBlock(e,n={}){n=Object.keys(n).length?n:this.getLastBlockOpts(e);let i;switch(e){case Re.type:i=new Re(this.blockDiv,n);break;case Le.type:i=new Le(this.blockDiv,n);break;case Oe.type:i=new Oe(this.blockDiv,n);break;case De.type:i=new De(this.blockDiv,n);break;case Ne.type:i=new Ne(this.blockDiv,n);break;case Me.type:i=new Me(this.blockDiv,n);break;case Pe.type:i=new Pe(this.blockDiv,n);break;case Mn.type:i=new Mn(this.blockDiv);break;case Ue.type:i=new Ue(this.blockDiv);break;case Pn.type:i=new Pn(this.blockDiv);break;case Be.type:i=new Be(this.blockDiv);break;default:return}this.initialized&&i.highlight(),i.remove=this.removeBlock.bind(this),i.moveUp=this.moveBlockUp.bind(this),i.moveDown=this.moveBlockDown.bind(this),this.blocks.push(i)}getLastBlockOpts(e){return this.blocks.reduceRight((n,i)=>{if(n)return n;const r=i.constructor.type;if(e==r)return i.getOpts()},null)||{}}removeBlock(e){if(e.removable){const n=this.blocks.indexOf(e);n>-1&&this.blocks.splice(n,1)}}async moveBlockUp(e){const n=this.blocks.indexOf(e);n>0&&(e.highlight(),await oi(100),this.blocks.splice(n,1),this.blocks.splice(n-1,0,e))}async moveBlockDown(e){const n=this.blocks.indexOf(e);n>-1&&(e.highlight(),await oi(100),this.blocks.splice(n,1),this.blocks.splice(n+1,0,e))}recordClicks(){return this.clickIntervalGen("record")}playClicks(){return this.clickIntervalGen("play")}clickIntervalGen(e){const n=[],i=new ra(e);let r=!1;for(const s of this.blocks)for(const o of s.clickIntervalGen(e,i))o.started&&(e=="record"||o.recording)&&(n.push(o),r=o.recording);return n.push({delay:350,level:i.getLevel(),started:!0,recording:r}),n}updateQueryParams(){const e=new URLSearchParams;[...this.blocks].forEach(n=>{const i=n.constructor.type,r=encodeURIComponent(n.queryString());e.append(i,r)});for(const[n,i]of G.getAll())this.blockTypes.includes(n)||e.append(n,i);G.replace(e)}}class oa{constructor(e,n=.25){this.oscillators=[],this.gainNodes=[],this.isPlaying=!1,this.droneButton=document.getElementById("drone"),this.pitchSelect=document.getElementById("drone-pitch"),this.octaveSelect=document.getElementById("drone-octave"),this.pitch=this.pitchSelect.value,this.octave=this.octaveSelect.value,this.justIntonationRatios=[{ratio:1,volume:.45},{ratio:2,volume:.25},{ratio:3,volume:.05},{ratio:4,volume:.1},{ratio:5,volume:.04},{ratio:6,volume:.03},{ratio:8,volume:.02},{ratio:16,volume:.005}],this.audioContext=e,this.masterGain=e.createGain(),this.masterGain.gain.value=n,this.masterGain.connect(e.destination),this.droneButton.addEventListener("click",this.toggle.bind(this)),this.pitchSelect.addEventListener("change",this.pitchChange.bind(this)),this.octaveSelect.addEventListener("change",this.octaveChange.bind(this))}toggle(){this.isPlaying?(this.stop(),this.droneButton.classList.add("btn-outline-secondary"),this.droneButton.classList.remove("btn-primary"),this.octaveSelect.classList.add("border-secondary"),this.octaveSelect.classList.remove("bg-primary"),this.octaveSelect.classList.remove("border-primary"),this.pitchSelect.classList.add("border-secondary"),this.pitchSelect.classList.remove("bg-primary"),this.pitchSelect.classList.remove("border-primary")):(this.start(),this.droneButton.classList.add("btn-primary"),this.droneButton.classList.remove("btn-outline-secondary"),this.octaveSelect.classList.add("bg-primary"),this.octaveSelect.classList.add("border-primary"),this.octaveSelect.classList.remove("border-secondary"),this.pitchSelect.classList.add("bg-primary"),this.pitchSelect.classList.add("border-primary"),this.pitchSelect.classList.remove("border-secondary"))}pitchChange(e){const i=e.target.value;i!=this.pitch&&(this.pitch=i,this.isPlaying&&this.start())}octaveChange(e){const i=e.target.value;i!=this.octave&&(this.octave=i,this.isPlaying&&this.start())}start(){this.isPlaying&&this.stop();const e=this.getNoteFrequency(`${this.pitch}${this.octave}`);this.oscillators=[],this.gainNodes=[],this.justIntonationRatios.forEach(({ratio:n,volume:i})=>{const r=e*n,s=this.audioContext.createOscillator();s.type="sine",s.frequency.value=r;const o=this.audioContext.createGain();o.gain.value=i,s.connect(o),o.connect(this.masterGain),s.start(),this.oscillators.push(s),this.gainNodes.push(o)}),this.isPlaying=!0}stop(){this.isPlaying&&(this.oscillators.forEach(e=>{try{e.stop()}catch{}}),this.oscillators=[],this.gainNodes=[],this.isPlaying=!1)}getNoteFrequency(e){return{C0:16.35,Db0:17.32,D0:18.35,Eb0:19.45,E0:20.6,F0:21.83,Gb0:23.12,G0:24.5,Ab0:25.96,A0:27.5,Bb0:29.14,B0:30.87,C1:32.7,Db1:34.65,D1:36.71,Eb1:38.89,E1:41.2,F1:43.65,Gb1:46.25,G1:49,Ab1:51.91,A1:55,Bb1:58.27,B1:61.74,C2:65.41,Db2:69.3,D2:73.42,Eb2:77.78,E2:82.41,F2:87.31,Gb2:92.5,G2:98,Ab2:103.83,A2:110,Bb2:116.54,B2:123.47,C3:130.81,Db3:138.59,D3:146.83,Eb3:155.56,E3:164.81,F3:174.61,Gb3:185,G3:196,Ab3:207.65,A3:220,Bb3:233.08,B3:246.94,C4:261.63,Db4:277.18,D4:293.66,Eb4:311.13,E4:329.63,F4:349.23,Gb4:369.99,G4:392,Ab4:415.3,A4:440,Bb4:466.16,B4:493.88,C5:523.25,Db5:554.37,D5:587.33,Eb5:622.25,E5:659.25,F5:698.46,Gb5:739.99,G5:783.99,Ab5:830.61,A5:880,Bb5:932.33,B5:987.77,C6:1046.5,Db6:1108.73,D6:1174.66,Eb6:1244.51,E6:1318.51,F6:1396.91,Gb6:1479.98,G6:1567.98,Ab6:1661.22,A6:1760,Bb6:1864.66,B6:1975.53}[e]||440}}class Fe{static set(e,n){const i=new Date;i.setTime(i.getTime()+10*365*24*60*60*1e3);const r=window.location.pathname;document.cookie=e+"="+n+"; expires="+i.toUTCString()+"; path="+r}static get(e){const i=("; "+document.cookie).split("; "+e+"=");return i.length==2&&i.pop()?.split(";").shift()||""}static getAll(){const e={},n=document.cookie;return n&&n.split(";").forEach(i=>{const[r,s]=i.trim().split("=");r&&(e[r]=s||"")}),e}static delete(e){const n=new Date;n.setTime(n.getTime()+-1440*60*1e3);const i=window.location.pathname;document.cookie=e+"=; expires="+n.toUTCString()+"; path="+i}}class aa{constructor(){this.cookieName="latency-compensation";const e=parseInt(Fe.get(this.cookieName))||145;this.getLatency=vt("latency-compensator",{initial:e,min:-500,max:500}),document.getElementById("latency-compensator-val").addEventListener("input",()=>{Fe.set(this.cookieName,this.getLatency().toString())})}}class ca{constructor(e){this.sourceNode=null,this.playbackRate=1,this.onEndedCallback=null,this.startTime=0,this.audioContext=e,this.gainNode=e.createGain(),this.gainNode.connect(e.destination)}play(e,n=1,i){this.stop(),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=e,this.sourceNode.playbackRate.value=n,this.sourceNode.connect(this.gainNode),this.playbackRate=n,this.onEndedCallback=i||null,this.sourceNode.onended=()=>{this.onEndedCallback&&this.onEndedCallback()};const r=this.audioContext.currentTime;return this.startTime=r,this.sourceNode.start(r),r}stop(){this.sourceNode&&(this.sourceNode.stop(),this.sourceNode.disconnect(),this.sourceNode=null)}}class la{constructor(e){this.stream=null,this.sourceNode=null,this.recordingNode=null,this.state=A.UNKNOWN,this.recordedBuffer=null,this.recordingData=[],this.sampleRate=44100,this.maxRecordingLength=300,this.audioContext=e,this.sampleRate=e.sampleRate}async initialize(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:this.sampleRate}}),this.sourceNode=this.audioContext.createMediaStreamSource(this.stream);try{await this.audioContext.audioWorklet.addModule(this.getRecorderWorkletCode()),this.recordingNode=new AudioWorkletNode(this.audioContext,"recorder-worklet"),this.setupWorkletRecording()}catch{console.warn("AudioWorklet not supported, falling back to ScriptProcessorNode"),this.setupScriptProcessorRecording()}this.state=A.STOPPED}catch(e){throw console.error("Error initializing Web Audio recorder:",e),e}}getRecorderWorkletCode(){const e=`
      class RecorderWorklet extends AudioWorkletProcessor {
        constructor() {
          super();
          this.isRecording = false;
          this.port.onmessage = (event) => {
            if (event.data.command === "start") {
              this.isRecording = true;
            } else if (event.data.command === "stop") {
              this.isRecording = false;
            }
          };
        }

        process(inputs, outputs) {
          if (this.isRecording && inputs[0] && inputs[0][0]) {
            // Send audio data to main thread
            this.port.postMessage({
              type: "audiodata",
              audioData: inputs[0][0].slice() // Copy the audio data
            });
          }
          return true;
        }
      }
      registerProcessor("recorder-worklet", RecorderWorklet);
    `,n=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(n)}setupWorkletRecording(){this.recordingNode&&(this.recordingNode.port.onmessage=e=>{e.data.type==="audiodata"&&(this.recordingData.push(new Float32Array(e.data.audioData)),this.recordingData.length>this.maxRecordingLength*this.sampleRate/128&&(console.warn("Maximum recording length reached"),this.stop()))})}setupScriptProcessorRecording(){const n=this.audioContext.createScriptProcessor(4096,1,1);n.onaudioprocess=i=>{if(this.state===A.RECORDING){const r=i.inputBuffer.getChannelData(0);this.recordingData.push(new Float32Array(r)),this.recordingData.length>this.maxRecordingLength*this.sampleRate/4096&&(console.warn("Maximum recording length reached"),this.stop())}},this.recordingNode=n}start(){if(this.state!==A.STOPPED){console.error("Recorder is not in a stopped state, cannot start recording");return}try{this.recordingData=[],this.sourceNode&&this.recordingNode&&(this.sourceNode.connect(this.recordingNode),this.recordingNode instanceof ScriptProcessorNode&&this.recordingNode.connect(this.audioContext.destination)),this.state=A.RECORDING,this.recordingNode instanceof AudioWorkletNode&&this.recordingNode.port.postMessage({command:"start"})}catch(e){console.error("Error starting recording:",e)}}stop(){if(this.state===A.RECORDING)try{this.state=A.STOPPED,this.recordingNode instanceof AudioWorkletNode&&this.recordingNode.port.postMessage({command:"stop"}),this.sourceNode&&this.recordingNode&&(this.sourceNode.disconnect(this.recordingNode),this.recordingNode instanceof ScriptProcessorNode&&this.recordingNode.disconnect()),this.processRecordedData()}catch(e){console.error("Error stopping recording:",e)}}processRecordedData(){if(this.recordingData.length===0){console.warn("No audio data recorded");return}const e=this.recordingData.reduce((r,s)=>r+s.length,0);this.recordedBuffer=this.audioContext.createBuffer(1,e,this.sampleRate);const n=this.recordedBuffer.getChannelData(0);let i=0;for(const r of this.recordingData)n.set(r,i),i+=r.length}getAudioBuffer(){try{return this.recordedBuffer}finally{this.recordedBuffer=null}}reset(){if(this.state===A.RECORDING&&this.stop(),this.stream&&this.sourceNode)try{this.sourceNode=this.audioContext.createMediaStreamSource(this.stream),this.recordingNode instanceof AudioWorkletNode?(this.recordingNode=new AudioWorkletNode(this.audioContext,"recorder-worklet"),this.setupWorkletRecording()):this.setupScriptProcessorRecording(),this.state=A.STOPPED}catch(e){console.error("Error resetting recorder:",e)}}}class ua{constructor(){this.savesPrefix="practice-recorder-saved-save",this.savesDiv=document.getElementById("saves"),this.buttonGroup1=document.getElementById("save-new-group-1"),this.newButton=document.getElementById("save-new"),this.deleteButton=document.getElementById("save-delete"),this.buttonGroup2=document.getElementById("save-new-group-2"),this.nameInput=document.getElementById("save-name"),this.submitButton=document.getElementById("save-submit"),this.cancelButton=document.getElementById("save-cancel"),this.trashIcons=[],this.loadSaves(),this.newButton.addEventListener("click",()=>{this.buttonGroup1.hidden=!0,this.buttonGroup2.hidden=!1,this.nameInput.focus(),this.turnOffDeleting()}),this.deleteButton.addEventListener("click",()=>{this.isDeletingOn()?this.turnOffDeleting():this.turnOnDeleting()}),this.nameInput.addEventListener("keydown",e=>{e.key==="Enter"&&this.submitButton.click()}),this.submitButton.addEventListener("click",()=>{const e=this.nameInput.value;e!==""&&this.newSave(e,window.location.href),this.nameInput.value="",this.buttonGroup1.hidden=!1,this.buttonGroup2.hidden=!0}),this.cancelButton.addEventListener("click",()=>{this.nameInput.value="",this.buttonGroup1.hidden=!1,this.buttonGroup2.hidden=!0}),window.addEventListener("hidden.bs.offcanvas",()=>{this.nameInput.value="",this.buttonGroup1.hidden=!1,this.buttonGroup2.hidden=!0,this.turnOffDeleting()})}isDeletingOn(){return[...this.deleteButton.classList].includes("btn-danger")}turnOffDeleting(){this.isDeletingOn()&&(this.deleteButton.classList.add("btn-outline-secondary"),this.deleteButton.classList.remove("btn-danger"),this.trashIcons.forEach(e=>e.hidden=!0),this.deleteButton.innerText="Delete")}turnOnDeleting(){this.deleteButton.classList.add("btn-danger"),this.deleteButton.classList.remove("btn-outline-secondary"),this.trashIcons.forEach(e=>e.hidden=!1),this.deleteButton.innerText="Deleting..."}loadSaves(){this.savesDiv.innerText="",this.addSave("Default",window.location.origin+window.location.pathname);const e=[];for(const n of Object.keys(Fe.getAll()))if(n.startsWith(this.savesPrefix)){const i=Fe.get(n);i&&e.push([n,i,!0])}for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);if(i&&i.startsWith(this.savesPrefix)){const r=localStorage.getItem(i);r&&e.push([i,r,!1])}}e.sort((n,i)=>n[0]<i[0]?-1:n[0]>i[0]?1:0);for(const[n,i,r]of e){const[s,o]=i.split(","),a=r?`${s} *`:s,c=this.addSave(a,o),l=document.createElement("i");this.trashIcons.push(l),l.classList.add("bi"),l.classList.add("bi-trash"),l.classList.add("bi-tiny"),l.classList.add("block-control"),l.style.marginLeft="10px",l.style.color="red",l.hidden=!this.isDeletingOn(),c.appendChild(l),l.addEventListener("click",()=>{this.deleteSave(n),this.loadSaves()})}}addSave(e,n){const i=document.createElement("div");i.classList.add("save-link"),this.savesDiv.appendChild(i);const r=document.createElement("a");return r.classList.add("save-link"),r.href=n,r.innerText=e,i.appendChild(r),i}newSave(e,n){localStorage.setItem(`${this.savesPrefix}-zzz-${Date.now()}`,`${e},${n}`),this.loadSaves()}deleteSave(e){localStorage.removeItem(e),Fe.delete(e)}}class da{constructor(){this.taps=[],this.tapperToggle=document.getElementById("tapper"),this.bpmDisplay=document.getElementById("tapper-display"),this.started=!1,this.eventListener=e=>{e.key==="Enter"&&(e.preventDefault(),this.tap())},this.tapperToggle.addEventListener("click",this.toggle.bind(this)),window.addEventListener("hidden.bs.offcanvas",()=>{this.started&&this.toggle()})}toggle(){this.taps=[],this.started?(window.removeEventListener("keydown",this.eventListener),this.tapperToggle.classList.add("btn-outline-secondary"),this.tapperToggle.classList.remove("btn-primary"),this.bpmDisplay.innerText="",this.started=!1):(window.addEventListener("keydown",this.eventListener),this.tapperToggle.classList.add("btn-primary"),this.tapperToggle.classList.remove("btn-outline-secondary"),this.bpmDisplay.innerText="Press Enter to Tap",this.started=!0)}async tap(){this.taps.push(Date.now()),setTimeout(()=>this.updateBpm(),0)}updateBpm(){if(this.taps.length<2)return;const e=this.taps.slice(1).map((r,s)=>r-this.taps[s]),n=e.reduce((r,s)=>r+s,0)/e.length,i=Math.round(6e4/n);for(this.bpmDisplay.innerText=i.toString();this.taps.length>8;)this.taps.shift()}}class ha{static calculateLoudnessFromBuffer(e,n=1024){const i=e.getChannelData(0),r=e.sampleRate,s=n/2,o=[];for(let a=0;a<i.length-n;a+=s){let c=0;for(let d=0;d<n;d++){const h=i[a+d];c+=h*h}const l=Math.sqrt(c/n),u=a/r*1e3;o.push({timestamp:u,loudness:l})}return o}}var gt={},Xt={},Qi;function fa(){if(Qi)return Xt;Qi=1;var t=Xt&&Xt.__assign||function(){return t=Object.assign||function(i){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},t.apply(this,arguments)};Object.defineProperty(Xt,"__esModule",{value:!0});var e={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function n(i){i===void 0&&(i={});var r=t(t({},e),i),s=r.threshold,o=r.sampleRate,a=r.probabilityThreshold;return function(l){var u;for(u=1;u<l.length;u*=2);u/=2;for(var d=u/2,h=new Float32Array(d),p=0,f,v=0;v<d;v++)h[v]=0;for(var v=1;v<d;v++)for(var S=0;S<d;S++){var E=l[S]-l[S+v];h[v]+=E*E}h[0]=1,h[1]=1;for(var T=0,v=1;v<d;v++)T+=h[v],h[v]*=v/T;for(f=2;f<d;f++)if(h[f]<s){for(;f+1<d&&h[f+1]<h[f];)f++;p=1-h[f];break}if(f===d||h[f]>=s||p<a)return null;var g,b,w;if(f<1?b=f:b=f-1,f+1<d?w=f+1:w=f,b===f)h[f]<=h[w]?g=f:g=w;else if(w===f)h[f]<=h[b]?g=f:g=b;else{var m=h[b],y=h[f],_=h[w];g=f+(_-m)/(2*(2*y-_-m))}return o/g}}return Xt.YIN=n,Xt}var Yt={},tr;function pa(){if(tr)return Yt;tr=1;var t=Yt&&Yt.__assign||function(){return t=Object.assign||function(i){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},t.apply(this,arguments)};Object.defineProperty(Yt,"__esModule",{value:!0});var e={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function n(i){i===void 0&&(i={});var r=t(t({},e),i),s=r.sampleRate,o=r.minFrequency,a=r.maxFrequency,c=r.sensitivity,l=r.ratio,u=[],d=Math.ceil(s/o),h=Math.floor(s/a);return function(f){var v=f.length,S=0,E=1/0,T=-1/0,g,b,w,m,y,_,D,M;for(m=0;m<v;m++)if(h<=m&&m<=d){for(D=0,M=m,S=0,g=[],b=[];D<v-m;S++,M++,D++)g[S]=f[D],b[S]=f[M];var W=g.length;for(w=[],_=0;_<W;_++)w[_]=g[_]-b[_];var nt=0;for(_=0;_<W;_++)nt+=Math.abs(w[_]);u[m]=nt}for(y=h;y<d;y++)u[y]<E&&(E=u[y]),u[y]>T&&(T=u[y]);var it=Math.round(c*(T-E)+E);for(y=h;y<=d&&u[y]>it;y++);var pt=h/2;E=u[y];var mt=y;for(m=y-1;m<y+pt&&m<=d;m++)u[m]<E&&(E=u[m],mt=m);return Math.round(u[mt]*l)<T?s/mt:null}}return Yt.AMDF=n,Yt}var Zt={},er;function ma(){if(er)return Zt;er=1;var t=Zt&&Zt.__assign||function(){return t=Object.assign||function(i){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},t.apply(this,arguments)};Object.defineProperty(Zt,"__esModule",{value:!0});var e={sampleRate:44100};function n(i){i===void 0&&(i=e);var r=t(t({},e),i),s=r.sampleRate;return function(a){var c=a.length,l=0,u,d,h,p;for(u=0;u<c;u++)p=a[u],l+=p*p;if(l=Math.sqrt(l/c),l<.01)return-1;var f=0,v=c-1,S=.2;for(u=0;u<c/2;u++)if(Math.abs(a[u])<S){f=u;break}for(u=1;u<c/2;u++)if(Math.abs(a[c-u])<S){v=c-u;break}var E=a.slice(f,v),T=E.length,g=new Array(T).fill(0);for(u=0;u<T;u++)for(d=0;d<T-u;d++)g[u]=g[u]+E[d]*E[d+u];for(h=0;g[h]>g[h+1];)h++;var b=-1,w=-1;for(u=h;u<T;u++)g[u]>b&&(b=g[u],w=u);var m=w,y=g[m-1],_=g[m],D=g[m+1],M=(y+D-2*_)/2,W=(D-y)/2;return M&&(m=m-W/(2*M)),s/m}}return Zt.ACF2PLUS=n,Zt}var Jt={},nr;function ga(){if(nr)return Jt;nr=1;var t=Jt&&Jt.__assign||function(){return t=Object.assign||function(a){for(var c,l=1,u=arguments.length;l<u;l++){c=arguments[l];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},t.apply(this,arguments)};Object.defineProperty(Jt,"__esModule",{value:!0});var e=6,n=3e3,i=3,r=.75,s={sampleRate:44100};function o(a){a===void 0&&(a={});var c=t(t({},s),a),l=c.sampleRate;return function(d){for(var h=[],p=[],f=d.length,v=null,S=0,E=0,T=0,g=0;g<f;g++){var b=d[g];S=S+b,T=Math.max(T,b),E=Math.min(E,b)}S/=f,E-=S,T-=S;for(var w=T>-1*E?T:-1*E,m=w*r,y=0,_=-1,D=d.length,M,W,nt;M=~~(l/(Math.pow(2,y)*n)),!(D<2);){var it=void 0,pt=-1e3,mt=-1e6,Ht=-1e6,Nt=!1,Ct=!1;nt=0,W=0;for(var g=2;g<D;g++){var rt=d[g]-S,lt=d[g-1]-S;lt<=0&&rt>0&&(Nt=!0),lt>=0&&rt<0&&(Ct=!0),it=rt-lt,pt>-1e3&&(Ct&&pt<0&&it>=0&&Math.abs(rt)>=m&&g>mt+M&&(h[nt++]=g,mt=g,Ct=!1),Nt&&pt>0&&it<=0&&Math.abs(rt)>=m&&g>Ht+M&&(p[W++]=g,Ht=g,Nt=!1)),pt=it}if(nt===0&&W===0)break;for(var Y=void 0,Z=[],g=0;g<D;g++)Z[g]=0;for(var g=0;g<nt;g++)for(var P=1;P<i;P++)g+P<nt&&(Y=Math.abs(h[g]-h[g+P]),Z[Y]+=1);for(var St=-1,we=-1,g=0;g<D;g++){for(var xt=0,P=-1*M;P<=M;P++)g+P>=0&&g+P<D&&(xt+=Z[g+P]);xt===we?g===2*St&&(St=g):xt>we&&(we=xt,St=g)}for(var Kt=0,j=0,P=-M;P<=M;P++)if(St+P>=0&&St+P<f){var On=Z[St+P];On>0&&(j+=On,Kt+=(St+P)*On)}if(Kt/=j,_>-1&&Math.abs(Kt*2-_)<=2*M){v=l/(Math.pow(2,y-1)*_);break}if(_=Kt,y++,y>=e||D<2)break;var Dn=d.subarray(0);D===Z.length&&(Dn=new Float32Array(D/2));for(var g=0;g<D/2;g++)Dn[g]=(d[2*g]+d[2*g+1])/2;d=Dn,D/=2}return v}}return Jt.DynamicWavelet=o,Jt}var Qt={},ir;function va(){if(ir)return Qt;ir=1;var t=Qt&&Qt.__assign||function(){return t=Object.assign||function(i){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},t.apply(this,arguments)};Object.defineProperty(Qt,"__esModule",{value:!0});var e={bufferSize:1024,cutoff:.97,sampleRate:44100};function n(i){i===void 0&&(i={});var r=t(t({},e),i),s=r.bufferSize,o=r.cutoff,a=r.sampleRate,c=.5,l=80,u=new Float32Array(s),d=new Float32Array(s),h,p,f=[],v=[],S=[];function E(b){var w,m;d[0]=b[0]*b[0];for(var y=1;y<b.length;y+=1)d[y]=b[y]*b[y]+d[y-1];for(var _=0;_<b.length;_++){w=0,m=d[b.length-1-_]+d[b.length-1]-d[_];for(var y=0;y<b.length-_;y++)w+=b[y]*b[y+_];u[_]=2*w/m}}function T(b){var w=u[b-1],m=u[b],y=u[b+1],_=b,D=y+w-2*m;if(D===0)h=_,p=m;else{var M=w-y;h=_+M/(2*D),p=m-M*M/(8*D)}}function g(){for(var b=0,w=0;b<(u.length-1)/3&&u[b]>0;)b++;for(;b<u.length-1&&u[b]<=0;)b++;for(b==0&&(b=1);b<u.length-1;)if(u[b]>u[b-1]&&u[b]>=u[b+1]&&(w==0||u[b]>u[w])&&(w=b),b++,b<u.length-1&&u[b]<=0)for(w>0&&(f.push(w),w=0);b<u.length-1&&u[b]<=0;)b++;w>0&&f.push(w)}return function(w){var m;f=[],v=[],S=[],E(w),g();for(var y=-1/0,_=0;_<f.length;_++){var D=f[_];y=Math.max(y,u[D]),u[D]>c&&(T(D),S.push(p),v.push(h),y=Math.max(y,p))}if(v.length){for(var M=o*y,W=0,_=0;_<S.length;_++)if(S[_]>=M){W=_;break}var nt=v[W],it=a/nt;it>l?m=it:m=-1}else m=-1;return{probability:y,freq:m}}}return Qt.Macleod=n,Qt}var Ee={},rr;function ba(){return rr||(rr=1,(function(t){var e=Ee&&Ee.__assign||function(){return e=Object.assign||function(r){for(var s,o=1,a=arguments.length;o<a;o++){s=arguments[o];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(r[c]=s[c])}return r},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function n(r,s){var o=r.map(function(p){return p(s)}).filter(function(p){return p!==null}).sort(function(p,f){return p-f});if(o.length===1)return o[0];if(o.length===2){var a=o[0],c=o[1];return a*2>c?Math.sqrt(a*c):a}else{var a=o[0],c=o[1],l=o[o.length-2],u=o[o.length-1],d=a*2>c?o:o.slice(1),h=l*2>u?d:d.slice(0,-1);return Math.pow(h.reduce(function(v,S){return v*S},1),1/h.length)}}function i(r,s,o){o===void 0&&(o={});var a=e(e({},t.DEFAULT_FREQUENCIES_PARAMS),o),c=a.tempo,l=a.quantization,u=a.sampleRate,d=s.length,h=Math.round(u*60/(l*c)),p;Array.isArray(r)?p=n.bind(null,r):p=r;for(var f=[],v=0,S=d-h;v<=S;v+=h){var E=s.slice(v,v+h),T=p(E);f.push(T)}return f}t.frequencies=i})(Ee)),Ee}var sr;function ya(){if(sr)return gt;sr=1,Object.defineProperty(gt,"__esModule",{value:!0});var t=fa();gt.YIN=t.YIN;var e=pa();gt.AMDF=e.AMDF;var n=ma();gt.ACF2PLUS=n.ACF2PLUS;var i=ga();gt.DynamicWavelet=i.DynamicWavelet;var r=va();gt.Macleod=r.Macleod;var s=ba();return gt.frequencies=s.frequencies,gt.default={YIN:t.YIN,AMDF:e.AMDF,ACF2PLUS:n.ACF2PLUS,DynamicWavelet:i.DynamicWavelet,Macleod:r.Macleod,frequencies:s.frequencies},gt}var _a=ya();class Sa{constructor(e){this.maxFrequencyTolerance=1800,this.minFrequencyTolerance=150,this.windowSize=2048,this.hopSize=512,this.enabled=Xe("tuner-enabled",{initial:!1}),this.audioContextSampleRate=e.sampleRate,this.detectPitch=_a.YIN({sampleRate:e.sampleRate,threshold:.15,probabilityThreshold:.05}),this.setInstrument("clarinet")}analyze(e){const i={sampleRate:60*this.audioContextSampleRate/this.hopSize,points:[]};if(this.enabled()){const r=e.getChannelData(0),s=this.slidingWindowAnalysis(r);i.points=s.map(o=>this.frequencyToIntonationPoint(o))}return i}slidingWindowAnalysis(e){const n=[];if(e.length<this.windowSize)return[null];for(let i=0;i<=e.length-this.windowSize;i+=this.hopSize){const r=e.slice(i,i+this.windowSize),s=this.detectPitch(r);n.push(s)}return n}frequencyToIntonationPoint(e){if(!e||e<this.minFrequencyTolerance||e>this.maxFrequencyTolerance)return null;const i=440*Math.pow(2,-4.75),r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=Math.round(12*Math.log2(e/i)),o=s%12,a=Math.floor(s/12),c=r[o<0?o+12:o],l=i*Math.pow(2,s/12),u=1200*Math.log2(e/l);return{frequency:e,note:l,name:`${c}${a}`,cents:u}}setWindowParameters(e,n){this.windowSize=e,this.hopSize=n||Math.floor(e/8)}setPrecisionMode(e){switch(e){case"ultra-high":this.setWindowParameters(8192,256);break;case"high":this.setWindowParameters(4096,512);break;case"balanced":this.setWindowParameters(2048,512);break;case"fast":this.setWindowParameters(2048,1024);break}}setInstrument(e){switch(e){case"bass-clarinet":this.minFrequencyTolerance=50,this.maxFrequencyTolerance=1600,this.setPrecisionMode("high");break;case"clarinet":this.minFrequencyTolerance=140,this.maxFrequencyTolerance=1800,this.setPrecisionMode("balanced");break;case"eb-clarinet":this.minFrequencyTolerance=180,this.maxFrequencyTolerance=2100,this.setPrecisionMode("balanced");break;default:this.minFrequencyTolerance=50,this.maxFrequencyTolerance=2100,this.setPrecisionMode("high")}}}class wa{constructor(e){this.canvas=document.getElementById("waveform-canvas"),this.ctx=this.canvas.getContext("2d"),this.loudnessAnalyzer=ha,this.loudnessData=[],this.intonationData=null,this.clicks=[],this.recordSpeed=1,this.latency=0,this.playbackStartTime=0,this.playbackRate=1,this.isPlaybackActive=!1,this.animationFrameId=null,this.clickLines={1:"#f50505",2:"#2905f5",3:"#02b025",4:"#000000"},this.isScrollingEnabled=!1,this.viewStartTime=0,this.viewDuration=1e4,this.totalDuration=0,this.playbackMarkerPosition=.33,this.isDragging=!1,this.dragStartX=0,this.dragStartViewTime=0,this.isZooming=!1,this.lastPinchDistance=0,this.pinchCenterX=0,this.savedZoomPercent=100,this.enabled=Xe("visualization-enabled",{initial:!0}),this.statsDiv=document.getElementById("visualization-stats"),this.options={width:800,height:300,backgroundColor:"#f8f9fa",waveformColor:"#a55dfc",gridColor:"#babcbf",showGrid:!0,maxTime:3e4,scrollThreshold:15e3,viewportDuration:1e4,minZoomDuration:500,maxZoomDuration:3e4},this.tuner=new Sa(e),this.viewDuration=this.options.viewportDuration,this.setupCanvas(),this.setupMouseEvents()}setupCanvas(){this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.canvas.style.width="100%",this.canvas.style.height="300px",this.canvas.style.border="1px solid #dee2e6",this.canvas.style.borderRadius="8px",this.canvas.style.touchAction="none"}setupMouseEvents(){this.canvas.style.cursor="default",this.canvas.addEventListener("mouseleave",()=>{this.endDrag()}),this.canvas.addEventListener("mousedown",e=>{!this.isPlaybackActive&&this.isScrollingEnabled&&this.totalDuration>0&&this.startDrag(e)}),this.canvas.addEventListener("mousemove",e=>{this.isDragging?this.updateDrag(e):this.updateCursor()}),this.canvas.addEventListener("mouseup",()=>{this.endDrag()}),this.canvas.addEventListener("wheel",e=>{if(e.ctrlKey&&!this.isPlaybackActive&&this.totalDuration>0){e.preventDefault();const n=e.deltaY>0?1.1:.9;this.zoom(n,e.offsetX)}},{passive:!1}),this.canvas.addEventListener("touchstart",e=>{!this.isPlaybackActive&&this.totalDuration>0&&this.handleTouchStart(e)},{passive:!1}),this.canvas.addEventListener("touchmove",e=>{!this.isPlaybackActive&&this.totalDuration>0&&this.handleTouchMove(e)},{passive:!1}),this.canvas.addEventListener("touchend",e=>{this.handleTouchEnd(e)},{passive:!1}),this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}updateCursor(){!this.isPlaybackActive&&this.isScrollingEnabled&&this.totalDuration>0?this.canvas.style.cursor="grab":this.canvas.style.cursor="default"}startDrag(e){this.isDragging=!0,this.dragStartX=e.offsetX,this.dragStartViewTime=this.viewStartTime,this.canvas.style.cursor="grabbing",e.preventDefault()}updateDrag(e){if(!this.isDragging)return;const i=(e.offsetX-this.dragStartX)/this.options.width*this.viewDuration,r=this.dragStartViewTime-i,s=Math.max(0,this.totalDuration-this.viewDuration);this.viewStartTime=Math.max(0,Math.min(s,r)),this.draw()}endDrag(){this.isDragging&&(this.isDragging=!1,this.updateCursor())}handleTouchStart(e){if(e.preventDefault(),e.touches.length===2){this.isZooming=!0,this.isDragging=!1;const n=e.touches[0],i=e.touches[1];this.lastPinchDistance=Math.hypot(n.clientX-i.clientX,n.clientY-i.clientY);const r=this.canvas.getBoundingClientRect();this.pinchCenterX=(n.clientX+i.clientX)/2-r.left}else if(e.touches.length===1&&!this.isZooming){const n=e.touches[0],i=this.canvas.getBoundingClientRect();new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});const r=n.clientX-i.left;n.clientY-i.top,this.isScrollingEnabled&&(this.isDragging=!0,this.dragStartX=r,this.dragStartViewTime=this.viewStartTime,this.canvas.style.cursor="grabbing")}}handleTouchMove(e){if(e.preventDefault(),e.touches.length===2&&this.isZooming){const n=e.touches[0],i=e.touches[1],r=Math.hypot(n.clientX-i.clientX,n.clientY-i.clientY);if(this.lastPinchDistance>0){const s=this.lastPinchDistance/r;this.zoom(s,this.pinchCenterX)}this.lastPinchDistance=r}else if(e.touches.length===1&&this.isDragging&&!this.isZooming){const n=e.touches[0],i=this.canvas.getBoundingClientRect(),o=(n.clientX-i.left-this.dragStartX)/this.options.width*this.viewDuration,a=this.dragStartViewTime-o,c=Math.max(0,this.totalDuration-this.viewDuration);this.viewStartTime=Math.max(0,Math.min(c,a)),this.draw()}}handleTouchEnd(e){e.touches.length<2&&(this.isZooming=!1,this.lastPinchDistance=0),e.touches.length===0&&this.endDrag()}zoom(e,n){if(!this.totalDuration)return;this.viewDuration,this.viewStartTime;const i=this.viewStartTime+n/this.options.width*this.viewDuration;let r=this.viewDuration*e;if(r=Math.max(this.options.minZoomDuration,r),r=Math.min(this.options.maxZoomDuration,r),r=Math.min(r,this.totalDuration),Math.abs(r-this.viewDuration)<10)return;const s=n/this.options.width;let o=i-r*s;const a=this.totalDuration-r;o=Math.max(0,Math.min(a,o)),o>=0&&o+r<=this.totalDuration+1?(this.viewDuration=r,this.viewStartTime=o,this.savedZoomPercent=this.options.viewportDuration/this.viewDuration*100,this.isScrollingEnabled=this.viewDuration<this.totalDuration,this.updateCursor(),this.draw()):console.warn("Zoom bounds check failed, reverting",{newViewStartTime:o,newViewDuration:r,totalDuration:this.totalDuration})}resetZoom(){this.totalDuration&&(this.viewStartTime=0,this.viewDuration=this.totalDuration>this.options.scrollThreshold?this.options.viewportDuration:this.totalDuration,this.updateScrollingState(),this.savedZoomPercent=100,this.draw())}drawVisualization(e){this.loudnessData=this.loudnessAnalyzer.calculateLoudnessFromBuffer(e.audioBuffer),this.intonationData=this.tuner.analyze(e.audioBuffer),this.clicks=e.playClicks,this.recordSpeed=e.recordSpeed,this.latency=e.latency,this.updateScrollingState(),this.draw()}updateScrollingState(){if(this.loudnessData.length===0){this.totalDuration=0,this.isScrollingEnabled=!1,this.updateCursor();return}if(this.totalDuration=this.loudnessData[this.loudnessData.length-1].timestamp,this.isScrollingEnabled=this.totalDuration>this.options.scrollThreshold,this.viewStartTime=0,!this.isScrollingEnabled)this.viewDuration=this.totalDuration;else{const e=this.options.viewportDuration*(100/this.savedZoomPercent),n=Math.max(this.options.minZoomDuration,Math.min(this.options.maxZoomDuration,e));this.viewDuration=Math.min(n,this.totalDuration),this.isScrollingEnabled=this.viewDuration<this.totalDuration}this.updateCursor()}startPlayback(e=1){this.playbackStartTime=Date.now(),this.playbackRate=e,this.isPlaybackActive=!0,this.endDrag(),this.isScrollingEnabled&&(this.viewStartTime=0),this.animatePlayback()}stopPlayback(){this.isPlaybackActive=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.updateCursor(),this.draw()}clear(){this.loudnessData=[],this.intonationData=null,this.clicks=[],this.totalDuration=0,this.isScrollingEnabled=!1,this.viewStartTime=0,this.stopPlayback(),this.draw()}setStats(e){if(e===void 0)this.statsDiv.innerText="";else{let n=(e*1e3).toFixed(0),i="";this.isScrollingEnabled&&(i=` (${Math.round(this.options.viewportDuration/this.viewDuration*100)}% zoom)`),this.statsDiv.innerText=`Max Vol: ${n}${i}`;let r=1/0;for(const s of this.clicks)r=Math.min(r,s.delay);r/=this.recordSpeed,this.statsDiv.innerText+=`, Click Dur: ${Math.round(r)}ms`}}draw(){const{width:e,height:n,backgroundColor:i,waveformColor:r,gridColor:s,showGrid:o}=this.options;if(this.ctx.fillStyle=i,this.ctx.fillRect(0,0,e,n),o&&this.drawGrid(),this.loudnessData.length===0){this.drawEmptyState();return}this.drawWaveform(this.loudnessData),this.clicks&&this.drawMetronomeBeats(),this.intonationData&&this.drawIntonation(),this.isPlaybackActive&&this.drawPlaybackPosition()}drawGrid(){const{width:e,height:n,gridColor:i}=this.options;this.ctx.strokeStyle=i,this.ctx.lineWidth=.5;const r=n/2;this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(0,r),this.ctx.lineTo(e,r),this.ctx.stroke();const s=50,o=Math.max(...this.loudnessData.map(u=>u.loudness))*1e3,a=n*.4,c=s*a/o;if(c<=0)return;this.ctx.lineWidth=.5;let l=0;for(;l<n/2;)this.ctx.beginPath(),this.ctx.moveTo(0,r-l),this.ctx.lineTo(e,r-l),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,r+l),this.ctx.lineTo(e,r+l),this.ctx.stroke(),l+=c;if(this.isScrollingEnabled){this.ctx.strokeStyle=i+"80",this.ctx.lineWidth=.5;const u=1e3,d=Math.floor(this.viewStartTime/u)*u;for(let h=d;h<=this.viewStartTime+this.viewDuration;h+=u)if(h>=this.viewStartTime&&h<=this.viewStartTime+this.viewDuration){const p=this.timeToX(h);this.ctx.beginPath(),this.ctx.moveTo(p,0),this.ctx.lineTo(p,n),this.ctx.stroke()}}}timeToX(e){return(e-this.viewStartTime)/this.viewDuration*this.options.width}drawWaveform(e){if(e.length<2)return;const{width:n,height:i,waveformColor:r}=this.options,s=e.filter(u=>u.timestamp>=this.viewStartTime&&u.timestamp<=this.viewStartTime+this.viewDuration);if(s.length===0)return;const o=Math.max(...e.map(u=>u.loudness));if(o===0)return;this.setStats(o);const a=i/2,c=i*.4;this.ctx.strokeStyle=r,this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath();let l=!0;for(const u of s){const d=this.timeToX(u.timestamp),p=u.loudness/o*c,f=a-p;l?(this.ctx.moveTo(Math.max(0,d),f),l=!1):this.ctx.lineTo(Math.max(0,d),f)}this.ctx.stroke(),this.ctx.beginPath(),l=!0;for(const u of s){const d=this.timeToX(u.timestamp),p=u.loudness/o*c,f=a+p;l?(this.ctx.moveTo(Math.max(0,d),f),l=!1):this.ctx.lineTo(Math.max(0,d),f)}this.ctx.stroke(),this.ctx.fillStyle=r+"20",this.ctx.beginPath(),l=!0;for(const u of s){const d=this.timeToX(u.timestamp),p=u.loudness/o*c,f=a-p;l?(this.ctx.moveTo(Math.max(0,d),f),l=!1):this.ctx.lineTo(Math.max(0,d),f)}for(let u=s.length-1;u>=0;u--){const d=s[u],h=this.timeToX(d.timestamp),f=d.loudness/o*c,v=a+f;this.ctx.lineTo(Math.max(0,h),v)}this.ctx.closePath(),this.ctx.fill()}drawMetronomeBeats(){const{width:e,height:n}=this.options;this.ctx.lineWidth=1;let i=this.latency;for(const r of this.clicks){if(i>this.viewStartTime+this.viewDuration)return;if(r.recording){if(i>=this.viewStartTime&&i<=this.viewStartTime+this.viewDuration){const s=this.timeToX(i);s>=0&&s<=e&&r.level>0&&(this.ctx.strokeStyle=this.clickLines[r.level],this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,n),this.ctx.stroke())}i+=r.delay/this.recordSpeed}}}drawIntonation(){if(!this.intonationData)return;const e=60/this.intonationData.sampleRate*1e3,{height:n}=this.options,i=n/2;let r=0;this.ctx.lineWidth=2,this.ctx.strokeStyle="#29755c",this.ctx.beginPath();let s=!1;this.intonationData.points.forEach(o=>{if(o&&r>=this.viewStartTime&&r<=this.viewStartTime+this.viewDuration){const a=this.timeToX(r),c=i-o.cents*n/100;s?this.ctx.lineTo(a,c):(this.ctx.moveTo(a,c),s=!0)}else o||s&&(this.ctx.stroke(),this.ctx.beginPath(),s=!1);r+=e}),s&&this.ctx.stroke()}updateViewport(e){if(!this.isScrollingEnabled)return;const n=this.viewStartTime+this.viewDuration*this.playbackMarkerPosition;if(e>=n&&this.viewStartTime+this.viewDuration<this.totalDuration){const i=e-this.viewDuration*this.playbackMarkerPosition,r=this.totalDuration-this.viewDuration;this.viewStartTime=Math.min(i,Math.max(0,r))}}drawPlaybackPosition(){const{width:e,height:n}=this.options,r=(Date.now()-this.playbackStartTime)*this.playbackRate;if(r>this.totalDuration){this.stopPlayback();return}this.updateViewport(r);let s;if(this.isScrollingEnabled){const o=this.viewStartTime+this.viewDuration*this.playbackMarkerPosition,a=this.viewStartTime+this.viewDuration;r>=o&&a<this.totalDuration?s=e*this.playbackMarkerPosition:s=this.timeToX(r)}else s=this.timeToX(r);this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,n),this.ctx.stroke()}animatePlayback(){this.isPlaybackActive&&(this.draw(),this.animationFrameId=requestAnimationFrame(()=>this.animatePlayback()))}drawEmptyState(){const{width:e,height:n}=this.options;this.ctx.fillStyle="#6c757d",this.ctx.font="16px system-ui, -apple-system, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.setStats()}}const _n={log:"log",debug:"debug",info:"info",warn:"warn",error:"error"},wt=console,re={};Object.keys(_n).forEach(t=>{re[t]=wt[t]});const Te="Datadog Browser SDK:",x={debug:re.debug.bind(wt,Te),log:re.log.bind(wt,Te),info:re.info.bind(wt,Te),warn:re.warn.bind(wt,Te),error:re.error.bind(wt,Te)},Sn="https://docs.datadoghq.com",Ea=`${Sn}/real_user_monitoring/browser/troubleshooting`,vi="More details:";function Xr(t,e){return(...n)=>{try{return t(...n)}catch(i){x.error(e,i)}}}function Tt(t){return t!==0&&Math.random()*100<=t}function Ve(t,e){return+t.toFixed(e)}function Ta(t){return Ye(t)&&t>=0&&t<=100}function Ye(t){return typeof t=="number"}const K=1e3,st=60*K,Yr=60*st,Ia=24*Yr,Zr=365*Ia;function wn(t){return{relative:t,timeStamp:Ca(t)}}function ka(t){return{relative:bi(t),timeStamp:t}}function Ca(t){const e=ht()-performance.now();return e>Ze()?Math.round(ge(e,t)):Aa(t)}function xa(){return Math.round(ht()-ge(Ze(),performance.now()))}function k(t){return Ye(t)?Ve(t*1e6,0):t}function ht(){return new Date().getTime()}function z(){return ht()}function at(){return performance.now()}function q(){return{relative:at(),timeStamp:z()}}function Jr(){return{relative:0,timeStamp:Ze()}}function B(t,e){return e-t}function ge(t,e){return t+e}function bi(t){return t-Ze()}function Aa(t){return Math.round(ge(Ze(),t))}function Ra(t){return t<Zr}let Un;function Ze(){return Un===void 0&&(Un=performance.timing.navigationStart),Un}const qe=1024,Qr=1024*qe,La=/[^\u0000-\u007F]/;function ts(t){return La.test(t)?window.TextEncoder!==void 0?new TextEncoder().encode(t).length:new Blob([t]).size:t.length}function Oa(t){const e=t.reduce((r,s)=>r+s.length,0),n=new Uint8Array(e);let i=0;for(const r of t)n.set(r,i),i+=r.length;return n}function We(t){return{...t}}function mn(t,e){return Object.keys(t).some(n=>t[n]===e)}function zt(t){return Object.keys(t).length===0}function es(t,e){const n={};for(const i of Object.keys(t))n[i]=e(t[i]);return n}function ft(){if(typeof globalThis=="object")return globalThis;Object.defineProperty(Object.prototype,"_dd_temp_",{get(){return this},configurable:!0});let t=_dd_temp_;return delete Object.prototype._dd_temp_,typeof t!="object"&&(typeof self=="object"?t=self:typeof window=="object"?t=window:t={}),t}function Rt(t,e){const n=ft();let i;return n.Zone&&typeof n.Zone.__symbol__=="function"&&(i=t[n.Zone.__symbol__(e)]),i||(i=t[e]),i}let ci,ns=!1;function Da(t){ci=t}function Na(t){ns=t}function I(t){return function(){return Vt(t,this,arguments)}}function Vt(t,e,n){try{return t.apply(e,n)}catch(i){he(i)}}function he(t){if(li(t),ci)try{ci(t)}catch(e){li(e)}}function li(...t){ns&&x.error("[MONITOR]",...t)}function H(t,e){return Rt(ft(),"setTimeout")(I(t),e)}function dt(t){Rt(ft(),"clearTimeout")(t)}function ve(t,e){return Rt(ft(),"setInterval")(I(t),e)}function En(t){Rt(ft(),"clearInterval")(t)}function or(t){const e=window.queueMicrotask;typeof e=="function"?e(I(t)):Promise.resolve().then(I(t))}class R{constructor(e){this.onFirstSubscribe=e,this.observers=[]}subscribe(e){return this.addObserver(e),{unsubscribe:()=>this.removeObserver(e)}}notify(e){this.observers.forEach(n=>n(e))}addObserver(e){this.observers.push(e),this.observers.length===1&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0)}removeObserver(e){this.observers=this.observers.filter(n=>e!==n),!this.observers.length&&this.onLastUnsubscribe&&this.onLastUnsubscribe()}}function is(...t){return new R(e=>{const n=t.map(i=>i.subscribe(r=>e.notify(r)));return()=>n.forEach(i=>i.unsubscribe())})}class rs extends R{constructor(e){super(),this.maxBufferSize=e,this.buffer=[]}notify(e){this.buffer.push(e),this.buffer.length>this.maxBufferSize&&this.buffer.shift(),super.notify(e)}subscribe(e){let n=!1;const i={unsubscribe:()=>{n=!0,this.removeObserver(e)}};return or(()=>{for(const r of this.buffer){if(n)return;e(r)}n||this.addObserver(e)}),i}unbuffer(){or(()=>{this.maxBufferSize=this.buffer.length=0})}}function Tn(t,e,n){const i=n&&n.leading!==void 0?n.leading:!0,r=n&&n.trailing!==void 0?n.trailing:!0;let s=!1,o,a;return{throttled:(...c)=>{if(s){o=c;return}i?t(...c):o=c,s=!0,a=H(()=>{r&&o&&t(...o),s=!1,o=void 0},e)},cancel:()=>{dt(a),s=!1,o=void 0}}}function N(){}function X(t){return t?(parseInt(t,10)^Math.random()*16>>parseInt(t,10)/4).toString(16):`10000000-1000-4000-8000-${1e11}`.replace(/[018]/g,X)}const gn=/([\w-]+)\s*=\s*([^;]+)/g;function je(t,e){for(gn.lastIndex=0;;){const n=gn.exec(t);if(n){if(n[1]===e)return n[2]}else break}}function Ma(t){const e=new Map;for(gn.lastIndex=0;;){const n=gn.exec(t);if(n)e.set(n[1],n[2]);else break}return e}function ss(t,e,n=""){const i=t.charCodeAt(e-1),s=i>=55296&&i<=56319?e+1:e;return t.length<=s?t:`${t.slice(0,s)}${n}`}function Pa(){return os()===0}function Pm(){return os()===1}let sn;function os(){return sn??(sn=Ua())}function Ua(t=window){var e;const n=t.navigator.userAgent;return t.chrome||/HeadlessChrome/.test(n)?0:((e=t.navigator.vendor)===null||e===void 0?void 0:e.indexOf("Apple"))===0||/safari/i.test(n)&&!/chrome|android/i.test(n)?1:2}function In(t,e,n=0,i){const r=new Date;r.setTime(r.getTime()+n);const s=`expires=${r.toUTCString()}`,o=i&&i.crossSite?"none":"strict",a=i&&i.domain?`;domain=${i.domain}`:"",c=i&&i.secure?";secure":"",l=i&&i.partitioned?";partitioned":"";document.cookie=`${t}=${e};${s};path=/;samesite=${o}${a}${c}${l}`}function yi(t){return je(document.cookie,t)}let Bn;function At(t){return Bn||(Bn=Ma(document.cookie)),Bn.get(t)}function as(t,e){In(t,"",0,e)}function Ba(t){if(document.cookie===void 0||document.cookie===null)return!1;try{const e=`dd_cookie_test_${X()}`,n="test";In(e,n,st,t);const i=yi(e)===n;return as(e,t),i}catch(e){return x.error(e),!1}}let Fn;function cs(){if(Fn===void 0){const t=`dd_site_test_${X()}`,e="test",n=window.location.hostname.split(".");let i=n.pop();for(;n.length&&!yi(t);)i=`${n.pop()}.${i}`,In(t,e,K,{domain:i});as(t,{domain:i}),Fn=i}return Fn}const Je="_dd_s";function Fa(t,e){for(let n=t.length-1;n>=0;n-=1){const i=t[n];if(e(i,n,t))return i}}function ls(t){return Object.values(t)}function _i(t){return Object.entries(t)}const Gt=4*Yr,us=15*st,Va=Zr,ds="0",He={COOKIE:"cookie",LOCAL_STORAGE:"local-storage"},hs=/^([a-zA-Z]+)=([a-z0-9-]+)$/,Si="&";function $a(t){return!!t&&(t.indexOf(Si)!==-1||hs.test(t))}const za="1";function Pt(t,e){const n={isExpired:za};return e.trackAnonymousUser&&(t?.anonymousId?n.anonymousId=t?.anonymousId:n.anonymousId=X()),n}function un(t){return zt(t)}function fs(t){return!un(t)}function $e(t){return t.isExpired!==void 0||!Ga(t)}function Ga(t){return(t.created===void 0||ht()-Number(t.created)<Gt)&&(t.expire===void 0||ht()<Number(t.expire))}function ps(t){t.expire=String(ht()+us)}function ms(t){return _i(t).map(([e,n])=>e==="anonymousId"?`aid=${n}`:`${e}=${n}`).join(Si)}function gs(t){const e={};return $a(t)&&t.split(Si).forEach(n=>{const i=hs.exec(n);if(i!==null){const[,r,s]=i;r==="aid"?e.anonymousId=s:e[r]=s}}),e}const qa="_dd",Wa="_dd_r",ja="_dd_l",Ha="rum",Ka="logs";function Xa(t){if(!At(Je)){const n=At(qa),i=At(Wa),r=At(ja),s={};n&&(s.id=n),r&&/^[01]$/.test(r)&&(s[Ka]=r),i&&/^[012]$/.test(i)&&(s[Ha]=i),fs(s)&&(ps(s),t.persistSession(s))}}function ar(t){const e=Za(t);return Ba(e)?{type:He.COOKIE,cookieOptions:e}:void 0}function Ya(t,e){const n={isLockEnabled:Pa(),persistSession:i=>cr(e,t,i,us),retrieveSession:vs,expireSession:i=>cr(e,t,Pt(i,t),Gt)};return Xa(n),n}function cr(t,e,n,i){In(Je,ms(n),e.trackAnonymousUser?Va:i,t)}function vs(){const t=yi(Je);return gs(t)}function Za(t){const e={};return e.secure=!!t.useSecureSessionCookie||!!t.usePartitionedCrossSiteSessionCookie,e.crossSite=!!t.usePartitionedCrossSiteSessionCookie,e.partitioned=!!t.usePartitionedCrossSiteSessionCookie,t.trackSessionAcrossSubdomains&&(e.domain=cs()),e}const Ja="_dd_test_";function lr(){try{const t=X(),e=`${Ja}${t}`;localStorage.setItem(e,t);const n=localStorage.getItem(e);return localStorage.removeItem(e),t===n?{type:He.LOCAL_STORAGE}:void 0}catch{return}}function Qa(t){return{isLockEnabled:!1,persistSession:bs,retrieveSession:tc,expireSession:e=>ec(e,t)}}function bs(t){localStorage.setItem(Je,ms(t))}function tc(){const t=localStorage.getItem(Je);return gs(t)}function ec(t,e){bs(Pt(t,e))}function be(t,e,n){if(typeof t!="object"||t===null)return JSON.stringify(t);const i=se(Object.prototype),r=se(Array.prototype),s=se(Object.getPrototypeOf(t)),o=se(t);try{return JSON.stringify(t,e,n)}catch{return"<error: unable to serialize object>"}finally{i(),r(),s(),o()}}function se(t){const e=t,n=e.toJSON;return n?(delete e.toJSON,()=>{e.toJSON=n}):N}const nc=220*qe,ic="$",rc=3;function F(t,e=nc){const n=se(Object.prototype),i=se(Array.prototype),r=[],s=new WeakMap,o=Vn(t,ic,void 0,r,s),a=JSON.stringify(o);let c=a?a.length:0;if(c>e){$n(e,"discarded",t);return}for(;r.length>0&&c<e;){const l=r.shift();let u=0;if(Array.isArray(l.source))for(let d=0;d<l.source.length;d++){const h=Vn(l.source[d],l.path,d,r,s);if(h!==void 0?c+=JSON.stringify(h).length:c+=4,c+=u,u=1,c>e){$n(e,"truncated",t);break}l.target[d]=h}else for(const d in l.source)if(Object.prototype.hasOwnProperty.call(l.source,d)){const h=Vn(l.source[d],l.path,d,r,s);if(h!==void 0&&(c+=JSON.stringify(h).length+u+d.length+rc,u=1),c>e){$n(e,"truncated",t);break}l.target[d]=h}}return n(),i(),o}function Vn(t,e,n,i,r){const s=ac(t);if(!s||typeof s!="object")return sc(s);const o=ui(s);if(o!=="[Object]"&&o!=="[Array]"&&o!=="[Error]")return o;const a=t;if(r.has(a))return`[Reference seen at ${r.get(a)}]`;const c=n!==void 0?`${e}.${n}`:e,l=Array.isArray(s)?[]:{};return r.set(a,c),i.push({source:s,target:l,path:c}),l}function sc(t){return typeof t=="bigint"?`[BigInt] ${t.toString()}`:typeof t=="function"?`[Function] ${t.name||"unknown"}`:typeof t=="symbol"?`[Symbol] ${t.description||t.toString()}`:t}function ui(t){try{if(t instanceof Event)return oc(t);if(t instanceof RegExp)return`[RegExp] ${t.toString()}`;const n=Object.prototype.toString.call(t).match(/\[object (.*)\]/);if(n&&n[1])return`[${n[1]}]`}catch{}return"[Unserializable]"}function oc(t){return{type:t.type,isTrusted:t.isTrusted,currentTarget:t.currentTarget?ui(t.currentTarget):null,target:t.target?ui(t.target):null}}function ac(t){const e=t;if(e&&typeof e.toJSON=="function")try{return e.toJSON()}catch{}return t}function $n(t,e,n){x.warn(`The data provided has been ${e} as it is over the limit of ${t} characters:`,n)}const fe="?";function Qe(t){var e,n;const i=[];let r=zn(t,"stack");const s=String(t);if(r&&r.startsWith(s)&&(r=r.slice(s.length)),r&&r.split(`
`).forEach(o=>{const a=uc(o)||hc(o)||pc(o)||vc(o);a&&(!a.func&&a.line&&(a.func=fe),i.push(a))}),i.length>0&&Sc()&&t instanceof Error){const o=[];let a=t;for(;(a=Object.getPrototypeOf(a))&&_s(a);){const c=((e=a.constructor)===null||e===void 0?void 0:e.name)||fe;o.push(c)}for(let c=o.length-1;c>=0&&((n=i[0])===null||n===void 0?void 0:n.func)===o[c];c--)i.shift()}return{message:zn(t,"message"),name:zn(t,"name"),stack:i}}const ys="((?:file|https?|blob|chrome-extension|electron|native|eval|webpack|snippet|<anonymous>|\\w+\\.|\\/).*?)",pe="(?::(\\d+))",cc=new RegExp(`^\\s*at (.*?) ?\\(${ys}${pe}?${pe}?\\)?\\s*$`,"i"),lc=new RegExp(`\\((\\S*)${pe}${pe}\\)`);function uc(t){const e=cc.exec(t);if(!e)return;const n=e[2]&&e[2].indexOf("native")===0,i=e[2]&&e[2].indexOf("eval")===0,r=lc.exec(e[2]);return i&&r&&(e[2]=r[1],e[3]=r[2],e[4]=r[3]),{args:n?[e[2]]:[],column:e[4]?+e[4]:void 0,func:e[1]||fe,line:e[3]?+e[3]:void 0,url:n?void 0:e[2]}}const dc=new RegExp(`^\\s*at ?${ys}${pe}?${pe}??\\s*$`,"i");function hc(t){const e=dc.exec(t);if(e)return{args:[],column:e[3]?+e[3]:void 0,func:fe,line:e[2]?+e[2]:void 0,url:e[1]}}const fc=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;function pc(t){const e=fc.exec(t);if(e)return{args:[],column:e[4]?+e[4]:void 0,func:e[1]||fe,line:+e[3],url:e[2]}}const mc=/^\s*(.*?)(?:\((.*?)\))?(?:(?:(?:^|@)((?:file|https?|blob|chrome|webpack|resource|capacitor|\[native).*?|[^@]*bundle|\[wasm code\])(?::(\d+))?(?::(\d+))?)|@)\s*$/i,gc=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function vc(t){const e=mc.exec(t);if(!e)return;const n=e[3]&&e[3].indexOf(" > eval")>-1,i=gc.exec(e[3]);return n&&i&&(e[3]=i[1],e[4]=i[2],e[5]=void 0),{args:e[2]?e[2].split(","):[],column:e[5]?+e[5]:void 0,func:e[1]||fe,line:e[4]?+e[4]:void 0,url:e[3]}}function zn(t,e){if(typeof t!="object"||!t||!(e in t))return;const n=t[e];return typeof n=="string"?n:void 0}function bc(t,e,n,i){if(e===void 0)return;const{name:r,message:s}=_c(t);return{name:r,message:s,stack:[{url:e,column:i,line:n}]}}const yc=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?([\s\S]*)$/;function _c(t){let e,n;return{}.toString.call(t)==="[object String]"&&([,e,n]=yc.exec(t)),{name:e,message:n}}function _s(t){return String(t.constructor).startsWith("class ")}let on;function Sc(){if(on!==void 0)return on;class t extends Error{constructor(){super(),this.name="Error"}}const[e,n]=[t,Error].map(i=>new i);return on=_s(Object.getPrototypeOf(e))&&n.stack!==e.stack,on}function vn(t){const n=new Error(t);n.name="HandlingStack";let i;return Vt(()=>{const r=Qe(n);r.stack=r.stack.slice(2),i=tn(r)}),i}function tn(t){let e=Ss(t);return t.stack.forEach(n=>{const i=n.func==="?"?"<anonymous>":n.func,r=n.args&&n.args.length>0?`(${n.args.join(", ")})`:"",s=n.line?`:${n.line}`:"",o=n.line&&n.column?`:${n.column}`:"";e+=`
  at ${i}${r} @ ${n.url}${s}${o}`}),e}function Ss(t){return`${t.name||"Error"}: ${t.message}`}const ws="No stack, consider using an instance of Error";function wi({stackTrace:t,originalError:e,handlingStack:n,componentStack:i,startClocks:r,nonErrorPrefix:s,useFallbackStack:o=!0,source:a,handling:c}){const l=qt(e);return!t&&l&&(t=Qe(e)),{startClocks:r,source:a,handling:c,handlingStack:n,componentStack:i,originalError:e,type:t?t.name:void 0,message:wc(t,l,s,e),stack:t?tn(t):o?ws:void 0,causes:l?Ic(e,a):void 0,fingerprint:Ec(e),context:Tc(e)}}function wc(t,e,n,i){return t?.message&&t?.name?t.message:e?"Empty message":`${n} ${be(F(i))}`}function Ec(t){return qt(t)&&"dd_fingerprint"in t?String(t.dd_fingerprint):void 0}function Tc(t){if(t!==null&&typeof t=="object"&&"dd_context"in t)return t.dd_context}function qt(t){return t instanceof Error||Object.prototype.toString.call(t)==="[object Error]"}function Ic(t,e){let n=t;const i=[];for(;qt(n?.cause)&&i.length<10;){const r=Qe(n.cause);i.push({message:n.cause.message,source:e,type:r?.name,stack:r&&tn(r)}),n=n.cause}return i.length?i:void 0}var $t;(function(t){t.TRACK_INTAKE_REQUESTS="track_intake_requests",t.WRITABLE_RESOURCE_GRAPHQL="writable_resource_graphql",t.EARLY_REQUEST_COLLECTION="early_request_collection",t.WATCH_COOKIE_WITHOUT_LOCK="watch_cookie_without_lock",t.USE_TREE_WALKER_FOR_ACTION_NAME="use_tree_walker_for_action_name"})($t||($t={}));const Ei=new Set;function kc(t){Array.isArray(t)&&Cc(t.filter(e=>mn($t,e)))}function Cc(t){t.forEach(e=>{Ei.add(e)})}function kn(t){return Ei.has(t)}function xc(){return Ei}const Es="datad0g.com",Ac="dd0g-gov.com",Ft="datadoghq.com",Rc="datadoghq.eu",Lc="ddog-gov.com",Oc="pci.browser-intake-datadoghq.com",Dc=["ddsource","dd-api-key","dd-request-id"];function Ts(t,e){const n=window.__ddBrowserSdkExtensionCallback;n&&n({type:t,payload:e})}function Wt(t){return t===null?"null":Array.isArray(t)?"array":typeof t}function bn(t,e,n=Nc()){if(e===void 0)return t;if(typeof e!="object"||e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const r=e.flags||[e.global?"g":"",e.ignoreCase?"i":"",e.multiline?"m":"",e.sticky?"y":"",e.unicode?"u":""].join("");return new RegExp(e.source,r)}if(n.hasAlreadyBeenSeen(e))return;if(Array.isArray(e)){const r=Array.isArray(t)?t:[];for(let s=0;s<e.length;++s)r[s]=bn(r[s],e[s],n);return r}const i=Wt(t)==="object"?t:{};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=bn(i[r],e[r],n));return i}function Ti(t){return bn(void 0,t)}function It(...t){let e;for(const n of t)n!=null&&(e=bn(e,n));return e}function Nc(){if(typeof WeakSet<"u"){const e=new WeakSet;return{hasAlreadyBeenSeen(n){const i=e.has(n);return i||e.add(n),i}}}const t=[];return{hasAlreadyBeenSeen(e){const n=t.indexOf(e)>=0;return n||t.push(e),n}}}function Is(){var t;const e=window.navigator;return{status:e.onLine?"connected":"not_connected",interfaces:e.connection&&e.connection.type?[e.connection.type]:void 0,effective_type:(t=e.connection)===null||t===void 0?void 0:t.effectiveType}}function Mc(t){return t>=500}function Pc(t){try{return t.clone()}catch{return}}const ye={AGENT:"agent",CONSOLE:"console",CUSTOM:"custom",LOGGER:"logger",NETWORK:"network",SOURCE:"source",REPORT:"report"},Uc=80*qe,Bc=32,ks=3*Qr,Fc=st,Cs=K;function xs(t,e,n,i,r,s){e.transportStatus===0&&e.queuedPayloads.size()===0&&e.bandwidthMonitor.canHandle(t)?Rs(t,e,n,s,{onSuccess:()=>Ls(0,e,n,i,r,s),onFailure:()=>{e.queuedPayloads.enqueue(t)||s.notify({type:"queue-full",bandwidth:e.bandwidthMonitor.stats(),payload:t}),As(e,n,i,r,s)}}):e.queuedPayloads.enqueue(t)||s.notify({type:"queue-full",bandwidth:e.bandwidthMonitor.stats(),payload:t})}function As(t,e,n,i,r){t.transportStatus===2&&H(()=>{const s=t.queuedPayloads.first();Rs(s,t,e,r,{onSuccess:()=>{t.queuedPayloads.dequeue(),t.currentBackoffTime=Cs,Ls(1,t,e,n,i,r)},onFailure:()=>{t.currentBackoffTime=Math.min(Fc,t.currentBackoffTime*2),As(t,e,n,i,r)}})},t.currentBackoffTime)}function Rs(t,e,n,i,{onSuccess:r,onFailure:s}){e.bandwidthMonitor.add(t),n(t,o=>{e.bandwidthMonitor.remove(t),Vc(o)?(e.transportStatus=e.bandwidthMonitor.ongoingRequestCount>0?1:2,t.retry={count:t.retry?t.retry.count+1:1,lastFailureStatus:o.status},i.notify({type:"failure",bandwidth:e.bandwidthMonitor.stats(),payload:t}),s()):(e.transportStatus=0,i.notify({type:"success",bandwidth:e.bandwidthMonitor.stats(),payload:t}),r())})}function Ls(t,e,n,i,r,s){t===0&&e.queuedPayloads.isFull()&&!e.queueFullReported&&(r({message:`Reached max ${i} events size queued for upload: ${ks/Qr}MiB`,source:ye.AGENT,startClocks:q()}),e.queueFullReported=!0);const o=e.queuedPayloads;for(e.queuedPayloads=Os();o.size()>0;)xs(o.dequeue(),e,n,i,r,s)}function Vc(t){return t.type!=="opaque"&&(t.status===0&&!navigator.onLine||t.status===408||t.status===429||Mc(t.status))}function $c(){return{transportStatus:0,currentBackoffTime:Cs,bandwidthMonitor:zc(),queuedPayloads:Os(),queueFullReported:!1}}function Os(){const t=[];return{bytesCount:0,enqueue(e){return this.isFull()?!1:(t.push(e),this.bytesCount+=e.bytesCount,!0)},first(){return t[0]},dequeue(){const e=t.shift();return e&&(this.bytesCount-=e.bytesCount),e},size(){return t.length},isFull(){return this.bytesCount>=ks}}}function zc(){return{ongoingRequestCount:0,ongoingByteCount:0,canHandle(t){return this.ongoingRequestCount===0||this.ongoingByteCount+t.bytesCount<=Uc&&this.ongoingRequestCount<Bc},add(t){this.ongoingRequestCount+=1,this.ongoingByteCount+=t.bytesCount},remove(t){this.ongoingRequestCount-=1,this.ongoingByteCount-=t.bytesCount},stats(){return{ongoingByteCount:this.ongoingByteCount,ongoingRequestCount:this.ongoingRequestCount}}}}function Ds(t,e,n){const i=new R,r=$c();return{observable:i,send:s=>{for(const o of t)xs(s,r,(a,c)=>Wc(o,e,a,c),o.trackType,n,i)},sendOnExit:s=>{for(const o of t)Gc(o,e,s)}}}function Gc(t,e,n){if(!!navigator.sendBeacon&&n.bytesCount<e)try{const r=t.build("beacon",n);if(navigator.sendBeacon(r,n.data))return}catch(r){qc(r)}di(t,n)}let ur=!1;function qc(t){ur||(ur=!0,he(t))}function Wc(t,e,n,i){if(jc()&&n.bytesCount<e){const s=t.build("fetch-keepalive",n);fetch(s,{method:"POST",body:n.data,keepalive:!0,mode:"cors"}).then(I(o=>i?.({status:o.status,type:o.type}))).catch(I(()=>di(t,n,i)))}else di(t,n,i)}function di(t,e,n){const i=t.build("fetch",e);fetch(i,{method:"POST",body:e.data,mode:"cors"}).then(I(r=>n?.({status:r.status,type:r.type}))).catch(I(()=>n?.({status:0})))}function jc(){try{return window.Request&&"keepalive"in new Request("http://a")}catch{return!1}}function en(){const t=Hc();if(t)return{getCapabilities(){var e;return JSON.parse(((e=t.getCapabilities)===null||e===void 0?void 0:e.call(t))||"[]")},getPrivacyLevel(){var e;return(e=t.getPrivacyLevel)===null||e===void 0?void 0:e.call(t)},getAllowedWebViewHosts(){return JSON.parse(t.getAllowedWebViewHosts())},send(e,n,i){const r=i?{id:i}:void 0;t.send(JSON.stringify({eventType:e,event:n,view:r}))}}}function Ns(t){const e=en();return!!e&&e.getCapabilities().includes(t)}function me(t){var e;t===void 0&&(t=(e=ft().location)===null||e===void 0?void 0:e.hostname);const n=en();return!!n&&n.getAllowedWebViewHosts().some(i=>t===i||t.endsWith(`.${i}`))}function Hc(){return ft().DatadogEventBridge}function U(t,e,n,i,r){return Lt(t,e,[n],i,r)}function Lt(t,e,n,i,{once:r,capture:s,passive:o}={}){const a=I(h=>{!h.isTrusted&&!h.__ddIsTrusted&&!t.allowUntrustedEvents||(r&&d(),i(h))}),c=o?{capture:s,passive:o}:s,l=window.EventTarget&&e instanceof EventTarget?window.EventTarget.prototype:e,u=Rt(l,"addEventListener");n.forEach(h=>u.call(e,h,a,c));function d(){const h=Rt(l,"removeEventListener");n.forEach(p=>h.call(e,p,a,c))}return{stop:d}}const ce={HIDDEN:"visibility_hidden",UNLOADING:"before_unload",PAGEHIDE:"page_hide",FROZEN:"page_frozen"};function Kc(t){return new R(e=>{const{stop:n}=Lt(t,window,["visibilitychange","freeze"],r=>{r.type==="visibilitychange"&&document.visibilityState==="hidden"?e.notify({reason:ce.HIDDEN}):r.type==="freeze"&&e.notify({reason:ce.FROZEN})},{capture:!0}),i=U(t,window,"beforeunload",()=>{e.notify({reason:ce.UNLOADING})}).stop;return()=>{n(),i()}})}function Xc(t){return ls(ce).includes(t)}function Ms({encoder:t,request:e,flushController:n,messageBytesLimit:i}){let r={};const s=n.flushObservable.subscribe(d=>u(d));function o(d,h,p){n.notifyBeforeAddMessage(h),p!==void 0?(r[p]=d,n.notifyAfterAddMessage()):t.write(t.isEmpty?d:`
${d}`,f=>{n.notifyAfterAddMessage(f-h)})}function a(d){return d!==void 0&&r[d]!==void 0}function c(d){const h=r[d];delete r[d];const p=t.estimateEncodedBytesCount(h);n.notifyAfterRemoveMessage(p)}function l(d,h){const p=be(d),f=t.estimateEncodedBytesCount(p);if(f>=i){x.warn(`Discarded a message whose size was bigger than the maximum allowed size ${i}KB. ${vi} ${Ea}/#technical-limitations`);return}a(h)&&c(h),o(p,f,h)}function u(d){const h=ls(r).join(`
`);r={};const p=Xc(d.reason),f=p?e.sendOnExit:e.send;if(p&&t.isAsync){const v=t.finishSync();v.outputBytesCount&&f(dr(v));const S=[v.pendingData,h].filter(Boolean).join(`
`);S&&f({data:S,bytesCount:ts(S)})}else h&&t.write(t.isEmpty?h:`
${h}`),t.finish(v=>{f(dr(v))})}return{flushController:n,add:l,upsert:l,stop:s.unsubscribe}}function dr(t){let e;return typeof t.output=="string"?e=t.output:e=new Blob([t.output],{type:"text/plain"}),{data:e,bytesCount:t.outputBytesCount,encoding:t.encoding}}function Ps({messagesLimit:t,bytesLimit:e,durationLimit:n,pageMayExitObservable:i,sessionExpireObservable:r}){const s=i.subscribe(f=>u(f.reason)),o=r.subscribe(()=>u("session_expire")),a=new R(()=>()=>{s.unsubscribe(),o.unsubscribe()});let c=0,l=0;function u(f){if(l===0)return;const v=l,S=c;l=0,c=0,p(),a.notify({reason:f,messagesCount:v,bytesCount:S})}let d;function h(){d===void 0&&(d=H(()=>{u("duration_limit")},n))}function p(){dt(d),d=void 0}return{flushObservable:a,get messagesCount(){return l},notifyBeforeAddMessage(f){c+f>=e&&u("bytes_limit"),l+=1,c+=f,h()},notifyAfterAddMessage(f=0){c+=f,l>=t?u("messages_limit"):c>=e&&u("bytes_limit")},notifyAfterRemoveMessage(f){c-=f,l-=1,l===0&&p()}}}const Ot="DISCARDED",ct="SKIPPED";function Yc(){const t={};return{register(e,n){return t[e]||(t[e]=[]),t[e].push(n),{unregister:()=>{t[e]=t[e].filter(i=>i!==n)}}},triggerHook(e,n){const i=t[e]||[],r=[];for(const s of i){const o=s(n);if(o===Ot)return Ot;o!==ct&&r.push(o)}return It(...r)}}}const bt={LOG:"log",CONFIGURATION:"configuration",USAGE:"usage"},Zc=["https://www.datadoghq-browser-agent.com","https://www.datad0g-browser-agent.com","https://d3uc069fcn7uxw.cloudfront.net","https://d20xtzwzcl0ceb.cloudfront.net","http://localhost","<anonymous>"],Jc=[Lc];let Gn;function _e(){return Gn||(Gn=new rs(100)),Gn}function Qc(t,e,n,i,r,s){const o=new R,{stop:a}=el(e,i,r,s,o),{enabled:c}=tl(t,e,n,o);return{stop:a,enabled:c}}function tl(t,e,n,i){const r={},s=!Jc.includes(e.site)&&Tt(e.telemetrySampleRate),o={[bt.LOG]:s,[bt.CONFIGURATION]:s&&Tt(e.telemetryConfigurationSampleRate),[bt.USAGE]:s&&Tt(e.telemetryUsageSampleRate)},a=nl(),c=_e();return c.subscribe(({rawEvent:u,kind:d})=>{if(!o[u.type])return;let h=r[d];if(h||(h=r[d]=new Set),h.size>=e.maxTelemetryEventsPerPage)return;const p=be(u);if(h.has(p))return;const f=n.triggerHook(1,{startTime:q().relative});if(f===Ot)return;const v=l(f,t,u,a);i.notify(v),Ts("telemetry",v),h.add(p)}),c.unbuffer(),Da(Ii),{enabled:s};function l(u,d,h,p){const v={type:"telemetry",date:q().timeStamp,service:d,version:"6.18.1",source:"browser",_dd:{format_version:2},telemetry:It(h,{runtime_env:p,connectivity:Is(),sdk_setup:"npm"}),experimental_features:Array.from(xc())};return It(v,u)}}function el(t,e,n,i,r){const s=[];if(me()){const o=en(),a=r.subscribe(c=>o.send("internal_telemetry",c));s.push(a.unsubscribe)}else{const o=[t.rumEndpointBuilder];t.replica&&il(t)&&o.push(t.replica.rumEndpointBuilder);const a=Ms({encoder:i(4),request:Ds(o,t.batchBytesLimit,e),flushController:Ps({messagesLimit:t.batchMessagesLimit,bytesLimit:t.batchBytesLimit,durationLimit:t.flushTimeout,pageMayExitObservable:n,sessionExpireObservable:new R}),messageBytesLimit:t.messageBytesLimit});s.push(a.stop);const c=r.subscribe(a.add);s.push(c.unsubscribe)}return{stop:()=>s.forEach(o=>o())}}function nl(){return{is_local_file:window.location.protocol==="file:",is_worker:"WorkerGlobalScope"in self}}function il(t){return t.site===Es}function Dt(t,e){li(_n.debug,t,e),_e().notify({rawEvent:{type:bt.LOG,message:t,status:"debug",...e},kind:"debug"})}function Ii(t,e){_e().notify({rawEvent:{type:bt.LOG,status:"error",...sl(t),...e},kind:"error"})}function rl(t){_e().notify({rawEvent:{type:bt.CONFIGURATION,configuration:t},kind:bt.CONFIGURATION})}function ki(t,e){_e().notify({rawEvent:{type:bt.LOG,message:t,status:"debug",...e},kind:t})}function tt(t){_e().notify({rawEvent:{type:bt.USAGE,usage:t},kind:bt.USAGE})}function sl(t){if(qt(t)){const e=Qe(t);return{error:{kind:e.name,stack:tn(ol(e))},message:e.message}}return{error:{stack:ws},message:`Uncaught ${be(t)}`}}function ol(t){return t.stack=t.stack.filter(e=>!e.url||Zc.some(n=>e.url.startsWith(n))),t}const al=10,cl=100,ll=K,Us="--",Bs=[];let dn;function Ut(t,e,n=0){var i;const{isLockEnabled:r,persistSession:s,expireSession:o}=e,a=h=>s({...h,lock:l}),c=()=>{const{lock:h,...p}=e.retrieveSession();return{session:p,lock:h&&!dl(h)?h:void 0}};if(dn||(dn=t),t!==dn){Bs.push(t);return}if(r&&n>=cl){Dt("Aborted session operation after max lock retries",{currentStore:c()}),hr(e);return}let l,u=c();if(r){if(u.lock){an(t,e,n);return}if(l=ul(),a(u.session),u=c(),u.lock!==l){an(t,e,n);return}}let d=t.process(u.session);if(r&&(u=c(),u.lock!==l)){an(t,e,n);return}if(d&&($e(d)?o(d):(ps(d),r?a(d):s(d))),r&&!(d&&$e(d))){if(u=c(),u.lock!==l){an(t,e,n);return}s(u.session),d=u.session}(i=t.after)===null||i===void 0||i.call(t,d||u.session),hr(e)}function an(t,e,n){H(()=>{Ut(t,e,n+1)},al)}function hr(t){dn=void 0;const e=Bs.shift();e&&Ut(e,t)}function ul(){return X()+Us+z()}function dl(t){const[,e]=t.split(Us);return!e||B(Number(e),z())>ll}const fr=K;function hl(t){switch(t.sessionPersistence){case He.COOKIE:return ar(t);case He.LOCAL_STORAGE:return lr();case void 0:{let e=ar(t);return!e&&t.allowFallbackToLocalStorage&&(e=lr()),e}default:x.error(`Invalid session persistence '${String(t.sessionPersistence)}'`)}}function fl(t,e){return t.type===He.COOKIE?Ya(e,t.cookieOptions):Qa(e)}function pl(t,e,n,i,r=fl(t,e)){const s=new R,o=new R,a=new R,c=ve(p,fr);let l;v();const{throttled:u,cancel:d}=Tn(()=>{Ut({process:m=>{if(un(m))return;const y=f(m);return S(y),y},after:m=>{fs(m)&&!E()&&b(m),l=m}},r)},fr);function h(){Ut({process:m=>E()?f(m):void 0},r)}function p(){const m=r.retrieveSession();$e(m)?Ut({process:y=>$e(y)?Pt(y,e):void 0,after:f},r):f(m)}function f(m){return $e(m)&&(m=Pt(m,e)),E()&&(T(m)?g():(a.notify({previousState:l,newState:m}),l=m)),m}function v(){Ut({process:m=>{if(un(m))return Pt(m,e)},after:m=>{l=m}},r)}function S(m){if(un(m))return!1;const y=i(m[n]);m[n]=y,delete m.isExpired,y!==ds&&!m.id&&(m.id=X(),m.created=String(ht()))}function E(){return l?.[n]!==void 0}function T(m){return l.id!==m.id||l[n]!==m[n]}function g(){l=Pt(l,e),o.notify()}function b(m){l=m,s.notify()}function w(m){Ut({process:y=>({...y,...m}),after:f},r)}return{expandOrRenewSession:u,expandSession:h,getSession:()=>l,renewObservable:s,expireObservable:o,sessionStateUpdateObservable:a,restartSession:v,expire:()=>{d(),r.expireSession(l),f(Pt(l,e))},stop:()=>{En(c)},updateSessionState:w}}const hi={GRANTED:"granted",NOT_GRANTED:"not-granted"};function ml(t){const e=new R;return{tryToInit(n){t||(t=n)},update(n){t=n,e.notify()},isGranted(){return t===hi.GRANTED},observable:e}}function Ci(t){const e=Wt(t);return e==="string"||e==="function"||t instanceof RegExp}function xi(t,e,n=!1){return t.some(i=>{try{if(typeof i=="function")return i(e);if(i instanceof RegExp)return i.test(e);if(typeof i=="string")return n?e.startsWith(i):i===e}catch(r){x.error(r)}return!1})}const Fs=["chrome-extension://","moz-extension://"];function pr(t){return Fs.some(e=>t.includes(e))}function gl(t,e=""){return!pr(t)&&pr(e)}function vl(t=""){for(const e of Fs){const n=t.match(new RegExp(`${e}[^/]+`));if(n)return n[0]}}const mr="Running the Browser SDK in a Web extension content script is discouraged and will be forbidden in a future major release unless the `allowedTrackingOrigins` option is provided.",bl="SDK initialized on a non-allowed domain.";function yl(t,e=typeof location<"u"?location.origin:"",n=new Error().stack){const i=t.allowedTrackingOrigins;if(!i){if(gl(e,n)){x.warn(mr);const s=vl(n);Dt(mr,{extensionUrl:s||"unknown"})}return!0}const r=xi(i,e);return r||x.error(bl),r}function Ai(t){return Ri(t,location.href).href}function _l(t){try{return!!Ri(t)}catch{return!1}}function Sl(t){const e=Ri(t).pathname;return e[0]==="/"?e:`/${e}`}function Ri(t,e){const{URL:n}=wl();try{return e!==void 0?new n(t,e):new n(t)}catch(i){throw new Error(`Failed to construct URL: ${String(i)} ${be({url:t,base:e})}`)}}let qn;function wl(){if(!qn){let t,e;try{t=document.createElement("iframe"),t.style.display="none",document.body.appendChild(t),e=t.contentWindow}catch{e=window}qn={URL:e.URL},t?.remove()}return qn}function Bt(t,e,n){const i=El(t,e);return{build(r,s){const o=Tl(t,e,r,s,n);return i(o)},trackType:e}}function El(t,e){const n=`/api/v2/${e}`,i=t.proxy;if(typeof i=="string"){const s=Ai(i);return o=>`${s}?ddforward=${encodeURIComponent(`${n}?${o}`)}`}if(typeof i=="function")return s=>i({path:n,parameters:s});const r=Vs(e,t);return s=>`https://${r}${n}?${s}`}function Vs(t,e){const{site:n=Ft,internalAnalyticsSubdomain:i}=e;if(t==="logs"&&e.usePciIntake&&n===Ft)return Oc;if(i&&n===Ft)return`${i}.${Ft}`;if(n===Ac)return`http-intake.logs.${n}`;const r=n.split("."),s=r.pop();return`browser-intake-${r.join("-")}.${s}`}function Tl({clientToken:t,internalAnalyticsSubdomain:e},n,i,{retry:r,encoding:s},o=[]){const a=["ddsource=browser",`dd-api-key=${t}`,`dd-evp-origin-version=${encodeURIComponent("6.18.1")}`,"dd-evp-origin=browser",`dd-request-id=${X()}`].concat(o);return s&&a.push(`dd-evp-encoding=${s}`),n==="rum"&&(a.push(`batch_time=${z()}`,`_dd.api=${i}`),r&&a.push(`_dd.retry_count=${r.count}`,`_dd.retry_after=${r.lastFailureStatus}`)),e&&a.reverse(),a.join("&")}function Il(t){const e=t.site||Ft,n=kl(t);return{replica:Cl(t),site:e,...n}}function kl(t){return{logsEndpointBuilder:Bt(t,"logs"),rumEndpointBuilder:Bt(t,"rum"),profilingEndpointBuilder:Bt(t,"profile"),sessionReplayEndpointBuilder:Bt(t,"replay"),exposuresEndpointBuilder:Bt(t,"exposures")}}function Cl(t){if(!t.replica)return;const e={...t,site:Ft,clientToken:t.replica.clientToken};return{logsEndpointBuilder:Bt(e,"logs"),rumEndpointBuilder:Bt(e,"rum",[`application.id=${t.replica.applicationId}`])}}function xl(t){return Dc.every(e=>t.includes(e))}const ze={ALLOW:"allow",MASK:"mask",MASK_USER_INPUT:"mask-user-input"},fi={ALL:"all",SAMPLED:"sampled"};function Wn(t,e){return t!=null&&typeof t!="string"?(x.error(`${e} must be defined as a string`),!1):!0}function Al(t){return t&&typeof t=="string"&&!/(datadog|ddog|datad0g|dd0g)/.test(t)?(x.error(`Site should be a valid Datadog site. ${vi} ${Sn}/getting_started/site/.`),!1):!0}function oe(t,e){return t!==void 0&&!Ta(t)?(x.error(`${e} Sample Rate should be a number between 0 and 100`),!1):!0}function Rl(t){var e,n,i,r,s,o,a,c,l,u;if(!t||!t.clientToken){x.error("Client Token is not configured, we will not send any data.");return}if(t.allowedTrackingOrigins!==void 0&&!Array.isArray(t.allowedTrackingOrigins)){x.error("Allowed Tracking Origins must be an array");return}if(!(!Al(t.site)||!oe(t.sessionSampleRate,"Session")||!oe(t.telemetrySampleRate,"Telemetry")||!oe(t.telemetryConfigurationSampleRate,"Telemetry Configuration")||!oe(t.telemetryUsageSampleRate,"Telemetry Usage")||!Wn(t.version,"Version")||!Wn(t.env,"Env")||!Wn(t.service,"Service")||!yl(t))){if(t.trackingConsent!==void 0&&!mn(hi,t.trackingConsent)){x.error('Tracking Consent should be either "granted" or "not-granted"');return}return{beforeSend:t.beforeSend&&Xr(t.beforeSend,"beforeSend threw an error:"),sessionStoreStrategyType:hl(t),sessionSampleRate:(e=t.sessionSampleRate)!==null&&e!==void 0?e:100,telemetrySampleRate:(n=t.telemetrySampleRate)!==null&&n!==void 0?n:20,telemetryConfigurationSampleRate:(i=t.telemetryConfigurationSampleRate)!==null&&i!==void 0?i:5,telemetryUsageSampleRate:(r=t.telemetryUsageSampleRate)!==null&&r!==void 0?r:5,service:(s=t.service)!==null&&s!==void 0?s:void 0,env:(o=t.env)!==null&&o!==void 0?o:void 0,version:(a=t.version)!==null&&a!==void 0?a:void 0,datacenter:(c=t.datacenter)!==null&&c!==void 0?c:void 0,silentMultipleInit:!!t.silentMultipleInit,allowUntrustedEvents:!!t.allowUntrustedEvents,trackingConsent:(l=t.trackingConsent)!==null&&l!==void 0?l:hi.GRANTED,trackAnonymousUser:(u=t.trackAnonymousUser)!==null&&u!==void 0?u:!0,storeContextsAcrossPages:!!t.storeContextsAcrossPages,batchBytesLimit:16*qe,eventRateLimiterThreshold:3e3,maxTelemetryEventsPerPage:15,flushTimeout:30*K,batchMessagesLimit:50,messageBytesLimit:256*qe,...Il(t)}}}function Ll(t){return{session_sample_rate:t.sessionSampleRate,telemetry_sample_rate:t.telemetrySampleRate,telemetry_configuration_sample_rate:t.telemetryConfigurationSampleRate,telemetry_usage_sample_rate:t.telemetryUsageSampleRate,use_before_send:!!t.beforeSend,use_partitioned_cross_site_session_cookie:t.usePartitionedCrossSiteSessionCookie,use_secure_session_cookie:t.useSecureSessionCookie,use_proxy:!!t.proxy,silent_multiple_init:t.silentMultipleInit,track_session_across_subdomains:t.trackSessionAcrossSubdomains,track_anonymous_user:t.trackAnonymousUser,session_persistence:t.sessionPersistence,allow_fallback_to_local_storage:!!t.allowFallbackToLocalStorage,store_contexts_across_pages:!!t.storeContextsAcrossPages,allow_untrusted_events:!!t.allowUntrustedEvents,tracking_consent:t.trackingConsent,use_allowed_tracking_origins:Array.isArray(t.allowedTrackingOrigins)}}const Ol=200;function Dl(t){const{env:e,service:n,version:i,datacenter:r}=t,s=[Ie("sdk_version","6.18.1")];return e&&s.push(Ie("env",e)),n&&s.push(Ie("service",n)),i&&s.push(Ie("version",i)),r&&s.push(Ie("datacenter",r)),s}function Ie(t,e){const n=e?`${t}:${e}`:t;return(n.length>Ol||Ml(n))&&x.warn(`Tag ${n} doesn't meet tag requirements and will be sanitized. ${vi} ${Sn}/getting_started/tagging/#defining-tags`),Nl(n)}function Nl(t){return t.replace(/,/g,"_")}function Ml(t){return Pl()?new RegExp("[^\\p{Ll}\\p{Lo}0-9_:./-]","u").test(t):!1}function Pl(){try{return new RegExp("[\\p{Ll}]","u"),!0}catch{return!1}}function yt(t,e,n,{computeHandlingStack:i}={}){let r=t[e];if(typeof r!="function")if(e in t&&e.startsWith("on"))r=N;else return{stop:N};let s=!1;const o=function(){if(s)return r.apply(this,arguments);const a=Array.from(arguments);let c;Vt(n,null,[{target:this,parameters:a,onPostCall:u=>{c=u},handlingStack:i?vn("instrumented method"):void 0}]);const l=r.apply(this,a);return c&&Vt(c,null,[l]),l};return t[e]=o,{stop:()=>{s=!0,t[e]===o&&(t[e]=r)}}}function Um(t,e,n){const i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.set||!i.configurable)return{stop:N};const r=N;let s=(a,c)=>{H(()=>{s!==r&&n(a,c)},0)};const o=function(a){i.set.call(this,a),s(this,a)};return Object.defineProperty(t,e,{set:o}),{stop:()=>{var a;((a=Object.getOwnPropertyDescriptor(t,e))===null||a===void 0?void 0:a.set)===o&&Object.defineProperty(t,e,i),s=r}}}function Ul(){return new R(t=>{const e=(r,s)=>{const o=wi({stackTrace:s,originalError:r,startClocks:q(),nonErrorPrefix:"Uncaught",source:ye.SOURCE,handling:"unhandled"});t.notify(o)},{stop:n}=Bl(e),{stop:i}=Fl(e);return()=>{n(),i()}})}function Bl(t){return yt(ft(),"onerror",({parameters:[e,n,i,r,s]})=>{let o;qt(s)||(o=bc(e,n,i,r)),t(s??e,o)})}function Fl(t){return yt(ft(),"onunhandledrejection",({parameters:[e]})=>{t(e.reason||"Empty reason")})}function Vl(t){const e={version:"6.18.1",onReady(n){n()},...t};return Object.defineProperty(e,"_setDebug",{get(){return Na},enumerable:!1}),e}function $l(t,e,n){const i=t[e];i&&!i.q&&i.version&&x.warn("SDK is loaded more than once. This is unsupported and might have unexpected behavior."),t[e]=n,i&&i.q&&i.q.forEach(r=>Xr(r,"onReady callback threw an error:")())}function $s(t,e){e.silentMultipleInit||x.error(`${t} is already initialized.`)}const Ke={intervention:"intervention",cspViolation:"csp_violation"};function zl(t,e){const n=[];e.includes(Ke.cspViolation)&&n.push(ql(t));const i=e.filter(r=>r!==Ke.cspViolation);return i.length&&n.push(Gl(i)),is(...n)}function Gl(t){return new R(e=>{if(!window.ReportingObserver)return;const n=I((r,s)=>r.forEach(o=>e.notify(Wl(o)))),i=new window.ReportingObserver(n,{types:t,buffered:!0});return i.observe(),()=>{i.disconnect()}})}function ql(t){return new R(e=>{const{stop:n}=U(t,document,"securitypolicyviolation",i=>{e.notify(jl(i))});return n})}function Wl(t){const{type:e,body:n}=t;return zs({type:n.id,message:`${e}: ${n.message}`,originalError:t,stack:Gs(n.id,n.message,n.sourceFile,n.lineNumber,n.columnNumber)})}function jl(t){const e=`'${t.blockedURI}' blocked by '${t.effectiveDirective}' directive`;return zs({type:t.effectiveDirective,message:`${Ke.cspViolation}: ${e}`,originalError:t,csp:{disposition:t.disposition},stack:Gs(t.effectiveDirective,t.originalPolicy?`${e} of the policy "${ss(t.originalPolicy,100,"...")}"`:"no policy",t.sourceFile,t.lineNumber,t.columnNumber)})}function zs(t){return{startClocks:q(),source:ye.REPORT,handling:"unhandled",...t}}function Gs(t,e,n,i,r){return n?tn({name:t,message:e,stack:[{func:"?",url:n,line:i??void 0,column:r??void 0}]}):void 0}function qs(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}const cn=1/0,Hl=st;let ke=null;const hn=new Set;function Kl(){hn.forEach(t=>t())}function Se({expireDelay:t,maxEntries:e}){let n=[];ke||(ke=ve(()=>Kl(),Hl));const i=()=>{const u=at()-t;for(;n.length>0&&n[n.length-1].endTime<u;)n.pop()};hn.add(i);function r(u,d){const h={value:u,startTime:d,endTime:cn,remove:()=>{qs(n,h)},close:p=>{h.endTime=p}};return e&&n.length>=e&&n.pop(),n.unshift(h),h}function s(u=cn,d={returnInactive:!1}){for(const h of n)if(h.startTime<=u){if(d.returnInactive||u<=h.endTime)return h.value;break}}function o(u){const d=n[0];d&&d.endTime===cn&&d.close(u)}function a(u=cn,d=0){const h=ge(u,d);return n.filter(p=>p.startTime<=h&&u<=p.endTime).map(p=>p.value)}function c(){n=[]}function l(){hn.delete(i),hn.size===0&&ke&&(En(ke),ke=null)}return{add:r,find:s,closeActive:o,findAll:a,reset:c,stop:l}}const Xl="datadog-synthetics-public-id",Yl="datadog-synthetics-result-id",Zl="datadog-synthetics-injects-rum";function Ws(){return!!(window._DATADOG_SYNTHETICS_INJECTS_RUM||At(Zl))}function js(){const t=window._DATADOG_SYNTHETICS_PUBLIC_ID||At(Xl);return typeof t=="string"?t:void 0}function Hs(){const t=window._DATADOG_SYNTHETICS_RESULT_ID||At(Yl);return typeof t=="string"?t:void 0}function Ks(){return!!(js()&&Hs())}const Jl=st,Ql=Gt;function tu(t,e,n,i){const r=new R,s=new R,o=pl(t.sessionStoreStrategyType,t,e,n),a=Se({expireDelay:Ql});o.renewObservable.subscribe(()=>{a.add(c(),at()),r.notify()}),o.expireObservable.subscribe(()=>{s.notify(),a.closeActive(at())}),o.expandOrRenewSession(),a.add(c(),Jr().relative),i.observable.subscribe(()=>{i.isGranted()?o.expandOrRenewSession():o.expire()}),eu(t,()=>{i.isGranted()&&o.expandOrRenewSession()}),nu(t,()=>o.expandSession()),iu(t,()=>o.restartSession());function c(){const l=o.getSession();return l?{id:l.id,trackingType:l[e],isReplayForced:!!l.forcedReplay,anonymousId:l.anonymousId}:(ru().catch(()=>{}),{id:"invalid",trackingType:ds,isReplayForced:!1,anonymousId:void 0})}return{findSession:(l,u)=>a.find(l,u),renewObservable:r,expireObservable:s,sessionStateUpdateObservable:o.sessionStateUpdateObservable,expire:o.expire,updateSessionState:o.updateSessionState}}function eu(t,e){const{stop:n}=Lt(t,window,["click","touchstart","keydown","scroll"],e,{capture:!0,passive:!0})}function nu(t,e){const n=()=>{document.visibilityState==="visible"&&e()},{stop:i}=U(t,document,"visibilitychange",n);ve(n,Jl)}function iu(t,e){const{stop:n}=U(t,window,"resume",e,{capture:!0})}async function ru(){const t=vs();let e=[];"cookieStore"in window?e=await window.cookieStore.getAll("_dd_s"):e=document.cookie.split(/\s*;\s*/).filter(n=>n.startsWith("_dd_s")),Dt("Unexpected session state",{session:t,isSyntheticsTest:Ks(),createdTimestamp:t?.created,expireTimestamp:t?.expire,cookie:{count:e.length,domain:cs(),...e},currentDomain:`${window.location.protocol}//${window.location.hostname}`})}function su(){let t="",e=0;return{isAsync:!1,get isEmpty(){return!t},write(n,i){const r=ts(n);e+=r,t+=n,i&&i(r)},finish(n){n(this.finishSync())},finishSync(){const n={output:t,outputBytesCount:e,rawBytesCount:e,pendingData:""};return t="",e=0,n},estimateEncodedBytesCount(n){return n.length}}}class ou{constructor(){this.callbacks={}}notify(e,n){const i=this.callbacks[e];i&&i.forEach(r=>r(n))}subscribe(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),{unsubscribe:()=>{this.callbacks[e]=this.callbacks[e].filter(i=>n!==i)}}}}function jn(t,e,n){let i=0,r=!1;return{isLimitReached(){if(i===0&&H(()=>{i=0},st),i+=1,i<=e||r)return r=!1,!1;if(i===e+1){r=!0;try{n({message:`Reached max number of ${t}s by minute: ${e}`,source:ye.AGENT,startClocks:q()})}finally{r=!1}}return!0}}}function Li(t,e,n){return document.readyState===e||document.readyState==="complete"?(n(),{stop:N}):U(t,window,e==="complete"?"load":"DOMContentLoaded",n,{once:!0})}function au(t,e){return new Promise(n=>{Li(t,e,n)})}let Hn;const Oi=new WeakMap;function cu(t){return Hn||(Hn=lu(t)),Hn}function lu(t){return new R(e=>{const{stop:n}=yt(XMLHttpRequest.prototype,"open",uu),{stop:i}=yt(XMLHttpRequest.prototype,"send",s=>{du(s,t,e)},{computeHandlingStack:!0}),{stop:r}=yt(XMLHttpRequest.prototype,"abort",hu);return()=>{n(),i(),r()}})}function uu({target:t,parameters:[e,n]}){Oi.set(t,{state:"open",method:String(e).toUpperCase(),url:Ai(String(n))})}function du({target:t,handlingStack:e},n,i){const r=Oi.get(t);if(!r)return;const s=r;s.state="start",s.startClocks=q(),s.isAborted=!1,s.xhr=t,s.handlingStack=e;let o=!1;const{stop:a}=yt(t,"onreadystatechange",()=>{t.readyState===XMLHttpRequest.DONE&&c()}),c=()=>{if(l(),a(),o)return;o=!0;const u=r;u.state="complete",u.duration=B(s.startClocks.timeStamp,z()),u.status=t.status,i.notify(We(u))},{stop:l}=U(n,t,"loadend",c);i.notify(s)}function hu({target:t}){const e=Oi.get(t);e&&(e.isAborted=!0)}let Kn;function Xs(){return Kn||(Kn=fu()),Kn}function fu(){return new R(t=>{if(!window.fetch)return;const{stop:e}=yt(window,"fetch",n=>pu(n,t),{computeHandlingStack:!0});return e})}function pu({parameters:t,onPostCall:e,handlingStack:n},i){const[r,s]=t;let o=s&&s.method;o===void 0&&r instanceof Request&&(o=r.method);const a=o!==void 0?String(o).toUpperCase():"GET",c=r instanceof Request?r.url:Ai(String(r)),l=q(),u={state:"start",init:s,input:r,method:a,startClocks:l,url:c,handlingStack:n};i.notify(u),t[0]=u.input,t[1]=u.init,e(d=>mu(i,d,u))}function mu(t,e,n){const i=n;function r(s){i.state="resolve",Object.assign(i,s),t.notify(i)}e.then(I(s=>{r({response:s,responseType:s.type,status:s.status,isAborted:!1})}),I(s=>{var o,a;r({status:0,isAborted:((a=(o=i.init)===null||o===void 0?void 0:o.signal)===null||a===void 0?void 0:a.aborted)||s instanceof DOMException&&s.code===DOMException.ABORT_ERR,error:s})}))}function gu(t,e){if(window.requestIdleCallback&&window.cancelIdleCallback){const n=window.requestIdleCallback(I(t),e);return()=>window.cancelIdleCallback(n)}return bu(t)}const vu=50;function bu(t){const e=ht(),n=H(()=>{t({didTimeout:!1,timeRemaining:()=>Math.max(0,vu-(ht()-e))})},0);return()=>dt(n)}const yu=K,_u=30;function Su(){const t=[];function e(i){let r;if(i.didTimeout){const s=performance.now();r=()=>_u-(performance.now()-s)}else r=i.timeRemaining.bind(i);for(;r()>0&&t.length;)t.shift()();t.length&&n()}function n(){gu(e,{timeout:yu})}return{push(i){t.push(i)===1&&n()}}}let Xn={};function wu(t){const e=t.map(n=>(Xn[n]||(Xn[n]=Eu(n)),Xn[n]));return is(...e)}function Eu(t){return new R(e=>{const n=wt[t];return wt[t]=(...i)=>{n.apply(console,i);const r=vn("console error");Vt(()=>{e.notify(Tu(i,t,r))})},()=>{wt[t]=n}})}function Tu(t,e,n){const i=t.map(r=>Iu(r)).join(" ");if(e===_n.error){const r=t.find(qt),s=wi({originalError:r,handlingStack:n,startClocks:q(),source:ye.CONSOLE,handling:"handled",nonErrorPrefix:"Provided",useFallbackStack:!1});return s.message=i,{api:e,message:i,handlingStack:n,error:s}}return{api:e,message:i,error:void 0,handlingStack:n}}function Iu(t){return typeof t=="string"?F(t):qt(t)?Ss(Qe(t)):be(F(t),void 0,2)}const ku=500;function Cu(){const t=[];return{add:r=>{t.push(r)>ku&&t.splice(0,1)},remove:r=>{qs(t,r)},drain:r=>{t.forEach(s=>s(r)),t.length=0}}}function xu(t){const e=Wt(t)==="object";return e||x.error("Unsupported context:",t),e}function Yn(t,e,n){const i={...t};for(const[r,{required:s,type:o}]of Object.entries(e))o==="string"&&!gr(i[r])&&(i[r]=String(i[r])),s&&gr(i[r])&&x.warn(`The property ${r} of ${n} is required; context will not be sent to the intake.`);return i}function gr(t){return t==null||t===""}function Cn(t="",{propertiesConfig:e={}}={}){let n={};const i=new R,r={getContext:()=>Ti(n),setContext:s=>{xu(s)?n=F(Yn(s,e,t)):r.clearContext(),i.notify()},setContextProperty:(s,o)=>{n=F(Yn({...n,[s]:o},e,t)),i.notify()},removeContextProperty:s=>{delete n[s],Yn(n,e,t),i.notify()},clearContext:()=>{n={},i.notify()},changeObservable:i};return r}function J(t,e,n,i){return I((...r)=>(i&&tt({feature:i}),t()[e][n](...r)))}const Au="_dd_c",Ru=[];function Di(t,e,n,i){const r=Lu(n,i);Ru.push(U(t,window,"storage",({key:l})=>{r===l&&o()})),e.changeObservable.subscribe(a);const s=It(c(),e.getContext());zt(s)||e.setContext(s);function o(){e.setContext(c())}function a(){localStorage.setItem(r,JSON.stringify(e.getContext()))}function c(){const l=localStorage.getItem(r);return l?JSON.parse(l):{}}}function Lu(t,e){return`${Au}_${t}_${e}`}function Ou(t,e,n){const i=Ys();return e.storeContextsAcrossPages&&Di(e,i,n,4),t.register(0,()=>{const r=i.getContext();return zt(r)||!r.id?ct:{account:r}}),i}function Ys(){return Cn("account",{propertiesConfig:{id:{type:"string",required:!0},name:{type:"string"}}})}function Du(t,e,n,i){const r=Zs();return e.storeContextsAcrossPages&&Di(e,r,n,2),t.register(0,()=>({context:r.getContext()})),r}function Zs(){return Cn("global context")}function Nu(t,e,n,i){const r=Js();return e.storeContextsAcrossPages&&Di(e,r,i,1),t.register(0,({eventType:s,startTime:o})=>{const a=r.getContext(),c=n.findTrackedSession(o);return c&&c.anonymousId&&!a.anonymous_id&&e.trackAnonymousUser&&(a.anonymous_id=c.anonymousId),zt(a)?ct:{type:s,usr:a}}),t.register(1,({startTime:s})=>{var o;return{anonymous_id:(o=n.findTrackedSession(s))===null||o===void 0?void 0:o.anonymousId}}),r}function Js(){return Cn("user",{propertiesConfig:{id:{type:"string"},name:{type:"string"},email:{type:"string"}}})}const $={userContext:"userContext",globalContext:"globalContext",accountContext:"accountContext"},Q={getContext:"getContext",setContext:"setContext",setContextProperty:"setContextProperty",removeContextProperty:"removeContextProperty",clearContext:"clearContext"};function Mu(t,e,n){const i=t.getReader();let r=0;s();function s(){i.read().then(I(a=>{if(a.done){o();return}r+=a.value.length,r>n.bytesLimit?o():s()}),I(a=>e(a)))}function o(){i.cancel().catch(N),e(void 0,void 0,void 0)}}const et={DOCUMENT:"document",XHR:"xhr",BEACON:"beacon",FETCH:"fetch",CSS:"css",JS:"js",IMAGE:"image",FONT:"font",MEDIA:"media",OTHER:"other"},xn={FETCH:et.FETCH,XHR:et.XHR},Pu=500;function Uu(t=Ul){const e=new rs(Pu),n=t().subscribe(i=>{e.notify({type:0,error:i})});return{observable:e,stop:()=>{n.unsubscribe()}}}function Bu(){try{return new Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}}const C={ACTION:"action",ERROR:"error",LONG_TASK:"long_task",VIEW:"view",RESOURCE:"resource",VITAL:"vital"},Qs={LONG_TASK:"long-task",LONG_ANIMATION_FRAME:"long-animation-frame"},Et={INITIAL_LOAD:"initial_load",ROUTE_CHANGE:"route_change",BF_CACHE:"bf_cache"},Ni={CLICK:"click",CUSTOM:"custom"},Ce={RAGE_CLICK:"rage_click",ERROR_CLICK:"error_click",DEAD_CLICK:"dead_click"},to={DURATION:"duration"};function Fu(){return{vitalsByName:new Map,vitalsByReference:new WeakMap}}function Vu(t,e,n){function i(s){return!e.wasInPageStateDuringPeriod("frozen",s.startClocks.relative,s.duration)}function r(s){i(s)&&t.notify(12,zu(s))}return{addDurationVital:r,startDurationVital:(s,o={})=>eo(n,s,o),stopDurationVital:(s,o={})=>{no(r,n,s,o)}}}function eo({vitalsByName:t,vitalsByReference:e},n,i={}){const r={name:n,startClocks:q(),context:i.context,description:i.description},s={__dd_vital_reference:!0};return t.set(n,r),e.set(s,r),s}function no(t,{vitalsByName:e,vitalsByReference:n},i,r={}){const s=typeof i=="string"?e.get(i):n.get(i);s&&(t($u(s,s.startClocks,r,q())),typeof i=="string"?e.delete(i):n.delete(i))}function $u(t,e,n,i){var r;return{name:t.name,type:to.DURATION,startClocks:e,duration:B(e.timeStamp,i.timeStamp),context:It(t.context,n.context),description:(r=n.description)!==null&&r!==void 0?r:t.description}}function zu(t,e){const n={date:t.startClocks.timeStamp,vital:{id:X(),type:t.type,name:t.name,duration:k(t.duration),description:t.description},type:C.VITAL,context:t.context};return n._dd={vital:{computed_value:!0}},{rawRumEvent:n,startTime:t.startClocks.relative,duration:t.duration,domainContext:{}}}function io(t,e,n){if(t)for(const i of t){const r=i[e];r&&r(n)}}const vr=new Map;function ro(t,e){if(e===100)return!0;if(e===0)return!1;const n=vr.get(e);if(n&&t===n.sessionId)return n.decision;let i;return window.BigInt?i=Gu(BigInt(`0x${t.split("-")[4]}`),e):i=Tt(e),vr.set(e,{sessionId:t,decision:i}),i}function Gu(t,e){const n=BigInt("1111111111111111111"),i=BigInt("0x10000000000000000"),r=t*n%i;return Number(r)<=e/100*Number(i)}function qu(){return oo(64)}function so(){return oo(63)}function oo(t){const e=crypto.getRandomValues(new Uint32Array(2));return t===63&&(e[e.length-1]>>>=1),{toString(n=10){let i=e[1],r=e[0],s="";do{const o=i%n*4294967296+r;i=Math.floor(i/n),r=Math.floor(o/n),s=(o%n).toString(n)+s}while(i||r);return s}}}function te(t){return t.toString(16).padStart(16,"0")}function Wu(t){const e=t;return Wt(e)==="object"&&Ci(e.match)&&Array.isArray(e.propagatorTypes)}function ju(t){t.status===0&&!t.isAborted&&(t.traceId=void 0,t.spanId=void 0,t.traceSampled=void 0)}function Hu(t,e,n,i){return{clearTracingIfNeeded:ju,traceFetch:r=>br(t,r,e,n,i,s=>{var o;if(r.input instanceof Request&&!(!((o=r.init)===null||o===void 0)&&o.headers))r.input=new Request(r.input),Object.keys(s).forEach(a=>{r.input.headers.append(a,s[a])});else{r.init=We(r.init);const a=[];r.init.headers instanceof Headers?r.init.headers.forEach((c,l)=>{a.push([l,c])}):Array.isArray(r.init.headers)?r.init.headers.forEach(c=>{a.push(c)}):r.init.headers&&Object.keys(r.init.headers).forEach(c=>{a.push([c,r.init.headers[c]])}),r.init.headers=a.concat(_i(s))}}),traceXhr:(r,s)=>br(t,r,e,n,i,o=>{Object.keys(o).forEach(a=>{s.setRequestHeader(a,o[a])})})}}function br(t,e,n,i,r,s){const o=n.findTrackedSession();if(!o)return;const a=t.allowedTracingUrls.find(u=>xi([u.match],e.url,!0));if(!a)return;const c=ro(o.id,t.traceSampleRate);(c||t.traceContextInjection===fi.ALL)&&(e.traceSampled=c,e.traceId=qu(),e.spanId=so(),s(Ku(e.traceId,e.spanId,e.traceSampled,o.id,a.propagatorTypes,i,r,t)))}function Ku(t,e,n,i,r,s,o,a){const c={};if(r.forEach(l=>{switch(l){case"datadog":{Object.assign(c,{"x-datadog-origin":"rum","x-datadog-parent-id":e.toString(),"x-datadog-sampling-priority":n?"1":"0","x-datadog-trace-id":t.toString()});break}case"tracecontext":{Object.assign(c,{traceparent:`00-0000000000000000${te(t)}-${te(e)}-0${n?"1":"0"}`,tracestate:`dd=s:${n?"1":"0"};o:rum`});break}case"b3":{Object.assign(c,{b3:`${te(t)}-${te(e)}-${n?"1":"0"}`});break}case"b3multi":{Object.assign(c,{"X-B3-TraceId":te(t),"X-B3-SpanId":te(e),"X-B3-Sampled":n?"1":"0"});break}}}),a.propagateTraceBaggage){const l={"session.id":i},u=s.getContext().id;typeof u=="string"&&(l["user.id"]=u);const d=o.getContext().id;typeof d=="string"&&(l["account.id"]=d);const h=Object.entries(l).map(([p,f])=>`${p}=${encodeURIComponent(f)}`).join(",");h&&(c.baggage=h)}return c}const ao=["tracecontext","datadog"];function Xu(t){var e,n,i,r,s,o,a;if(t.trackFeatureFlagsForEvents!==void 0&&!Array.isArray(t.trackFeatureFlagsForEvents)&&x.warn("trackFeatureFlagsForEvents should be an array"),!t.applicationId){x.error("Application ID is not configured, no RUM data will be collected.");return}if(!oe(t.sessionReplaySampleRate,"Session Replay")||!oe(t.traceSampleRate,"Trace"))return;if(t.excludedActivityUrls!==void 0&&!Array.isArray(t.excludedActivityUrls)){x.error("Excluded Activity Urls should be an array");return}const c=Yu(t);if(!c)return;const l=Rl(t);if(!l)return;const u=(e=t.sessionReplaySampleRate)!==null&&e!==void 0?e:0;return{applicationId:t.applicationId,actionNameAttribute:t.actionNameAttribute,sessionReplaySampleRate:u,startSessionReplayRecordingManually:t.startSessionReplayRecordingManually!==void 0?!!t.startSessionReplayRecordingManually:u===0,traceSampleRate:(n=t.traceSampleRate)!==null&&n!==void 0?n:100,rulePsr:Ye(t.traceSampleRate)?t.traceSampleRate/100:void 0,allowedTracingUrls:c,excludedActivityUrls:(i=t.excludedActivityUrls)!==null&&i!==void 0?i:[],workerUrl:t.workerUrl,compressIntakeRequests:!!t.compressIntakeRequests,trackUserInteractions:!!(!((r=t.trackUserInteractions)!==null&&r!==void 0)||r),trackViewsManually:!!t.trackViewsManually,trackResources:!!(!((s=t.trackResources)!==null&&s!==void 0)||s),trackLongTasks:!!(!((o=t.trackLongTasks)!==null&&o!==void 0)||o),trackBfcacheViews:!!t.trackBfcacheViews,subdomain:t.subdomain,defaultPrivacyLevel:mn(ze,t.defaultPrivacyLevel)?t.defaultPrivacyLevel:ze.MASK,enablePrivacyForActionName:!!t.enablePrivacyForActionName,customerDataTelemetrySampleRate:1,initialViewMetricsTelemetrySampleRate:1,replayTelemetrySampleRate:1,traceContextInjection:mn(fi,t.traceContextInjection)?t.traceContextInjection:fi.SAMPLED,plugins:t.plugins||[],trackFeatureFlagsForEvents:t.trackFeatureFlagsForEvents||[],profilingSampleRate:(a=t.profilingSampleRate)!==null&&a!==void 0?a:0,propagateTraceBaggage:!!t.propagateTraceBaggage,...l}}function Yu(t){if(t.allowedTracingUrls===void 0)return[];if(!Array.isArray(t.allowedTracingUrls)){x.error("Allowed Tracing URLs should be an array");return}if(t.allowedTracingUrls.length!==0&&t.service===void 0){x.error("Service needs to be configured when tracing is enabled");return}const e=[];return t.allowedTracingUrls.forEach(n=>{Ci(n)?e.push({match:n,propagatorTypes:ao}):Wu(n)?e.push(n):x.warn("Allowed Tracing Urls parameters should be a string, RegExp, function, or an object. Ignoring parameter",n)}),e}function Zu(t){const e=new Set;return Array.isArray(t.allowedTracingUrls)&&t.allowedTracingUrls.length>0&&t.allowedTracingUrls.forEach(n=>{Ci(n)?ao.forEach(i=>e.add(i)):Wt(n)==="object"&&Array.isArray(n.propagatorTypes)&&n.propagatorTypes.forEach(i=>e.add(i))}),Array.from(e)}function Ju(t){var e;const n=Ll(t);return{session_replay_sample_rate:t.sessionReplaySampleRate,start_session_replay_recording_manually:t.startSessionReplayRecordingManually,trace_sample_rate:t.traceSampleRate,trace_context_injection:t.traceContextInjection,action_name_attribute:t.actionNameAttribute,use_allowed_tracing_urls:Array.isArray(t.allowedTracingUrls)&&t.allowedTracingUrls.length>0,selected_tracing_propagators:Zu(t),default_privacy_level:t.defaultPrivacyLevel,enable_privacy_for_action_name:t.enablePrivacyForActionName,use_excluded_activity_urls:Array.isArray(t.excludedActivityUrls)&&t.excludedActivityUrls.length>0,use_worker_url:!!t.workerUrl,compress_intake_requests:t.compressIntakeRequests,track_views_manually:t.trackViewsManually,track_user_interactions:t.trackUserInteractions,track_resources:t.trackResources,track_long_task:t.trackLongTasks,track_bfcache_views:t.trackBfcacheViews,plugins:(e=t.plugins)===null||e===void 0?void 0:e.map(i=>{var r;return{name:i.name,...(r=i.getConfigurationTelemetry)===null||r===void 0?void 0:r.call(i)}}),track_feature_flags_for_events:t.trackFeatureFlagsForEvents,...n}}const Qu="v1",td=["applicationId","service","env","version","sessionSampleRate","sessionReplaySampleRate","defaultPrivacyLevel","enablePrivacyForActionName","traceSampleRate","trackSessionAcrossSubdomains","allowedTracingUrls","allowedTrackingOrigins"];async function ed(t){const e=await od(t);if(!e.ok){x.error(e.error);return}return nd(t,e.value)}function nd(t,e){const n={...t};return td.forEach(i=>{i in e&&(n[i]=pi(e[i]))}),n}function pi(t){if(Array.isArray(t))return t.map(pi);if(id(t)){if(rd(t)){const e=t.rcSerializedType;switch(e){case"string":return t.value;case"regex":return sd(t.value);default:x.error(`Unsupported remote configuration: "rcSerializedType": "${e}"`);return}}return es(t,pi)}return t}function id(t){return typeof t=="object"&&t!==null}function rd(t){return"rcSerializedType"in t}function sd(t){try{return new RegExp(t)}catch{x.error(`Invalid regex in the remote configuration: '${t}'`)}}async function od(t){let e;try{e=await fetch(ad(t))}catch{e=void 0}if(!e||!e.ok)return{ok:!1,error:new Error("Error fetching the remote configuration.")};const n=await e.json();return n.rum?{ok:!0,value:n.rum}:{ok:!1,error:new Error("No remote configuration for RUM.")}}function ad(t){return t.remoteConfigurationProxy?t.remoteConfigurationProxy:`https://sdk-configuration.${Vs("rum",t)}/${Qu}/${encodeURIComponent(t.remoteConfigurationId)}.json`}function cd({ignoreInitIfSyntheticsWillInjectRum:t=!0,startDeflateWorker:e},n,i,r){const s=Cu(),o=Zs();Zn(o,$.globalContext,s);const a=Js();Zn(a,$.userContext,s);const c=Ys();Zn(c,$.accountContext,s);let l,u,d,h;const p=n.observable.subscribe(v),f={};function v(){if(!d||!h||!n.isGranted())return;p.unsubscribe();let g;if(h.trackViewsManually){if(!l)return;s.remove(l.callback),g=l.options}const b=r(h,u,g);s.drain(b)}function S(g){const b=me();if(b&&(g=ld(g)),d=g,rl(Ju(g)),h){$s("DD_RUM",g);return}const w=Xu(g);if(w){if(!b&&!w.sessionStoreStrategyType){x.warn("No storage available for session. We will not send any data.");return}w.compressIntakeRequests&&!b&&e&&(u=e(w,"Datadog RUM",N),!u)||(h=w,Xs().subscribe(N),n.tryToInit(w.trackingConsent),v())}}const E=g=>{s.add(b=>b.addDurationVital(g))};return{init(g,b){if(!g){x.error("Missing configuration");return}kc(g.enableExperimentalFeatures),d=g,!(t&&Ws())&&(io(g.plugins,"onInit",{initConfiguration:g,publicApi:b}),g.remoteConfigurationId?ed(g).then(w=>{w&&S(w)}).catch(he):S(g))},get initConfiguration(){return d},getInternalContext:N,stopSession:N,addTiming(g,b=z()){s.add(w=>w.addTiming(g,b))},startView(g,b=q()){const w=m=>{m.startView(g,b)};s.add(w),l||(l={options:g,callback:w},v())},setViewName(g){s.add(b=>b.setViewName(g))},setViewContext(g){s.add(b=>b.setViewContext(g))},setViewContextProperty(g,b){s.add(w=>w.setViewContextProperty(g,b))},getViewContext:()=>f,globalContext:o,userContext:a,accountContext:c,addAction(g){s.add(b=>b.addAction(g))},addError(g){s.add(b=>b.addError(g))},addFeatureFlagEvaluation(g,b){s.add(w=>w.addFeatureFlagEvaluation(g,b))},startDurationVital(g,b){return eo(i,g,b)},stopDurationVital(g,b){no(E,i,g,b)},addDurationVital:E}}function ld(t){var e,n;return{...t,applicationId:"00000000-aaaa-0000-aaaa-000000000000",clientToken:"empty",sessionSampleRate:100,defaultPrivacyLevel:(e=t.defaultPrivacyLevel)!==null&&e!==void 0?e:(n=en())===null||n===void 0?void 0:n.getPrivacyLevel()}}function Zn(t,e,n){t.changeObservable.subscribe(()=>{const i=t.getContext();n.add(r=>r[e].setContext(i))})}function ud(t,e,n,i={}){const r=ml(),s=Fu(),o=Uu().observable;let a=cd(i,r,s,(d,h,p)=>{const f=t(d,e,n,p,h&&i.createDeflateEncoder?v=>i.createDeflateEncoder(d,h,v):su,r,s,o,i.sdkName);return e.onRumStart(f.lifeCycle,d,f.session,f.viewHistory,h,f.telemetry),n.onRumStart(f.lifeCycle,f.hooks,d,f.session,f.viewHistory),a=dd(a,f),io(d.plugins,"onRumStart",{strategy:a,addEvent:f.addEvent}),f});const c=()=>a,l=I(d=>{const h=typeof d=="object"?d:{name:d};a.startView(h),tt({feature:"start-view"})}),u=Vl({init:I(d=>{a.init(d,u)}),setTrackingConsent:I(d=>{r.update(d),tt({feature:"set-tracking-consent",tracking_consent:d})}),setViewName:I(d=>{a.setViewName(d),tt({feature:"set-view-name"})}),setViewContext:I(d=>{a.setViewContext(d),tt({feature:"set-view-context"})}),setViewContextProperty:I((d,h)=>{a.setViewContextProperty(d,h),tt({feature:"set-view-context-property"})}),getViewContext:I(()=>(tt({feature:"set-view-context-property"}),a.getViewContext())),getInternalContext:I(d=>a.getInternalContext(d)),getInitConfiguration:I(()=>Ti(a.initConfiguration)),addAction:(d,h)=>{const p=vn("action");Vt(()=>{a.addAction({name:F(d),context:F(h),startClocks:q(),type:Ni.CUSTOM,handlingStack:p}),tt({feature:"add-action"})})},addError:(d,h)=>{const p=vn("error");Vt(()=>{a.addError({error:d,handlingStack:p,context:F(h),startClocks:q()}),tt({feature:"add-error"})})},addTiming:I((d,h)=>{a.addTiming(F(d),h)}),setGlobalContext:J(c,$.globalContext,Q.setContext,"set-global-context"),getGlobalContext:J(c,$.globalContext,Q.getContext,"get-global-context"),setGlobalContextProperty:J(c,$.globalContext,Q.setContextProperty,"set-global-context-property"),removeGlobalContextProperty:J(c,$.globalContext,Q.removeContextProperty,"remove-global-context-property"),clearGlobalContext:J(c,$.globalContext,Q.clearContext,"clear-global-context"),setUser:J(c,$.userContext,Q.setContext,"set-user"),getUser:J(c,$.userContext,Q.getContext,"get-user"),setUserProperty:J(c,$.userContext,Q.setContextProperty,"set-user-property"),removeUserProperty:J(c,$.userContext,Q.removeContextProperty,"remove-user-property"),clearUser:J(c,$.userContext,Q.clearContext,"clear-user"),setAccount:J(c,$.accountContext,Q.setContext,"set-account"),getAccount:J(c,$.accountContext,Q.getContext,"get-account"),setAccountProperty:J(c,$.accountContext,Q.setContextProperty,"set-account-property"),removeAccountProperty:J(c,$.accountContext,Q.removeContextProperty,"remove-account-property"),clearAccount:J(c,$.accountContext,Q.clearContext,"clear-account"),startView:l,stopSession:I(()=>{a.stopSession(),tt({feature:"stop-session"})}),addFeatureFlagEvaluation:I((d,h)=>{a.addFeatureFlagEvaluation(F(d),F(h)),tt({feature:"add-feature-flag-evaluation"})}),getSessionReplayLink:I(()=>e.getSessionReplayLink()),startSessionReplayRecording:I(d=>{e.start(d),tt({feature:"start-session-replay-recording",force:d&&d.force})}),stopSessionReplayRecording:I(()=>e.stop()),addDurationVital:I((d,h)=>{tt({feature:"add-duration-vital"}),a.addDurationVital({name:F(d),type:to.DURATION,startClocks:ka(h.startTime),duration:h.duration,context:F(h&&h.context),description:F(h&&h.description)})}),startDurationVital:I((d,h)=>(tt({feature:"start-duration-vital"}),a.startDurationVital(F(d),{context:F(h&&h.context),description:F(h&&h.description)}))),stopDurationVital:I((d,h)=>{tt({feature:"stop-duration-vital"}),a.stopDurationVital(typeof d=="string"?F(d):d,{context:F(h&&h.context),description:F(h&&h.description)})})});return u}function dd(t,e){return{init:n=>{$s("DD_RUM",n)},initConfiguration:t.initConfiguration,...e}}function hd(){const t=fd();return new R(e=>{if(!t)return;const n=new t(I(i=>e.notify(i)));return n.observe(document,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),()=>n.disconnect()})}function fd(){let t;const e=window;if(e.Zone&&(t=Rt(e,"MutationObserver"),e.MutationObserver&&t===e.MutationObserver)){const n=new e.MutationObserver(N),i=Rt(n,"originalInstance");t=i&&i.constructor}return t||(t=e.MutationObserver),t}function pd(){const t=new R,{stop:e}=yt(window,"open",()=>t.notify());return{observable:t,stop:e}}function md(t,e,n,i,r){return{get:s=>{const o=n.findView(s),a=r.findUrl(s),c=e.findTrackedSession(s);if(c&&o&&a){const l=i.findActionId(s);return{application_id:t,session_id:c.id,user_action:l?{id:l}:void 0,view:{id:o.id,name:o.name,referrer:a.referrer,url:a.url}}}}}}const gd=ou,vd=Gt;function bd(t){const e=Se({expireDelay:vd});t.subscribe(1,i=>{e.add(n(i),i.startClocks.relative)}),t.subscribe(6,({endClocks:i})=>{e.closeActive(i.relative)}),t.subscribe(3,i=>{const r=e.find(i.startClocks.relative);r&&(i.name&&(r.name=i.name),i.context&&(r.context=i.context),r.sessionIsActive=i.sessionIsActive)}),t.subscribe(10,()=>{e.reset()});function n(i){return{service:i.service,version:i.version,context:i.context,id:i.id,name:i.name,startClocks:i.startClocks}}return{findView:i=>e.find(i),stop:()=>{e.stop()}}}const co="initial_document",yd=[[et.DOCUMENT,t=>co===t],[et.XHR,t=>t==="xmlhttprequest"],[et.FETCH,t=>t==="fetch"],[et.BEACON,t=>t==="beacon"],[et.CSS,(t,e)=>/\.css$/i.test(e)],[et.JS,(t,e)=>/\.js$/i.test(e)],[et.IMAGE,(t,e)=>["image","img","icon"].includes(t)||/\.(gif|jpg|jpeg|tiff|png|svg|ico)$/i.exec(e)!==null],[et.FONT,(t,e)=>/\.(woff|eot|woff2|ttf)$/i.exec(e)!==null],[et.MEDIA,(t,e)=>["audio","video"].includes(t)||/\.(mp3|mp4)$/i.exec(e)!==null]];function _d(t){const e=t.name;if(!_l(e))return Dt(`Failed to construct URL for "${t.name}"`),et.OTHER;const n=Sl(e);for(const[i,r]of yd)if(r(t.initiatorType,n))return i;return et.OTHER}function yr(...t){for(let e=1;e<t.length;e+=1)if(t[e-1]>t[e])return!1;return!0}function lo(t){return t.initiatorType==="xmlhttprequest"||t.initiatorType==="fetch"}function Sd(t){const{duration:e,startTime:n,responseEnd:i}=t;return e===0&&n<i?B(n,i):e}function wd(t){if(!ho(t))return;const{startTime:e,fetchStart:n,workerStart:i,redirectStart:r,redirectEnd:s,domainLookupStart:o,domainLookupEnd:a,connectStart:c,secureConnectionStart:l,connectEnd:u,requestStart:d,responseStart:h,responseEnd:p}=t,f={download:Mt(e,h,p),first_byte:Mt(e,d,h)};return 0<i&&i<n&&(f.worker=Mt(e,i,n)),n<u&&(f.connect=Mt(e,c,u),c<=l&&l<=u&&(f.ssl=Mt(e,l,u))),n<a&&(f.dns=Mt(e,o,a)),e<s&&(f.redirect=Mt(e,r,s)),f}function uo(t){return t.duration>=0}function ho(t){const e=yr(t.startTime,t.fetchStart,t.domainLookupStart,t.domainLookupEnd,t.connectStart,t.connectEnd,t.requestStart,t.responseStart,t.responseEnd),n=Ed(t)?yr(t.startTime,t.redirectStart,t.redirectEnd,t.fetchStart):!0;return e&&n}function Ed(t){return t.redirectEnd>t.startTime}function Mt(t,e,n){if(t<=e&&e<=n)return{duration:k(B(e,n)),start:k(B(t,e))}}function Td(t){return t.nextHopProtocol===""?void 0:t.nextHopProtocol}function Id(t){return t.deliveryType===""?"other":t.deliveryType}function kd(t){if(t.startTime<t.responseStart){const{encodedBodySize:e,decodedBodySize:n,transferSize:i}=t;return{size:n,encoded_body_size:e,decoded_body_size:n,transfer_size:i}}return{size:void 0,encoded_body_size:void 0,decoded_body_size:void 0,transfer_size:void 0}}function Mi(t){return t&&(!xl(t)||kn($t.TRACK_INTAKE_REQUESTS))}const Cd=/data:(.+)?(;base64)?,/g,xd=24e3;function Ad(t,e=xd){if(t.length<=e||!t.startsWith("data:"))return t;const n=t.substring(0,100).match(Cd);return n?`${n[0]}[...]`:t}let _r=1;function Rd(t,e,n,i,r){const s=Hu(e,n,i,r);Ld(t,e,s),Od(t,s)}function Ld(t,e,n){const i=cu(e).subscribe(r=>{const s=r;if(Mi(s.url))switch(s.state){case"start":n.traceXhr(s,s.xhr),s.requestIndex=fo(),t.notify(7,{requestIndex:s.requestIndex,url:s.url});break;case"complete":n.clearTracingIfNeeded(s),t.notify(8,{duration:s.duration,method:s.method,requestIndex:s.requestIndex,spanId:s.spanId,startClocks:s.startClocks,status:s.status,traceId:s.traceId,traceSampled:s.traceSampled,type:xn.XHR,url:s.url,xhr:s.xhr,isAborted:s.isAborted,handlingStack:s.handlingStack});break}});return{stop:()=>i.unsubscribe()}}function Od(t,e){const n=Xs().subscribe(i=>{const r=i;if(Mi(r.url))switch(r.state){case"start":e.traceFetch(r),r.requestIndex=fo(),t.notify(7,{requestIndex:r.requestIndex,url:r.url});break;case"resolve":Dd(r,s=>{e.clearTracingIfNeeded(r),t.notify(8,{duration:s,method:r.method,requestIndex:r.requestIndex,responseType:r.responseType,spanId:r.spanId,startClocks:r.startClocks,status:r.status,traceId:r.traceId,traceSampled:r.traceSampled,type:xn.FETCH,url:r.url,response:r.response,init:r.init,input:r.input,isAborted:r.isAborted,handlingStack:r.handlingStack})});break}});return{stop:()=>n.unsubscribe()}}function fo(){const t=_r;return _r+=1,t}function Dd(t,e){const n=t.response&&Pc(t.response);!n||!n.body?e(B(t.startClocks.timeStamp,z())):Mu(n.body,()=>{e(B(t.startClocks.timeStamp,z()))},{bytesLimit:Number.POSITIVE_INFINITY})}function po(t){return Ye(t)&&t<0?void 0:t}function mo({lifeCycle:t,isChildEvent:e,onChange:n=N}){const i={errorCount:0,longTaskCount:0,resourceCount:0,actionCount:0,frustrationCount:0},r=t.subscribe(13,s=>{var o;if(!(s.type==="view"||s.type==="vital"||!e(s)))switch(s.type){case C.ERROR:i.errorCount+=1,n();break;case C.ACTION:i.actionCount+=1,s.action.frustration&&(i.frustrationCount+=s.action.frustration.type.length),n();break;case C.LONG_TASK:i.longTaskCount+=1,n();break;case C.RESOURCE:!((o=s._dd)===null||o===void 0)&&o.discarded||(i.resourceCount+=1,n());break}});return{stop:()=>{r.unsubscribe()},eventCounts:i}}function Nd(t,e){const n=ht();let i=!1;const{stop:r}=Lt(t,window,["click","mousedown","keydown","touchstart","pointerdown"],a=>{if(!a.cancelable)return;const c={entryType:"first-input",processingStart:at(),processingEnd:at(),startTime:a.timeStamp,duration:0,name:"",cancelable:!1,target:null,toJSON:()=>({})};a.type==="pointerdown"?s(t,c):o(c)},{passive:!0,capture:!0});return{stop:r};function s(a,c){Lt(a,window,["pointerup","pointercancel"],l=>{l.type==="pointerup"&&o(c)},{once:!0})}function o(a){if(!i){i=!0,r();const c=a.processingStart-a.startTime;c>=0&&c<ht()-n&&e(a)}}}var L;(function(t){t.EVENT="event",t.FIRST_INPUT="first-input",t.LARGEST_CONTENTFUL_PAINT="largest-contentful-paint",t.LAYOUT_SHIFT="layout-shift",t.LONG_TASK="longtask",t.LONG_ANIMATION_FRAME="long-animation-frame",t.NAVIGATION="navigation",t.PAINT="paint",t.RESOURCE="resource",t.VISIBILITY_STATE="visibility-state"})(L||(L={}));function _t(t,e){return new R(n=>{if(!window.PerformanceObserver)return;const i=c=>{const l=Ud(c);l.length>0&&n.notify(l)};let r,s=!0;const o=new PerformanceObserver(I(c=>{s?r=H(()=>i(c.getEntries())):i(c.getEntries())}));try{o.observe(e)}catch{if([L.RESOURCE,L.NAVIGATION,L.LONG_TASK,L.PAINT].includes(e.type)){e.buffered&&(r=H(()=>i(performance.getEntriesByType(e.type))));try{o.observe({entryTypes:[e.type]})}catch{return}}}s=!1,Md(t);let a;return!jt(L.FIRST_INPUT)&&e.type===L.FIRST_INPUT&&({stop:a}=Nd(t,c=>{i([c])})),()=>{o.disconnect(),a&&a(),dt(r)}})}let xe;function Md(t){return!xe&&Pd()&&"addEventListener"in performance&&(xe=U(t,performance,"resourcetimingbufferfull",()=>{performance.clearResourceTimings()})),()=>{xe?.stop()}}function Pd(){return window.performance!==void 0&&"getEntries"in performance}function jt(t){return window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes!==void 0&&PerformanceObserver.supportedEntryTypes.includes(t)}function Ud(t){return t.filter(e=>!Bd(e))}function Bd(t){return t.entryType===L.RESOURCE&&(!Mi(t.name)||!uo(t))}function go(t){return t.nodeType===Node.TEXT_NODE}function Fd(t){return t.nodeType===Node.COMMENT_NODE}function kt(t){return t.nodeType===Node.ELEMENT_NODE}function vo(t){return kt(t)&&!!t.shadowRoot}function Vd(t){const e=t;return!!e.host&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&kt(e.host)}function Bm(t){return t.childNodes.length>0||vo(t)}function Fm(t,e){let n=t.firstChild;for(;n;)e(n),n=n.nextSibling;vo(t)&&e(t.shadowRoot)}function $d(t){return Vd(t)?t.host:t.parentNode}const bo=100,zd=100,Sr="data-dd-excluded-activity-mutations";function Pi(t,e,n,i,r,s){const o=qd(t,e,n,i);return Gd(o,r,s)}function Gd(t,e,n){let i,r=!1;const s=H(I(()=>l({hadActivity:!1})),bo),o=n!==void 0?H(I(()=>l({hadActivity:!0,end:z()})),n):void 0,a=t.subscribe(({isBusy:u})=>{dt(s),dt(i);const d=z();u||(i=H(I(()=>l({hadActivity:!0,end:d})),zd))}),c=()=>{r=!0,dt(s),dt(i),dt(o),a.unsubscribe()};function l(u){r||(c(),e(u))}return{stop:c}}function qd(t,e,n,i){return new R(r=>{const s=[];let o,a=0;return s.push(e.subscribe(l=>{l.every(Wd)||c()}),n.subscribe(c),_t(i,{type:L.RESOURCE}).subscribe(l=>{l.some(u=>!Jn(i,u.name))&&c()}),t.subscribe(7,l=>{Jn(i,l.url)||(o===void 0&&(o=l.requestIndex),a+=1,c())}),t.subscribe(8,l=>{Jn(i,l.url)||o===void 0||l.requestIndex<o||(a-=1,c())})),()=>{s.forEach(l=>l.unsubscribe())};function c(){r.notify({isBusy:a>0})}})}function Jn(t,e){return xi(t.excludedActivityUrls,e)}function Wd(t){const e=t.type==="characterData"?t.target.parentElement:t.target;return!!(e&&kt(e)&&e.matches(`[${Sr}], [${Sr}] *`))}const O={IGNORE:"ignore",HIDDEN:"hidden",ALLOW:ze.ALLOW,MASK:ze.MASK,MASK_USER_INPUT:ze.MASK_USER_INPUT},jd="data-dd-privacy",Vm="hidden",Hd="dd-privacy-",Qn="***",$m="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",Kd={INPUT:!0,OUTPUT:!0,TEXTAREA:!0,SELECT:!0,OPTION:!0,DATALIST:!0,OPTGROUP:!0},Xd="x";function yo(t,e,n){if(n&&n.has(t))return n.get(t);const i=$d(t),r=i?yo(i,e,n):e,s=_o(t),o=Yd(s,r);return n&&n.set(t,o),o}function Yd(t,e){switch(e){case O.HIDDEN:case O.IGNORE:return e}switch(t){case O.ALLOW:case O.MASK:case O.MASK_USER_INPUT:case O.HIDDEN:case O.IGNORE:return t;default:return e}}function _o(t){if(kt(t)){if(t.tagName==="BASE")return O.ALLOW;if(t.tagName==="INPUT"){const e=t;if(e.type==="password"||e.type==="email"||e.type==="tel"||e.type==="hidden")return O.MASK;const n=e.getAttribute("autocomplete");if(n&&(n.startsWith("cc-")||n.endsWith("-password")))return O.MASK}if(t.matches(ae(O.HIDDEN)))return O.HIDDEN;if(t.matches(ae(O.MASK)))return O.MASK;if(t.matches(ae(O.MASK_USER_INPUT)))return O.MASK_USER_INPUT;if(t.matches(ae(O.ALLOW)))return O.ALLOW;if(Jd(t))return O.IGNORE}}function So(t,e){switch(e){case O.MASK:case O.HIDDEN:case O.IGNORE:return!0;case O.MASK_USER_INPUT:return go(t)?wr(t.parentNode):wr(t);default:return!1}}function wr(t){if(!t||t.nodeType!==t.ELEMENT_NODE)return!1;const e=t;if(e.tagName==="INPUT")switch(e.type){case"button":case"color":case"reset":case"submit":return!1}return!!Kd[e.tagName]}const Zd=t=>t.replace(/\S/g,Xd);function zm(t,e,n){var i;const r=(i=t.parentElement)===null||i===void 0?void 0:i.tagName;let s=t.textContent||"";if(e&&!s.trim())return;const o=n;if(r==="SCRIPT")s=Qn;else if(o===O.HIDDEN)s=Qn;else if(So(t,o))if(r==="DATALIST"||r==="SELECT"||r==="OPTGROUP"){if(!s.trim())return}else r==="OPTION"?s=Qn:s=Zd(s);return s}function Jd(t){if(t.nodeName==="SCRIPT")return!0;if(t.nodeName==="LINK"){const n=e("rel");return/preload|prefetch/i.test(n)&&e("as")==="script"||n==="shortcut icon"||n==="icon"}if(t.nodeName==="META"){const n=e("name"),i=e("rel"),r=e("property");return/^msapplication-tile(image|color)$/.test(n)||n==="application-name"||i==="icon"||i==="apple-touch-icon"||i==="shortcut icon"||n==="keywords"||n==="description"||/^(og|twitter|fb):/.test(r)||/^(og|twitter):/.test(n)||n==="pinterest"||n==="robots"||n==="googlebot"||n==="bingbot"||t.hasAttribute("http-equiv")||n==="author"||n==="generator"||n==="framework"||n==="publisher"||n==="progid"||/^article:/.test(r)||/^product:/.test(r)||n==="google-site-verification"||n==="yandex-verification"||n==="csrf-token"||n==="p:domain_verify"||n==="verify-v1"||n==="verification"||n==="shopify-checkout-api-token"}function e(n){return(t.getAttribute(n)||"").toLowerCase()}return!1}function ae(t){return`[${jd}="${t}"], .${Hd}${t}`}const An="data-dd-action-name",Qd="Masked Element";function th(t,{enablePrivacyForActionName:e,actionNameAttribute:n},i=O.ALLOW){const r=Er(t,An)||n&&Er(t,n);return r?{name:r,nameSource:"custom_attribute"}:i===O.MASK?{name:Qd,nameSource:"mask_placeholder"}:Tr(t,n,eh,e)||Tr(t,n,nh,e)||{name:"",nameSource:"blank"}}function Er(t,e){const n=t.closest(`[${e}]`);if(!n)return;const i=n.getAttribute(e);return Eo(wo(i.trim()))}const eh=[(t,e,n)=>{if("labels"in t&&t.labels&&t.labels.length>0)return fn(t.labels[0],e,n)},t=>{if(t.nodeName==="INPUT"){const e=t,n=e.getAttribute("type");if(n==="button"||n==="submit"||n==="reset")return{name:e.value,nameSource:"text_content"}}},(t,e,n)=>{if(t.nodeName==="BUTTON"||t.nodeName==="LABEL"||t.getAttribute("role")==="button")return fn(t,e,n)},t=>Ae(t,"aria-label"),(t,e,n)=>{const i=t.getAttribute("aria-labelledby");if(i)return{name:i.split(/\s+/).map(r=>rh(t,r)).filter(r=>!!r).map(r=>To(r,e,n)).join(" "),nameSource:"text_content"}},t=>Ae(t,"alt"),t=>Ae(t,"name"),t=>Ae(t,"title"),t=>Ae(t,"placeholder"),(t,e,n)=>{if("options"in t&&t.options.length>0)return fn(t.options[0],e,n)}],nh=[(t,e,n)=>fn(t,e,n)],ih=10;function Tr(t,e,n,i){let r=t,s=0;for(;s<=ih&&r&&r.nodeName!=="BODY"&&r.nodeName!=="HTML"&&r.nodeName!=="HEAD";){for(const o of n){const a=o(r,e,i);if(a){const{name:c,nameSource:l}=a,u=c&&c.trim();if(u)return{name:Eo(wo(u)),nameSource:l}}}if(r.nodeName==="FORM")break;r=r.parentElement,s+=1}}function wo(t){return t.replace(/\s+/g," ")}function Eo(t){return t.length>100?`${ss(t,100)} [...]`:t}function rh(t,e){return t.ownerDocument?t.ownerDocument.getElementById(e):null}function Ae(t,e){return{name:t.getAttribute(e)||"",nameSource:"standard_attribute"}}function fn(t,e,n){return{name:To(t,e,n)||"",nameSource:"text_content"}}function To(t,e,n){if(!t.isContentEditable){if(kn($t.USE_TREE_WALKER_FOR_ACTION_NAME))return sh(t,e,n);if("innerText"in t){let i=t.innerText;const r=s=>{const o=t.querySelectorAll(s);for(let a=0;a<o.length;a+=1){const c=o[a];if("innerText"in c){const l=c.innerText;l&&l.trim().length>0&&(i=i.replace(l,""))}}};return r(`[${An}]`),e&&r(`[${e}]`),n&&r(`${ae(O.HIDDEN)}, ${ae(O.MASK)}`),i}return t.textContent}}function sh(t,e,n){const i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,s);let r="";for(;i.nextNode();){const o=i.currentNode;if(kt(o)){(o.nodeName==="BR"||o.nodeName==="P"||["block","flex","grid","list-item","table","table-caption"].includes(getComputedStyle(o).display))&&(r+=" ");continue}r+=o.textContent||""}return r.replace(/\s+/g," ").trim();function s(o){if(kt(o)){const a=_o(o);if(o.hasAttribute(An)||e&&o.hasAttribute(e)||n&&a&&So(o,a))return NodeFilter.FILTER_REJECT;const c=getComputedStyle(o);if(c.visibility!=="visible"||c.display==="none"||c.contentVisibility&&c.contentVisibility!=="visible")return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}}const oh=[An,"data-testid","data-test","data-qa","data-cy","data-test-id","data-qa-id","data-testing","data-component","data-element","data-source-file"],ah=[ko,lh],ch=[ko,uh,dh];function nn(t,e){if(!t.isConnected)return;let n,i=t;for(;i&&i.nodeName!=="HTML";){const r=Ir(i,ah,fh,e,n);if(r)return r;n=Ir(i,ch,ph,e,n)||Rn(hh(i),n),i=i.parentElement}return n}function Io(t){return/[0-9]/.test(t)}function lh(t){if(t.id&&!Io(t.id))return`#${CSS.escape(t.id)}`}function uh(t){if(t.tagName==="BODY")return;const e=t.classList;for(let n=0;n<e.length;n+=1){const i=e[n];if(!Io(i))return`${CSS.escape(t.tagName)}.${CSS.escape(i)}`}}function dh(t){return CSS.escape(t.tagName)}function ko(t,e){if(e){const i=n(e);if(i)return i}for(const i of oh){const r=n(i);if(r)return r}function n(i){if(t.hasAttribute(i))return`${CSS.escape(t.tagName)}[${i}="${CSS.escape(t.getAttribute(i))}"]`}}function hh(t){let e=t.parentElement.firstElementChild,n=1;for(;e&&e!==t;)e.tagName===t.tagName&&(n+=1),e=e.nextElementSibling;return`${CSS.escape(t.tagName)}:nth-of-type(${n})`}function Ir(t,e,n,i,r){for(const s of e){const o=s(t,i);if(o&&n(t,o,r))return Rn(o,r)}}function fh(t,e,n){return t.ownerDocument.querySelectorAll(Rn(e,n)).length===1}function ph(t,e,n){let i;if(n===void 0)i=o=>o.matches(e);else{const o=Rn(`${e}:scope`,n);i=a=>a.querySelector(o)!==null}let s=t.parentElement.firstElementChild;for(;s;){if(s!==t&&i(s))return!1;s=s.nextElementSibling}return!0}function Rn(t,e){return e?`${t}>${e}`:t}const Co=K,mh=100;function gh(t,e){const n=[];let i=0,r;s(t);function s(c){c.stopObservable.subscribe(o),n.push(c),dt(r),r=H(a,Co)}function o(){i===1&&n.every(c=>c.isStopped())&&(i=2,e(n))}function a(){dt(r),i===0&&(i=1,o())}return{tryAppend:c=>i!==0?!1:n.length>0&&!vh(n[n.length-1].event,c.event)?(a(),!1):(s(c),!0),stop:()=>{a()}}}function vh(t,e){return t.target===e.target&&bh(t,e)<=mh&&t.timeStamp-e.timeStamp<=Co}function bh(t,e){return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))}function yh(t,{onPointerDown:e,onPointerUp:n}){let i,r={selection:!1,input:!1,scroll:!1},s;const o=[U(t,window,"pointerdown",a=>{Cr(a)&&(i=kr(),r={selection:!1,input:!1,scroll:!1},s=e(a))},{capture:!0}),U(t,window,"selectionchange",()=>{(!i||!kr())&&(r.selection=!0)},{capture:!0}),U(t,window,"scroll",()=>{r.scroll=!0},{capture:!0,passive:!0}),U(t,window,"pointerup",a=>{if(Cr(a)&&s){const c=r;n(s,a,()=>c),s=void 0}},{capture:!0}),U(t,window,"input",()=>{r.input=!0},{capture:!0})];return{stop:()=>{o.forEach(a=>a.stop())}}}function kr(){const t=window.getSelection();return!t||t.isCollapsed}function Cr(t){return t.target instanceof Element&&t.isPrimary!==!1}const xr=3;function _h(t,e){if(Sh(t))return e.addFrustration(Ce.RAGE_CLICK),t.some(Ar)&&e.addFrustration(Ce.DEAD_CLICK),e.hasError&&e.addFrustration(Ce.ERROR_CLICK),{isRage:!0};const n=t.some(i=>i.getUserActivity().selection);return t.forEach(i=>{i.hasError&&i.addFrustration(Ce.ERROR_CLICK),Ar(i)&&!n&&i.addFrustration(Ce.DEAD_CLICK)}),{isRage:!1}}function Sh(t){if(t.some(e=>e.getUserActivity().selection||e.getUserActivity().scroll))return!1;for(let e=0;e<t.length-(xr-1);e+=1)if(t[e+xr-1].event.timeStamp-t[e].event.timeStamp<=K)return!0;return!1}const wh='input:not([type="checkbox"]):not([type="radio"]):not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="range"]),textarea,select,[contenteditable],[contenteditable] *,canvas,a[href],a[href] *';function Ar(t){if(t.hasPageActivity||t.getUserActivity().input||t.getUserActivity().scroll)return!1;let e=t.event.target;return e.tagName==="LABEL"&&e.hasAttribute("for")&&(e=document.getElementById(e.getAttribute("for"))),!e||!e.matches(wh)}const xo=10*K,Ge=new Map;function Eh(t){const e=Ge.get(t);return Ge.delete(t),e}function Ao(t,e){Ge.set(t,e),Ge.forEach((n,i)=>{B(i,at())>xo&&Ge.delete(i)})}const Th=5*st;function Ih(t,e,n,i){const r=Se({expireDelay:Th}),s=new R;let o;t.subscribe(10,()=>{r.reset()}),t.subscribe(5,u),t.subscribe(11,d=>{d.reason===ce.UNLOADING&&u()});const{stop:a}=yh(i,{onPointerDown:d=>kh(i,t,e,d,n),onPointerUp:({clickActionBase:d,hadActivityOnPointerDown:h},p,f)=>{Ch(i,t,e,n,r,s,l,d,p,f,h)}});return{stop:()=>{u(),s.notify(),a()},actionContexts:{findActionId:d=>r.findAll(d)}};function l(d){if(!o||!o.tryAppend(d)){const h=d.clone();o=gh(d,p=>{Ah(p,h)})}}function u(){o&&o.stop()}}function kh(t,e,n,i,r){const s=t.enablePrivacyForActionName?yo(i.target,t.defaultPrivacyLevel):O.ALLOW;if(s===O.HIDDEN)return;const o=xh(i,s,t);let a=!1;return Pi(e,n,r,t,c=>{a=c.hadActivity},bo),{clickActionBase:o,hadActivityOnPointerDown:()=>a}}function Ch(t,e,n,i,r,s,o,a,c,l,u){var d;const h=Ro(e,r,l,a,c);o(h);const p=(d=a?.target)===null||d===void 0?void 0:d.selector;p&&Ao(c.timeStamp,p);const{stop:f}=Pi(e,n,i,t,E=>{E.hadActivity&&E.end<h.startClocks.timeStamp?h.discard():E.hadActivity?h.stop(E.end):u()?h.stop(h.startClocks.timeStamp):h.stop()},xo),v=e.subscribe(5,({endClocks:E})=>{h.stop(E.timeStamp)}),S=s.subscribe(()=>{h.stop()});h.stopObservable.subscribe(()=>{v.unsubscribe(),f(),S.unsubscribe()})}function xh(t,e,n){const i=t.target.getBoundingClientRect(),r=nn(t.target,n.actionNameAttribute);r&&Ao(t.timeStamp,r);const s=th(t.target,n,e);return{type:Ni.CLICK,target:{width:Math.round(i.width),height:Math.round(i.height),selector:r},position:{x:Math.round(t.clientX-i.left),y:Math.round(t.clientY-i.top)},name:s.name,nameSource:s.nameSource}}function Ro(t,e,n,i,r){const s=X(),o=q(),a=e.add(s,o.relative),c=mo({lifeCycle:t,isChildEvent:f=>f.action!==void 0&&(Array.isArray(f.action.id)?f.action.id.includes(s):f.action.id===s)});let l=0,u;const d=[],h=new R;function p(f){l===0&&(u=f,l=1,u?a.close(bi(u)):a.remove(),c.stop(),h.notify())}return{event:r,stop:p,stopObservable:h,get hasError(){return c.eventCounts.errorCount>0},get hasPageActivity(){return u!==void 0},getUserActivity:n,addFrustration:f=>{d.push(f)},startClocks:o,isStopped:()=>l===1||l===2,clone:()=>Ro(t,e,n,i,r),validate:f=>{if(p(),l!==1)return;const{resourceCount:v,errorCount:S,longTaskCount:E}=c.eventCounts,T={duration:u&&B(o.timeStamp,u),startClocks:o,id:s,frustrationTypes:d,counts:{resourceCount:v,errorCount:S,longTaskCount:E},events:f??[r],event:r,...i};t.notify(0,T),l=2},discard:()=>{p(),l=2}}}function Ah(t,e){const{isRage:n}=_h(t,e);n?(t.forEach(i=>i.discard()),e.stop(z()),e.validate(t.map(i=>i.event))):(e.discard(),t.forEach(i=>i.validate()))}function Rh(t,e,n,i,r){t.subscribe(0,a=>t.notify(12,Rr(a))),e.register(0,({startTime:a,eventType:c})=>{if(c!==C.ERROR&&c!==C.RESOURCE&&c!==C.LONG_TASK)return ct;const l=s.findActionId(a);return l?{type:c,action:{id:l}}:ct}),e.register(1,({startTime:a})=>({action:{id:s.findActionId(a)}}));let s={findActionId:N},o=N;return r.trackUserInteractions&&({actionContexts:s,stop:o}=Ih(t,n,i,r)),{addAction:a=>{t.notify(12,Rr(a))},actionContexts:s,stop:o}}function Rr(t){const e=ti(t)?{action:{id:t.id,loading_time:po(k(t.duration)),frustration:{type:t.frustrationTypes},error:{count:t.counts.errorCount},long_task:{count:t.counts.longTaskCount},resource:{count:t.counts.resourceCount}},_dd:{action:{target:t.target,position:t.position,name_source:t.nameSource}}}:{context:t.context},n=It({action:{id:X(),target:{name:t.name},type:t.type},date:t.startClocks.timeStamp,type:C.ACTION},e),i=ti(t)?t.duration:void 0,r=ti(t)?{events:t.events}:{handlingStack:t.handlingStack};return{rawRumEvent:n,duration:i,startTime:t.startClocks.relative,domainContext:r}}function ti(t){return t.type!==Ni.CUSTOM}function Lh(t){const e=wu([_n.error]).subscribe(n=>t.notify(n.error));return{stop:()=>{e.unsubscribe()}}}function Oh(t,e){const n=zl(t,[Ke.cspViolation,Ke.intervention]).subscribe(i=>e.notify(i));return{stop:()=>{n.unsubscribe()}}}function Dh(t,e,n){const i=new R;return n.subscribe(r=>{r.type===0&&i.notify(r.error)}),Lh(i),Oh(e,i),i.subscribe(r=>t.notify(14,{error:r})),Nh(t)}function Nh(t){return t.subscribe(14,({error:e})=>{t.notify(12,Mh(e))}),{addError:({error:e,handlingStack:n,componentStack:i,startClocks:r,context:s})=>{const o=wi({originalError:e,handlingStack:n,componentStack:i,startClocks:r,nonErrorPrefix:"Provided",source:ye.CUSTOM,handling:"handled"});o.context=It(o.context,s),t.notify(14,{error:o})}}}function Mh(t){const e={date:t.startClocks.timeStamp,error:{id:X(),message:t.message,source:t.source,stack:t.stack,handling_stack:t.handlingStack,component_stack:t.componentStack,type:t.type,handling:t.handling,causes:t.causes,source_type:"browser",fingerprint:t.fingerprint,csp:t.csp},type:C.ERROR,context:t.context},n={error:t.originalError,handlingStack:t.handlingStack};return{rawRumEvent:e,startTime:t.startClocks.relative,domainContext:n}}const Lr=new WeakSet;function Ph(t){if(!performance||!("getEntriesByName"in performance))return;const e=performance.getEntriesByName(t.url,"resource");if(!e.length||!("toJSON"in e[0]))return;const n=e.filter(i=>!Lr.has(i)).filter(i=>uo(i)&&ho(i)).filter(i=>Uh(i,t.startClocks.relative,Lo({startTime:t.startClocks.relative,duration:t.duration})));if(n.length===1)return Lr.add(n[0]),n[0].toJSON()}function Lo(t){return ge(t.startTime,t.duration)}function Uh(t,e,n){return t.startTime>=e-1&&Lo(t)<=ge(n,1)}const Bh=2*st;function Fh(t){const e=Vh(t)||$h(t);if(!(!e||e.traceTime<=ht()-Bh))return e.traceId}function Vh(t){const e=t.querySelector("meta[name=dd-trace-id]"),n=t.querySelector("meta[name=dd-trace-time]");return Oo(e&&e.content,n&&n.content)}function $h(t){const e=zh(t);if(e)return Oo(je(e,"trace-id"),je(e,"trace-time"))}function Oo(t,e){const n=e&&Number(e);if(!(!t||!n))return{traceId:t,traceTime:n}}function zh(t){for(let e=0;e<t.childNodes.length;e+=1){const n=Or(t.childNodes[e]);if(n)return n}if(t.body)for(let e=t.body.childNodes.length-1;e>=0;e-=1){const n=t.body.childNodes[e],i=Or(n);if(i)return i;if(!go(n))break}}function Or(t){if(t&&Fd(t)){const e=/^\s*DATADOG;(.*?)\s*$/.exec(t.data);if(e)return e[1]}}function Do(){if(jt(L.NAVIGATION)){const n=performance.getEntriesByType(L.NAVIGATION)[0];if(n)return n}const t=Gh(),e={entryType:L.NAVIGATION,initiatorType:"navigation",name:window.location.href,startTime:0,duration:t.loadEventEnd,decodedBodySize:0,encodedBodySize:0,transferSize:0,workerStart:0,toJSON:()=>({...e,toJSON:void 0}),...t};return e}function Gh(){const t={},e=performance.timing;for(const n in e)if(Ye(e[n])){const i=n,r=e[i];t[i]=r===0?0:bi(r)}return t}function qh(t,e,n=Do){Li(t,"interactive",()=>{const i=n(),r=Object.assign(i.toJSON(),{entryType:L.RESOURCE,initiatorType:co,duration:i.responseEnd,traceId:Fh(document),toJSON:()=>({...r,toJSON:void 0})});e(r)})}const Wh=1e3;function jh(t){const e=new Set,n=t.subscribe(8,i=>{e.add(i),e.size>Wh&&(Dt("Too many requests"),e.delete(e.values().next().value))});return{getMatchingRequest(i){let r=1/0,s;for(const o of e){const a=i.startTime-o.startClocks.relative;0<=a&&a<r&&o.url===i.name&&(r=Math.abs(a),s=o)}return s&&e.delete(s),s},stop(){n.unsubscribe()}}}function Hh(t,e,n,i=Su(),r=qh){let s;const o=kn($t.EARLY_REQUEST_COLLECTION);o?s=jh(t):t.subscribe(8,l=>{c(()=>Kh(l,e,n))});const a=_t(e,{type:L.RESOURCE,buffered:!0}).subscribe(l=>{for(const u of l)(o||!lo(u))&&c(()=>Dr(u,e,n,s))});r(e,l=>{c(()=>Dr(l,e,n,s))});function c(l){i.push(()=>{const u=l();u&&t.notify(12,u)})}return{stop:()=>{a.unsubscribe()}}}function Kh(t,e,n){const i=Ph(t);return No(i,t,n,e)}function Dr(t,e,n,i){const r=lo(t)&&i?i.getMatchingRequest(t):void 0;return No(t,r,n,e)}function No(t,e,n,i){if(!t&&!e)return;const r=e?Zh(e,i):Jh(t,i);if(!i.trackResources&&!r)return;const s=t?wn(t.startTime):e.startClocks,o=t?Sd(t):Qh(n,s,e.duration),a=It({date:s.timeStamp,resource:{id:X(),duration:k(o),type:e?e.type===xn.XHR?et.XHR:et.FETCH:_d(t),method:e?e.method:void 0,status_code:e?e.status:tf(t.responseStatus),url:e?Ad(e.url):t.name,protocol:t&&Td(t),delivery_type:t&&Id(t)},type:C.RESOURCE,_dd:{discarded:!i.trackResources}},r,t&&Yh(t));return{startTime:s.relative,duration:o,rawRumEvent:a,domainContext:Xh(t,e)}}function Xh(t,e){if(e){const n={performanceEntry:t,isAborted:e.isAborted,handlingStack:e.handlingStack};return e.type===xn.XHR?{xhr:e.xhr,...n}:{requestInput:e.input,requestInit:e.init,response:e.response,error:e.error,...n}}return{performanceEntry:t}}function Yh(t){const{renderBlockingStatus:e}=t;return{resource:{render_blocking_status:e,...kd(t),...wd(t)}}}function Zh(t,e){if(t.traceSampled&&t.traceId&&t.spanId)return{_dd:{span_id:t.spanId.toString(),trace_id:t.traceId.toString(),rule_psr:e.rulePsr}}}function Jh(t,e){if(t.traceId)return{_dd:{trace_id:t.traceId,span_id:so().toString(),rule_psr:e.rulePsr}}}function Qh(t,e,n){return t.wasInPageStateDuringPeriod("frozen",e.relative,n)?void 0:n}function tf(t){return t===0?void 0:t}function ef(t,e,n){const{stop:i,eventCounts:r}=mo({lifeCycle:t,isChildEvent:s=>s.view.id===e,onChange:n});return{stop:i,eventCounts:r}}const nf=10*st;function rf(t,e,n){return{stop:_t(t,{type:L.PAINT,buffered:!0}).subscribe(r=>{const s=r.find(o=>o.name==="first-contentful-paint"&&o.startTime<e.timeStamp&&o.startTime<nf);s&&n(s.startTime)}).unsubscribe}}function sf(t,e){requestAnimationFrame(()=>{requestAnimationFrame(()=>{e(B(t,at()))})})}function of(t,e,n){const i=_t(t,{type:L.FIRST_INPUT,buffered:!0}).subscribe(r=>{const s=r.find(o=>o.startTime<e.timeStamp);if(s){const o=B(s.startTime,s.processingStart);let a;s.target&&kt(s.target)&&(a=nn(s.target,t.actionNameAttribute)),n({delay:o>=0?o:0,time:s.startTime,targetSelector:a})}});return{stop:()=>{i.unsubscribe()}}}function af(t,e,n=Do){return uf(t,()=>{const i=n();lf(i)||e(cf(i))})}function cf(t){return{domComplete:t.domComplete,domContentLoaded:t.domContentLoadedEventEnd,domInteractive:t.domInteractive,loadEvent:t.loadEventEnd,firstByte:t.responseStart>=0&&t.responseStart<=at()?t.responseStart:void 0}}function lf(t){return t.loadEventEnd<=0}function uf(t,e){let n;const{stop:i}=Li(t,"complete",()=>{n=H(()=>e())});return{stop:()=>{i(),dt(n)}}}const df=10*st;function hf(t,e,n,i){let r=1/0;const{stop:s}=Lt(t,n,["pointerdown","keydown"],c=>{r=c.timeStamp},{capture:!0,once:!0});let o=0;const a=_t(t,{type:L.LARGEST_CONTENTFUL_PAINT,buffered:!0}).subscribe(c=>{const l=Fa(c,u=>u.entryType===L.LARGEST_CONTENTFUL_PAINT&&u.startTime<r&&u.startTime<e.timeStamp&&u.startTime<df&&u.size>o);if(l){let u;l.element&&(u=nn(l.element,t.actionNameAttribute)),i({value:l.startTime,targetSelector:u,resourceUrl:ff(l)}),o=l.size}});return{stop:()=>{s(),a.unsubscribe()}}}function ff(t){return t.url===""?void 0:t.url}function Mo(t,e,n=window){if(document.visibilityState==="hidden")return{timeStamp:0,stop:N};if(jt(L.VISIBILITY_STATE)){const s=performance.getEntriesByType(L.VISIBILITY_STATE).filter(o=>o.name==="hidden").find(o=>o.startTime>=e.relative);if(s)return{timeStamp:s.startTime,stop:N}}let i=1/0;const{stop:r}=Lt(t,n,["pagehide","visibilitychange"],s=>{(s.type==="pagehide"||document.visibilityState==="hidden")&&(i=s.timeStamp,r())},{capture:!0});return{get timeStamp(){return i},stop:r}}function pf(t,e,n,i){const r={},{stop:s}=af(t,d=>{n(d.loadEvent),r.navigationTimings=d,i()}),o=Mo(t,e),{stop:a}=rf(t,o,d=>{r.firstContentfulPaint=d,i()}),{stop:c}=hf(t,o,window,d=>{r.largestContentfulPaint=d,i()}),{stop:l}=of(t,o,d=>{r.firstInput=d,i()});function u(){s(),a(),c(),l(),o.stop()}return{stop:u,initialViewMetrics:r}}const mi=(t,e)=>t*e,mf=(t,e)=>{const n=Math.max(t.left,e.left),i=Math.max(t.top,e.top),r=Math.min(t.right,e.right),s=Math.min(t.bottom,e.bottom);return n>=r||i>=s?0:mi(r-n,s-i)},Nr=t=>{const e=mi(t.previousRect.width,t.previousRect.height),n=mi(t.currentRect.width,t.currentRect.height),i=mf(t.previousRect,t.currentRect);return e+n-i};function gf(t,e,n){if(!Sf())return{stop:N};let i=0,r;n({value:0});const s=_f(),o=_t(t,{type:L.LAYOUT_SHIFT,buffered:!0}).subscribe(a=>{var c;for(const l of a){if(l.hadRecentInput||l.startTime<e)continue;const{cumulatedValue:u,isMaxValue:d}=s.update(l);if(d){const h=vf(l.sources);r={target:h?.node?new WeakRef(h.node):void 0,time:B(e,l.startTime),previousRect:h?.previousRect,currentRect:h?.currentRect,devicePixelRatio:window.devicePixelRatio}}if(u>i){i=u;const h=(c=r?.target)===null||c===void 0?void 0:c.deref();n({value:Ve(i,4),targetSelector:h&&nn(h,t.actionNameAttribute),time:r?.time,previousRect:r?.previousRect?Mr(r.previousRect):void 0,currentRect:r?.currentRect?Mr(r.currentRect):void 0,devicePixelRatio:r?.devicePixelRatio})}}});return{stop:()=>{o.unsubscribe()}}}function vf(t){let e;for(const n of t)if(n.node&&kt(n.node)){const i=Nr(n);(!e||Nr(e)<i)&&(e=n)}return e}function Mr({x:t,y:e,width:n,height:i}){return{x:t,y:e,width:n,height:i}}const bf=5*K,yf=K;function _f(){let t=0,e,n,i=0;return{update:r=>{const s=e===void 0||r.startTime-n>=yf||r.startTime-e>=bf;let o;return s?(e=n=r.startTime,i=t=r.value,o=!0):(t+=r.value,n=r.startTime,o=r.value>i,o&&(i=r.value)),{cumulatedValue:t,isMaxValue:o}}}}function Sf(){return jt(L.LAYOUT_SHIFT)&&"WeakRef"in window}let pn,Po=0,ei=1/0,ni=0;function wf(){"interactionCount"in performance||pn||(pn=new window.PerformanceObserver(I(t=>{t.getEntries().forEach(e=>{const n=e;n.interactionId&&(ei=Math.min(ei,n.interactionId),ni=Math.max(ni,n.interactionId),Po=(ni-ei)/7+1)})})),pn.observe({type:"event",buffered:!0,durationThreshold:0}))}const Pr=()=>pn?Po:window.performance.interactionCount||0,Ur=10,Ef=1*st;function Tf(t,e,n){if(!Cf())return{getInteractionToNextPaint:()=>{},setViewEnd:N,stop:N};const{getViewInteractionCount:i,stopViewInteractionCount:r}=kf(n);let s=1/0;const o=If(i);let a=-1,c,l;function u(p){for(const v of p)v.interactionId&&v.startTime>=e&&v.startTime<=s&&o.process(v);const f=o.estimateP98Interaction();f&&f.duration!==a&&(a=f.duration,l=B(e,f.startTime),c=Eh(f.startTime),!c&&f.target&&kt(f.target)&&(c=nn(f.target,t.actionNameAttribute)))}const d=_t(t,{type:L.FIRST_INPUT,buffered:!0}).subscribe(u),h=_t(t,{type:L.EVENT,durationThreshold:40,buffered:!0}).subscribe(u);return{getInteractionToNextPaint:()=>{if(a>=0)return{value:Math.min(a,Ef),targetSelector:c,time:l};if(i())return{value:0}},setViewEnd:p=>{s=p,r()},stop:()=>{h.unsubscribe(),d.unsubscribe()}}}function If(t){const e=[];function n(){e.sort((i,r)=>r.duration-i.duration).splice(Ur)}return{process(i){const r=e.findIndex(o=>i.interactionId===o.interactionId),s=e[e.length-1];r!==-1?i.duration>e[r].duration&&(e[r]=i,n()):(e.length<Ur||i.duration>s.duration)&&(e.push(i),n())},estimateP98Interaction(){const i=Math.min(e.length-1,Math.floor(t()/50));return e[i]}}}function kf(t){wf();const e=t===Et.INITIAL_LOAD?0:Pr();let n={stopped:!1};function i(){return Pr()-e}return{getViewInteractionCount:()=>n.stopped?n.interactionCount:i(),stopViewInteractionCount:()=>{n={stopped:!0,interactionCount:i()}}}}function Cf(){return jt(L.EVENT)&&window.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype}function xf(t,e,n,i,r,s,o){let a=r===Et.INITIAL_LOAD,c=!0;const l=[],u=Mo(i,s);function d(){if(!c&&!a&&l.length>0){const p=Math.max(...l);p<u.timeStamp-s.relative&&o(p)}}const{stop:h}=Pi(t,e,n,i,p=>{c&&(c=!1,p.hadActivity&&l.push(B(s.timeStamp,p.end)),d())});return{stop:()=>{h(),u.stop()},setLoadEvent:p=>{a&&(a=!1,l.push(p),d())}}}function Gm(){let t;const e=window.visualViewport;return e?t=e.pageLeft-e.offsetLeft:window.scrollX!==void 0?t=window.scrollX:t=window.pageXOffset||0,Math.round(t)}function Af(){let t;const e=window.visualViewport;return e?t=e.pageTop-e.offsetTop:window.scrollY!==void 0?t=window.scrollY:t=window.pageYOffset||0,Math.round(t)}let ii;function Rf(t){return ii||(ii=Lf(t)),ii}function Lf(t){return new R(e=>{const{throttled:n}=Tn(()=>{e.notify(Ui())},200);return U(t,window,"resize",n,{capture:!0,passive:!0}).stop})}function Ui(){const t=window.visualViewport;return t?{width:Number(t.width*t.scale),height:Number(t.height*t.scale)}:{width:Number(window.innerWidth||0),height:Number(window.innerHeight||0)}}const Of=K;function Df(t,e,n,i=Mf(t)){let r=0,s=0,o=0;const a=i.subscribe(({scrollDepth:c,scrollTop:l,scrollHeight:u})=>{let d=!1;if(c>r&&(r=c,d=!0),u>s){s=u;const h=at();o=B(e.relative,h),d=!0}d&&n({maxDepth:Math.min(r,s),maxDepthScrollTop:l,maxScrollHeight:s,maxScrollHeightTime:o})});return{stop:()=>a.unsubscribe()}}function Nf(){const t=Af(),{height:e}=Ui(),n=Math.round((document.scrollingElement||document.documentElement).scrollHeight),i=Math.round(e+t);return{scrollHeight:n,scrollDepth:i,scrollTop:t}}function Mf(t,e=Of){return new R(n=>{function i(){n.notify(Nf())}if(window.ResizeObserver){const r=Tn(i,e,{leading:!1,trailing:!0}),s=document.scrollingElement||document.documentElement,o=new ResizeObserver(I(r.throttled));s&&o.observe(s);const a=U(t,window,"scroll",r.throttled,{passive:!0});return()=>{r.cancel(),o.disconnect(),a.stop()}}})}function Pf(t,e,n,i,r,s,o){const a={},{stop:c,setLoadEvent:l}=xf(t,e,n,i,s,o,v=>{a.loadingTime=v,r()}),{stop:u}=Df(i,o,v=>{a.scroll=v}),{stop:d}=gf(i,o.relative,v=>{a.cumulativeLayoutShift=v,r()}),{stop:h,getInteractionToNextPaint:p,setViewEnd:f}=Tf(i,o.relative,s);return{stop:()=>{c(),d(),u()},stopINPTracking:h,setLoadEvent:l,setViewEnd:f,getCommonViewMetrics:()=>(a.interactionToNextPaint=p(),a)}}function Uf(t,e){const{stop:n}=U(t,window,"pageshow",i=>{i.persisted&&e(i)},{capture:!0});return n}function Bf(t,e,n){sf(t.relative,i=>{e.firstContentfulPaint=i,e.largestContentfulPaint={value:i},n()})}const Ff=3e3,Vf=5*st,$f=5*st;function zf(t,e,n,i,r,s,o,a){const c=new Set;let l=h(Et.INITIAL_LOAD,Jr(),a),u;p();let d;o&&(d=f(s),r.trackBfcacheViews&&(u=Uf(r,v=>{l.end();const S=wn(v.timeStamp);l=h(Et.BF_CACHE,S,void 0)})));function h(v,S,E){const T=Gf(e,n,i,r,t,v,S,E);return c.add(T),T.stopObservable.subscribe(()=>{c.delete(T)}),T}function p(){e.subscribe(10,()=>{l=h(Et.ROUTE_CHANGE,void 0,{name:l.name,service:l.service,version:l.version,context:l.contextManager.getContext()})}),e.subscribe(9,()=>{l.end({sessionIsActive:!1})})}function f(v){return v.subscribe(({oldLocation:S,newLocation:E})=>{Wf(S,E)&&(l.end(),l=h(Et.ROUTE_CHANGE))})}return{addTiming:(v,S=z())=>{l.addTiming(v,S)},startView:(v,S)=>{l.end({endClocks:S}),l=h(Et.ROUTE_CHANGE,S,v)},setViewContext:v=>{l.contextManager.setContext(v)},setViewContextProperty:(v,S)=>{l.contextManager.setContextProperty(v,S)},setViewName:v=>{l.setViewName(v)},getViewContext:()=>l.contextManager.getContext(),stop:()=>{d&&d.unsubscribe(),u&&u(),l.end(),c.forEach(v=>v.stop())}}}function Gf(t,e,n,i,r,s,o=q(),a){const c=X(),l=new R,u={};let d=0,h;const p=We(r),f=Cn();let v=!0,S=a?.name;const E=a?.service||i.service,T=a?.version||i.version,g=a?.context;g&&f.setContext(g);const b={id:c,name:S,startClocks:o,service:E,version:T,context:g};t.notify(1,b),t.notify(2,b);const{throttled:w,cancel:m}=Tn(lt,Ff,{leading:!1}),{setLoadEvent:y,setViewEnd:_,stop:D,stopINPTracking:M,getCommonViewMetrics:W}=Pf(t,e,n,i,rt,s,o),{stop:nt,initialViewMetrics:it}=s===Et.INITIAL_LOAD?pf(i,o,y,rt):{stop:N,initialViewMetrics:{}};s===Et.BF_CACHE&&Bf(o,it,rt);const{stop:pt,eventCounts:mt}=ef(t,c,rt),Ht=ve(lt,Vf),Nt=t.subscribe(11,Y=>{Y.reason===ce.UNLOADING&&lt()});lt(),f.changeObservable.subscribe(rt);function Ct(){t.notify(3,{id:c,name:S,context:f.getContext(),startClocks:o,sessionIsActive:v})}function rt(){Ct(),w()}function lt(){m(),Ct(),d+=1;const Y=h===void 0?z():h.timeStamp;t.notify(4,{customTimings:u,documentVersion:d,id:c,name:S,service:E,version:T,context:f.getContext(),loadingType:s,location:p,startClocks:o,commonViewMetrics:W(),initialViewMetrics:it,duration:B(o.timeStamp,Y),isActive:h===void 0,sessionIsActive:v,eventCounts:mt})}return{get name(){return S},service:E,version:T,contextManager:f,stopObservable:l,end(Y={}){var Z,P;h||(h=(Z=Y.endClocks)!==null&&Z!==void 0?Z:q(),v=(P=Y.sessionIsActive)!==null&&P!==void 0?P:!0,t.notify(5,{endClocks:h}),t.notify(6,{endClocks:h}),En(Ht),_(h.relative),D(),Nt.unsubscribe(),lt(),H(()=>{this.stop()},$f))},stop(){nt(),pt(),M(),l.notify()},addTiming(Y,Z){if(h)return;const P=Ra(Z)?Z:B(o.timeStamp,Z);u[qf(Y)]=P,rt()},setViewName(Y){S=Y,lt()}}}function qf(t){const e=t.replace(/[^a-zA-Z0-9-_.@$]/g,"_");return e!==t&&x.warn(`Invalid timing name: ${t}, sanitized to: ${e}`),e}function Wf(t,e){return t.pathname!==e.pathname||!jf(e.hash)&&Br(e.hash)!==Br(t.hash)}function jf(t){const e=t.substring(1);return e!==""&&!!document.getElementById(e)}function Br(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}function Hf(t,e,n,i,r,s,o,a,c,l){return t.subscribe(4,u=>t.notify(12,Kf(u,n,a))),e.register(0,({startTime:u,eventType:d})=>{const h=c.findView(u);return h?{type:d,service:h.service,version:h.version,context:h.context,view:{id:h.id,name:h.name}}:Ot}),e.register(1,({startTime:u})=>{var d;return{view:{id:(d=c.findView(u))===null||d===void 0?void 0:d.id}}}),zf(i,t,r,s,n,o,!n.trackViewsManually,l)}function Kf(t,e,n){var i,r,s,o,a,c,l,u,d,h,p,f,v,S,E,T,g,b;const w=n.getReplayStats(t.id),m=(r=(i=t.commonViewMetrics)===null||i===void 0?void 0:i.cumulativeLayoutShift)===null||r===void 0?void 0:r.devicePixelRatio,y={_dd:{document_version:t.documentVersion,replay_stats:w,cls:m?{device_pixel_ratio:m}:void 0,configuration:{start_session_replay_recording_manually:e.startSessionReplayRecordingManually}},date:t.startClocks.timeStamp,type:C.VIEW,view:{action:{count:t.eventCounts.actionCount},frustration:{count:t.eventCounts.frustrationCount},cumulative_layout_shift:(s=t.commonViewMetrics.cumulativeLayoutShift)===null||s===void 0?void 0:s.value,cumulative_layout_shift_time:k((o=t.commonViewMetrics.cumulativeLayoutShift)===null||o===void 0?void 0:o.time),cumulative_layout_shift_target_selector:(a=t.commonViewMetrics.cumulativeLayoutShift)===null||a===void 0?void 0:a.targetSelector,first_byte:k((c=t.initialViewMetrics.navigationTimings)===null||c===void 0?void 0:c.firstByte),dom_complete:k((l=t.initialViewMetrics.navigationTimings)===null||l===void 0?void 0:l.domComplete),dom_content_loaded:k((u=t.initialViewMetrics.navigationTimings)===null||u===void 0?void 0:u.domContentLoaded),dom_interactive:k((d=t.initialViewMetrics.navigationTimings)===null||d===void 0?void 0:d.domInteractive),error:{count:t.eventCounts.errorCount},first_contentful_paint:k(t.initialViewMetrics.firstContentfulPaint),first_input_delay:k((h=t.initialViewMetrics.firstInput)===null||h===void 0?void 0:h.delay),first_input_time:k((p=t.initialViewMetrics.firstInput)===null||p===void 0?void 0:p.time),first_input_target_selector:(f=t.initialViewMetrics.firstInput)===null||f===void 0?void 0:f.targetSelector,interaction_to_next_paint:k((v=t.commonViewMetrics.interactionToNextPaint)===null||v===void 0?void 0:v.value),interaction_to_next_paint_time:k((S=t.commonViewMetrics.interactionToNextPaint)===null||S===void 0?void 0:S.time),interaction_to_next_paint_target_selector:(E=t.commonViewMetrics.interactionToNextPaint)===null||E===void 0?void 0:E.targetSelector,is_active:t.isActive,name:t.name,largest_contentful_paint:k((T=t.initialViewMetrics.largestContentfulPaint)===null||T===void 0?void 0:T.value),largest_contentful_paint_target_selector:(g=t.initialViewMetrics.largestContentfulPaint)===null||g===void 0?void 0:g.targetSelector,load_event:k((b=t.initialViewMetrics.navigationTimings)===null||b===void 0?void 0:b.loadEvent),loading_time:po(k(t.commonViewMetrics.loadingTime)),loading_type:t.loadingType,long_task:{count:t.eventCounts.longTaskCount},performance:Xf(t.commonViewMetrics,t.initialViewMetrics),resource:{count:t.eventCounts.resourceCount},time_spent:k(t.duration)},display:t.commonViewMetrics.scroll?{scroll:{max_depth:t.commonViewMetrics.scroll.maxDepth,max_depth_scroll_top:t.commonViewMetrics.scroll.maxDepthScrollTop,max_scroll_height:t.commonViewMetrics.scroll.maxScrollHeight,max_scroll_height_time:k(t.commonViewMetrics.scroll.maxScrollHeightTime)}}:void 0,privacy:{replay_level:e.defaultPrivacyLevel},device:{locale:navigator.language,locales:navigator.languages,time_zone:Bu()}};return zt(t.customTimings)||(y.view.custom_timings=es(t.customTimings,k)),{rawRumEvent:y,startTime:t.startClocks.relative,duration:t.duration,domainContext:{location:t.location}}}function Xf({cumulativeLayoutShift:t,interactionToNextPaint:e},{firstContentfulPaint:n,firstInput:i,largestContentfulPaint:r}){return{cls:t&&{score:t.value,timestamp:k(t.time),target_selector:t.targetSelector,previous_rect:t.previousRect,current_rect:t.currentRect},fcp:n&&{timestamp:k(n)},fid:i&&{duration:k(i.delay),timestamp:k(i.time),target_selector:i.targetSelector},inp:e&&{duration:k(e.value),timestamp:k(e.time),target_selector:e.targetSelector},lcp:r&&{timestamp:k(r.value),target_selector:r.targetSelector,resource_url:r.resourceUrl}}}const Yf="rum";function Zf(t,e,n){const i=tu(t,Yf,r=>Qf(t,r),n);return i.expireObservable.subscribe(()=>{e.notify(9)}),i.renewObservable.subscribe(()=>{e.notify(10)}),i.sessionStateUpdateObservable.subscribe(({previousState:r,newState:s})=>{if(!r.forcedReplay&&s.forcedReplay){const o=i.findSession();o&&(o.isReplayForced=!0)}}),{findTrackedSession:r=>{const s=i.findSession(r);if(!(!s||s.trackingType==="0"))return{id:s.id,sessionReplay:s.trackingType==="1"?1:s.isReplayForced?2:0,anonymousId:s.anonymousId}},expire:i.expire,expireObservable:i.expireObservable,setForcedReplay:()=>i.updateSessionState({forcedReplay:"1"})}}function Jf(){const t={id:"00000000-aaaa-0000-aaaa-000000000000",sessionReplay:Ns("records")?1:0};return{findTrackedSession:()=>t,expire:N,expireObservable:new R,setForcedReplay:N}}function Qf(t,e){return tp(e)?e:Tt(t.sessionSampleRate)?Tt(t.sessionReplaySampleRate)?"1":"2":"0"}function tp(t){return t==="0"||t==="1"||t==="2"}function ep(t,e,n,i,r,s){const o=[t.rumEndpointBuilder];t.replica&&o.push(t.replica.rumEndpointBuilder);const a=Ms({encoder:s(2),request:Ds(o,t.batchBytesLimit,n),flushController:Ps({messagesLimit:t.batchMessagesLimit,bytesLimit:t.batchBytesLimit,durationLimit:t.flushTimeout,pageMayExitObservable:i,sessionExpireObservable:r}),messageBytesLimit:t.messageBytesLimit});return e.subscribe(13,c=>{c.type===C.VIEW?a.upsert(c,c.view.id):a.add(c)}),a}function np(t){const e=en();t.subscribe(13,n=>{e.send("rum",n)})}const ip=Gt;function rp(t,e,n,i){const r=Se({expireDelay:ip});let s;t.subscribe(1,({startClocks:c})=>{const l=i.href;r.add(a({url:l,referrer:s||document.referrer}),c.relative),s=l}),t.subscribe(6,({endClocks:c})=>{r.closeActive(c.relative)});const o=n.subscribe(({newLocation:c})=>{const l=r.find();if(l){const u=at();r.closeActive(u),r.add(a({url:c.href,referrer:l.referrer}),u)}});function a({url:c,referrer:l}){return{url:c,referrer:l}}return e.register(0,({startTime:c,eventType:l})=>{const u=r.find(c);return u?{type:l,view:{url:u.url,referrer:u.referrer}}:Ot}),{findUrl:c=>r.find(c),stop:()=>{o.unsubscribe(),r.stop()}}}function sp(t,e){let n=We(e);return new R(i=>{const{stop:r}=op(t,o),{stop:s}=ap(t,o);function o(){if(n.href===e.href)return;const a=We(e);i.notify({newLocation:a,oldLocation:n}),n=a}return()=>{r(),s()}})}function op(t,e){const{stop:n}=yt(Fr("pushState"),"pushState",({onPostCall:s})=>{s(e)}),{stop:i}=yt(Fr("replaceState"),"replaceState",({onPostCall:s})=>{s(e)}),{stop:r}=U(t,window,"popstate",e);return{stop:()=>{n(),i(),r()}}}function ap(t,e){return U(t,window,"hashchange",e)}function Fr(t){return Object.prototype.hasOwnProperty.call(history,t)?history:History.prototype}const cp=Gt;function lp(t,e,n){const i=Se({expireDelay:cp});return t.subscribe(1,({startClocks:r})=>{i.add({},r.relative)}),t.subscribe(6,({endClocks:r})=>{i.closeActive(r.relative)}),e.register(0,({startTime:r,eventType:s})=>{if(!n.trackFeatureFlagsForEvents.concat([C.VIEW,C.ERROR]).includes(s))return ct;const a=i.find(r);return!a||zt(a)?ct:{type:s,feature_flags:a}}),{addFeatureFlagEvaluation:(r,s)=>{const o=i.find();o&&(o[r]=s)}}}const up=10*K;let le,ln;function dp(t,e,n,i){e.enabled&&Tt(t.customerDataTelemetrySampleRate)&&(Uo(),ln=!1,n.subscribe(13,()=>{ln=!0}),i.subscribe(({bytesCount:s,messagesCount:o})=>{ln&&(ln=!1,le.batchCount+=1,$r(le.batchBytesCount,s),$r(le.batchMessagesCount,o))}),ve(hp,up))}function hp(){le.batchCount!==0&&(ki("Customer data measures",le),Uo())}function Vr(){return{min:1/0,max:0,sum:0}}function $r(t,e){t.sum+=e,t.min=Math.min(t.min,e),t.max=Math.max(t.max,e)}function Uo(){le={batchCount:0,batchBytesCount:Vr(),batchMessagesCount:Vr()}}const fp=4e3,pp=500,mp=Gt;function gp(t,e,n=pp){const i=Se({expireDelay:mp,maxEntries:fp});let r;jt(L.VISIBILITY_STATE)&&performance.getEntriesByType(L.VISIBILITY_STATE).forEach(l=>{const u=l.name==="hidden"?"hidden":"active";o(u,l.startTime)}),o(Bo(),at());const{stop:s}=Lt(e,window,["pageshow","focus","blur","visibilitychange","resume","freeze","pagehide"],c=>{o(bp(c),c.timeStamp)},{capture:!0});function o(c,l=at()){c!==r&&(r=c,i.closeActive(l),i.add({state:r,startTime:l},l))}function a(c,l,u){return i.findAll(l,u).some(d=>d.state===c)}return t.register(0,({startTime:c,duration:l=0,eventType:u})=>{if(u===C.VIEW){const d=i.findAll(c,l);return{type:u,_dd:{page_states:vp(d,c,n)}}}return u===C.ACTION||u===C.ERROR?{type:u,view:{in_foreground:a("active",c,0)}}:ct}),{wasInPageStateDuringPeriod:a,addPageState:o,stop:()=>{s(),i.stop()}}}function vp(t,e,n){if(t.length!==0)return t.slice(-n).reverse().map(({state:i,startTime:r})=>({state:i,start:k(B(e,r))}))}function bp(t){return t.type==="freeze"?"frozen":t.type==="pagehide"?t.persisted?"frozen":"terminated":Bo()}function Bo(){return document.visibilityState==="hidden"?"hidden":document.hasFocus()?"active":"passive"}function yp(t,e){let n;const i=requestAnimationFrame(I(()=>{n=Ui()})),r=Rf(e).subscribe(s=>{n=s}).unsubscribe;return t.register(0,({eventType:s})=>({type:s,display:n?{viewport:n}:void 0})),{stop:()=>{r(),i&&cancelAnimationFrame(i)}}}function _p(t,e){const n=window.cookieStore?Sp(t):Ep;return new R(i=>n(e,r=>i.notify(r)))}function Sp(t){return(e,n)=>U(t,window.cookieStore,"change",r=>{const s=r.changed.find(o=>o.name===e)||r.deleted.find(o=>o.name===e);s&&n(s.value)}).stop}const wp=K;function Ep(t,e){const n=je(document.cookie,t),i=ve(()=>{const r=je(document.cookie,t);r!==n&&e(r)},wp);return()=>{En(i)}}const zr="datadog-ci-visibility-test-execution-id";function Tp(t,e,n=_p(t,zr)){var i;let r=At(zr)||((i=window.Cypress)===null||i===void 0?void 0:i.env("traceId"));const s=n.subscribe(o=>{r=o});return e.register(0,({eventType:o})=>typeof r!="string"?ct:{type:o,session:{type:"ci_test"},ci_test:{test_execution_id:r}}),{stop:()=>{s.unsubscribe()}}}function Ip(t,e){const n=_t(e,{type:L.LONG_ANIMATION_FRAME,buffered:!0}).subscribe(i=>{for(const r of i){const s=wn(r.startTime),o={date:s.timeStamp,long_task:{id:X(),entry_type:Qs.LONG_ANIMATION_FRAME,duration:k(r.duration),blocking_duration:k(r.blockingDuration),first_ui_event_timestamp:k(r.firstUIEventTimestamp),render_start:k(r.renderStart),style_and_layout_start:k(r.styleAndLayoutStart),start_time:k(r.startTime),scripts:r.scripts.map(a=>({duration:k(a.duration),pause_duration:k(a.pauseDuration),forced_style_and_layout_duration:k(a.forcedStyleAndLayoutDuration),start_time:k(a.startTime),execution_start:k(a.executionStart),source_url:a.sourceURL,source_function_name:a.sourceFunctionName,source_char_position:a.sourceCharPosition,invoker:a.invoker,invoker_type:a.invokerType,window_attribution:a.windowAttribution}))},type:C.LONG_TASK,_dd:{discarded:!1}};t.notify(12,{rawRumEvent:o,startTime:s.relative,duration:r.duration,domainContext:{performanceEntry:r}})}});return{stop:()=>n.unsubscribe()}}function kp(t,e){const n=_t(e,{type:L.LONG_TASK,buffered:!0}).subscribe(i=>{for(const r of i){if(r.entryType!==L.LONG_TASK||!e.trackLongTasks)break;const s=wn(r.startTime),o={date:s.timeStamp,long_task:{id:X(),entry_type:Qs.LONG_TASK,duration:k(r.duration)},type:C.LONG_TASK,_dd:{discarded:!1}};t.notify(12,{rawRumEvent:o,startTime:s.relative,duration:r.duration,domainContext:{performanceEntry:r}})}});return{stop(){n.unsubscribe()}}}function Cp(t){t.register(0,({eventType:e})=>{if(!Ks())return ct;const n=js(),i=Hs();return{type:e,session:{type:"synthetics"},synthetics:{test_id:n,result_id:i,injected:Ws()}}})}function xp(t,e,n){const i=Ti(t),r=n(i);return _i(e).forEach(([s,o])=>gi(t,i,s.split(/\.|(?=\[\])/),o)),r}function gi(t,e,n,i){const[r,...s]=n;if(r==="[]"){Array.isArray(t)&&Array.isArray(e)&&t.forEach((o,a)=>gi(o,e[a],s,i));return}if(!(!Gr(t)||!Gr(e))){if(s.length>0)return gi(t[r],e[r],s,i);Ap(t,r,e[r],i)}}function Ap(t,e,n,i){const r=Wt(n);r===i?t[e]=F(n):i==="object"&&(r==="undefined"||r==="null")&&(t[e]={})}function Gr(t){return Wt(t)==="object"}const ee={"view.name":"string","view.url":"string","view.referrer":"string"},ne={context:"object"},ie={service:"string",version:"string"};let Fo;function Rp(t,e,n,i){Fo={[C.VIEW]:{"view.performance.lcp.resource_url":"string",...ne,...ee,...ie},[C.ERROR]:{"error.message":"string","error.stack":"string","error.resource.url":"string","error.fingerprint":"string",...ne,...ee,...ie},[C.RESOURCE]:{"resource.url":"string",...kn($t.WRITABLE_RESOURCE_GRAPHQL)?{"resource.graphql":"object"}:{},...ne,...ee,...ie},[C.ACTION]:{"action.target.name":"string",...ne,...ee,...ie},[C.LONG_TASK]:{"long_task.scripts[].source_url":"string","long_task.scripts[].invoker":"string",...ne,...ee,...ie},[C.VITAL]:{...ne,...ee,...ie}};const r={[C.ERROR]:jn(C.ERROR,t.eventRateLimiterThreshold,i),[C.ACTION]:jn(C.ACTION,t.eventRateLimiterThreshold,i),[C.VITAL]:jn(C.VITAL,t.eventRateLimiterThreshold,i)};e.subscribe(12,({startTime:s,duration:o,rawRumEvent:a,domainContext:c})=>{const l=n.triggerHook(0,{eventType:a.type,startTime:s,duration:o});if(l===Ot)return;const u=It(l,a,{ddtags:Dl(t).join(",")});Lp(u,t.beforeSend,c,r)&&(zt(u.context)&&delete u.context,e.notify(13,u))})}function Lp(t,e,n,i){var r;if(e){const o=xp(t,Fo[t.type],a=>e(a,n));if(o===!1&&t.type!==C.VIEW)return!1;o===!1&&x.warn("Can't dismiss view events using beforeSend!")}return!((r=i[t.type])===null||r===void 0?void 0:r.isLimitReached())}function Op(t,e,n,i){t.register(0,({eventType:r,startTime:s})=>{const o=e.findTrackedSession(s),a=i.findView(s);if(!o||!a)return Ot;let c,l,u;return r===C.VIEW?(c=n.getReplayStats(a.id)?!0:void 0,l=o.sessionReplay===1,u=a.sessionIsActive?void 0:!1):c=n.isRecording()?!0:void 0,{type:r,session:{id:o.id,type:"user",has_replay:c,sampled_for_replay:l,is_active:u}}}),t.register(1,({startTime:r})=>{const s=e.findTrackedSession(r);return s?{session:{id:s.id}}:ct})}function Dp(t){t.register(0,({eventType:e})=>({type:e,connectivity:Is()}))}function Np(t,e,n){t.register(0,({eventType:i})=>({type:i,_dd:{format_version:2,drift:xa(),configuration:{session_sample_rate:Ve(e.sessionSampleRate,3),session_replay_sample_rate:Ve(e.sessionReplaySampleRate,3),profiling_sample_rate:Ve(e.profilingSampleRate,3)},browser_sdk_version:me()?"6.18.1":void 0,sdk_name:n},application:{id:e.applicationId},date:z(),source:"browser"})),t.register(1,()=>({application:{id:e.applicationId}}))}function Mp(t,e){t.register(1,()=>e.isGranted()?ct:Ot)}const Pp=Yc,Up=[C.ACTION,C.ERROR,C.LONG_TASK,C.RESOURCE,C.VITAL];function Bp(t){return{addEvent:(e,n,i,r)=>{Up.includes(n.type)&&t.notify(12,{startTime:e,rawRumEvent:n,domainContext:i,duration:r})}}}const Fp="Initial view metrics";function Vp(t,e,n){if(!(n.enabled&&Tt(t.initialViewMetricsTelemetrySampleRate)))return{stop:N};const{unsubscribe:r}=e.subscribe(4,({initialViewMetrics:s})=>{!s.largestContentfulPaint||!s.navigationTimings||(ki(Fp,{metrics:$p(s.largestContentfulPaint,s.navigationTimings)}),r())});return{stop:r}}function $p(t,e){return{lcp:{value:t.value},navigation:{domComplete:e.domComplete,domContentLoaded:e.domContentLoaded,domInteractive:e.domInteractive,firstByte:e.firstByte,loadEvent:e.loadEvent}}}function zp(t,e,n,i,r,s,o,a,c){const l=[],u=new gd,d=Pp();u.subscribe(13,j=>Ts("rum",j));const h=j=>{u.notify(14,{error:j}),Dt("Error reported to customer",{"error.message":j.message})},p=Kc(t),f=p.subscribe(j=>{u.notify(11,j)});l.push(()=>f.unsubscribe());const v=Qc("browser-rum-sdk",t,d,h,p,r);l.push(v.stop);const S=me()?Jf():Zf(t,u,s);if(me())np(u);else{const j=ep(t,u,h,p,S.expireObservable,r);l.push(()=>j.stop()),dp(t,v,u,j.flushController.flushObservable)}const E=hd(),T=sp(t,location),{observable:g,stop:b}=pd();l.push(b),Np(d,t,c);const w=gp(d,t),m=bd(u);l.push(()=>m.stop());const y=rp(u,d,T,location);l.push(()=>y.stop());const _=lp(u,d,t);Op(d,S,e,m),Dp(d),Mp(d,s);const D=Du(d,t,"rum"),M=Nu(d,t,S,"rum"),W=Ou(d,t,"rum"),{actionContexts:nt,addAction:it,addEvent:pt,stop:mt}=Gp(u,d,t,w,E,g,h);l.push(mt);const{addTiming:Ht,startView:Nt,setViewName:Ct,setViewContext:rt,setViewContextProperty:lt,getViewContext:Y,stop:Z}=Hf(u,d,t,location,E,g,T,e,m,i);l.push(Z);const{stop:P}=Vp(t,u,v);l.push(P);const{stop:St}=Hh(u,t,w);if(l.push(St),t.trackLongTasks)if(jt(L.LONG_ANIMATION_FRAME)){const{stop:j}=Ip(u,t);l.push(j)}else kp(u,t);const{addError:we}=Dh(u,t,a);a.unbuffer(),Rd(u,t,S,M,W);const xt=Vu(u,w,o),Kt=md(t.applicationId,S,m,nt,y);return l.push(()=>n.stop()),{addAction:it,addEvent:pt,addError:we,addTiming:Ht,addFeatureFlagEvaluation:_.addFeatureFlagEvaluation,startView:Nt,setViewContext:rt,setViewContextProperty:lt,getViewContext:Y,setViewName:Ct,lifeCycle:u,viewHistory:m,session:S,stopSession:()=>S.expire(),getInternalContext:Kt.get,startDurationVital:xt.startDurationVital,stopDurationVital:xt.stopDurationVital,addDurationVital:xt.addDurationVital,globalContext:D,userContext:M,accountContext:W,telemetry:v,stop:()=>{l.forEach(j=>j())},hooks:d}}function Gp(t,e,n,i,r,s,o){const a=Rh(t,e,r,s,n),c=Bp(t),l=yp(e,n),u=Tp(n,e);return Cp(e),Rp(n,t,e,o),{pageStateHistory:i,addAction:a.addAction,addEvent:c.addEvent,actionContexts:a.actionContexts,stop:()=>{a.stop(),u.stop(),l.stop(),i.stop()}}}function qp(t,{session:e,viewContext:n,errorType:i}){const r=e?e.id:"no-session-id",s=[];i!==void 0&&s.push(`error-type=${i}`),n&&(s.push(`seed=${n.id}`),s.push(`from=${n.startClocks.timeStamp}`));const o=Wp(t),a=`/rum/replay/sessions/${r}`;return`${o}${a}?${s.join("&")}`}function Wp(t){const e=t.site,n=t.subdomain||jp(t);return`https://${n?`${n}.`:""}${e}`}function jp(t){switch(t.site){case Ft:case Rc:return"app";case Es:return"dd";default:return}}const Hp=1e3;let ut;function qm(t){return Ln(t).segments_count}function Wm(t){Ln(t).segments_count+=1}function jm(t){Ln(t).records_count+=1}function Hm(t,e){Ln(t).segments_total_raw_size+=e}function Kp(t){return ut?.get(t)}function Ln(t){ut||(ut=new Map);let e;return ut.has(t)?e=ut.get(t):(e={records_count:0,segments_count:0,segments_total_raw_size:0},ut.set(t,e),ut.size>Hp&&Xp()),e}function Xp(){if(!ut)return;const t=ut.keys().next().value;t&&ut.delete(t)}function Vo(t,e,n){let i=0,r=[],s,o=0;const a=[],{stop:c}=U(t,e,"message",({data:d})=>{if(d.type!=="wrote"||d.streamId!==n)return;i+=d.additionalBytesCount,r.push(d.result),s=d.trailer;const h=a.shift();h&&h.id===d.id?h.writeCallback?h.writeCallback(d.result.byteLength):h.finishCallback&&h.finishCallback():(c(),Dt("Worker responses received out of order."))});function l(){const d=r.length===0?new Uint8Array(0):Oa(r.concat(s)),h={rawBytesCount:i,output:d,outputBytesCount:d.byteLength,encoding:"deflate"};return i=0,r=[],h}function u(){o>0&&(e.postMessage({action:"reset",streamId:n}),o=0)}return{isAsync:!0,get isEmpty(){return o===0},write(d,h){e.postMessage({action:"write",id:o,data:d,streamId:n}),a.push({id:o,writeCallback:h,data:d}),o+=1},finish(d){u(),a.length?(a.forEach(h=>{delete h.writeCallback}),a[a.length-1].finishCallback=()=>d(l())):d(l())},finishSync(){u();const d=a.map(h=>(delete h.writeCallback,delete h.finishCallback,h.data)).join("");return{...l(),pendingData:d}},estimateEncodedBytesCount(d){return d.length/8},stop(){c()}}}function Bi({configuredUrl:t,error:e,source:n,scriptType:i}){if(x.error(`${n} failed to start: an error occurred while initializing the ${i}:`,e),e instanceof Event||e instanceof Error&&Yp(e.message)){let r;t?r=`Please make sure the ${i} URL ${t} is correct and CSP is correctly configured.`:r="Please make sure CSP is correctly configured.",x.error(`${r} See documentation at ${Sn}/integrations/content_security_policy_logs/#use-csp-with-real-user-monitoring-and-session-replay`)}else i==="worker"&&Ii(e)}function Yp(t){return t.includes("Content Security Policy")||t.includes("requires 'TrustedScriptURL'")}const Zp=30*K;function $o(t){return new Worker(t.workerUrl||URL.createObjectURL(new Blob(['(()=>{function t(t){const e=t.reduce((t,e)=>t+e.length,0),a=new Uint8Array(e);let n=0;for(const e of t)a.set(e,n),n+=e.length;return a}function e(t){for(var e=t.length;--e>=0;)t[e]=0}var a=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),i=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=Array(576);e(s);var h=Array(60);e(h);var l=Array(512);e(l);var _=Array(256);e(_);var o=Array(29);e(o);var d,u,f,c=Array(30);function p(t,e,a,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function g(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}e(c);var v=function(t){return t<256?l[t]:l[256+(t>>>7)]},w=function(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},m=function(t,e,a){t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,w(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},b=function(t,e,a){m(t,a[2*e],a[2*e+1])},y=function(t,e){var a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},z=function(t,e,a){var n,r,i=Array(16),s=0;for(n=1;n<=15;n++)i[n]=s=s+a[n-1]<<1;for(r=0;r<=e;r++){var h=t[2*r+1];0!==h&&(t[2*r]=y(i[h]++,h))}},k=function(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},x=function(t){t.bi_valid>8?w(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},A=function(t,e,a,n){var r=2*e,i=2*a;return t[r]<t[i]||t[r]===t[i]&&n[e]<=n[a]},U=function(t,e,a){for(var n=t.heap[a],r=a<<1;r<=t.heap_len&&(r<t.heap_len&&A(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!A(e,n,t.heap[r],t.depth));)t.heap[a]=t.heap[r],a=r,r<<=1;t.heap[a]=n},B=function(t,e,r){var i,s,h,l,d=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],s=t.pending_buf[t.l_buf+d],d++,0===i?b(t,s,e):(h=_[s],b(t,h+256+1,e),0!==(l=a[h])&&(s-=o[h],m(t,s,l)),i--,h=v(i),b(t,h,r),0!==(l=n[h])&&(i-=c[h],m(t,i,l)))}while(d<t.last_lit);b(t,256,e)},I=function(t,e){var a,n,r,i=e.dyn_tree,s=e.stat_desc.static_tree,h=e.stat_desc.has_stree,l=e.stat_desc.elems,_=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<l;a++)0!==i[2*a]?(t.heap[++t.heap_len]=_=a,t.depth[a]=0):i[2*a+1]=0;for(;t.heap_len<2;)i[2*(r=t.heap[++t.heap_len]=_<2?++_:0)]=1,t.depth[r]=0,t.opt_len--,h&&(t.static_len-=s[2*r+1]);for(e.max_code=_,a=t.heap_len>>1;a>=1;a--)U(t,i,a);r=l;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],U(t,i,1),n=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=n,i[2*r]=i[2*a]+i[2*n],t.depth[r]=(t.depth[a]>=t.depth[n]?t.depth[a]:t.depth[n])+1,i[2*a+1]=i[2*n+1]=r,t.heap[1]=r++,U(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var a,n,r,i,s,h,l=e.dyn_tree,_=e.max_code,o=e.stat_desc.static_tree,d=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,c=e.stat_desc.max_length,p=0;for(i=0;i<=15;i++)t.bl_count[i]=0;for(l[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<573;a++)(i=l[2*l[2*(n=t.heap[a])+1]+1]+1)>c&&(i=c,p++),l[2*n+1]=i,n>_||(t.bl_count[i]++,s=0,n>=f&&(s=u[n-f]),h=l[2*n],t.opt_len+=h*(i+s),d&&(t.static_len+=h*(o[2*n+1]+s)));if(0!==p){do{for(i=c-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[c]--,p-=2}while(p>0);for(i=c;0!==i;i--)for(n=t.bl_count[i];0!==n;)(r=t.heap[--a])>_||(l[2*r+1]!==i&&(t.opt_len+=(i-l[2*r+1])*l[2*r],l[2*r+1]=i),n--)}}(t,e),z(i,_,t.bl_count)},E=function(t,e,a){var n,r,i=-1,s=e[1],h=0,l=7,_=4;for(0===s&&(l=138,_=3),e[2*(a+1)+1]=65535,n=0;n<=a;n++)r=s,s=e[2*(n+1)+1],++h<l&&r===s||(h<_?t.bl_tree[2*r]+=h:0!==r?(r!==i&&t.bl_tree[2*r]++,t.bl_tree[32]++):h<=10?t.bl_tree[34]++:t.bl_tree[36]++,h=0,i=r,0===s?(l=138,_=3):r===s?(l=6,_=3):(l=7,_=4))},C=function(t,e,a){var n,r,i=-1,s=e[1],h=0,l=7,_=4;for(0===s&&(l=138,_=3),n=0;n<=a;n++)if(r=s,s=e[2*(n+1)+1],!(++h<l&&r===s)){if(h<_)do{b(t,r,t.bl_tree)}while(0!==--h);else 0!==r?(r!==i&&(b(t,r,t.bl_tree),h--),b(t,16,t.bl_tree),m(t,h-3,2)):h<=10?(b(t,17,t.bl_tree),m(t,h-3,3)):(b(t,18,t.bl_tree),m(t,h-11,7));h=0,i=r,0===s?(l=138,_=3):r===s?(l=6,_=3):(l=7,_=4)}},D=!1,M=function(t,e,a,n){m(t,0+(n?1:0),3),function(t,e,a){x(t),w(t,a),w(t,~a),t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a}(t,e,a)},j=M,L=function(t,e,a,n){for(var r=65535&t,i=t>>>16&65535,s=0;0!==a;){a-=s=a>2e3?2e3:a;do{i=i+(r=r+e[n++]|0)|0}while(--s);r%=65521,i%=65521}return r|i<<16},S=new Uint32Array(function(){for(var t,e=[],a=0;a<256;a++){t=a;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}()),T=function(t,e,a,n){var r=S,i=n+a;t^=-1;for(var s=n;s<i;s++)t=t>>>8^r[255&(t^e[s])];return-1^t},O={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},q=j,F=function(t,e,a){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&a,t.last_lit++,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(_[a]+256+1)]++,t.dyn_dtree[2*v(e)]++),t.last_lit===t.lit_bufsize-1},G=-2,H=258,J=262,K=103,N=113,P=666,Q=function(t,e){return t.msg=O[e],e},R=function(t){return(t<<1)-(t>4?9:0)},V=function(t){for(var e=t.length;--e>=0;)t[e]=0},W=function(t,e,a){return(e<<t.hash_shift^a)&t.hash_mask},X=function(t){var e=t.state,a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},Y=function(t,e){(function(t,e,a,n){var r,l,_=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),I(t,t.l_desc),I(t,t.d_desc),_=function(t){var e;for(E(t,t.dyn_ltree,t.l_desc.max_code),E(t,t.dyn_dtree,t.d_desc.max_code),I(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*i[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(l=t.static_len+3+7>>>3)<=r&&(r=l)):r=l=a+5,a+4<=r&&-1!==e?M(t,e,a,n):4===t.strategy||l===r?(m(t,2+(n?1:0),3),B(t,s,h)):(m(t,4+(n?1:0),3),function(t,e,a,n){var r;for(m(t,e-257,5),m(t,a-1,5),m(t,n-4,4),r=0;r<n;r++)m(t,t.bl_tree[2*i[r]+1],3);C(t,t.dyn_ltree,e-1),C(t,t.dyn_dtree,a-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,_+1),B(t,t.dyn_ltree,t.dyn_dtree)),k(t),n&&x(t)})(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,X(t.strm)},Z=function(t,e){t.pending_buf[t.pending++]=e},$=function(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},tt=function(t,e,a,n){var r=t.avail_in;return r>n&&(r=n),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),a),1===t.state.wrap?t.adler=L(t.adler,e,r,a):2===t.state.wrap&&(t.adler=T(t.adler,e,r,a)),t.next_in+=r,t.total_in+=r,r)},et=function(t,e){var a,n,r=t.max_chain_length,i=t.strstart,s=t.prev_length,h=t.nice_match,l=t.strstart>t.w_size-J?t.strstart-(t.w_size-J):0,_=t.window,o=t.w_mask,d=t.prev,u=t.strstart+H,f=_[i+s-1],c=_[i+s];t.prev_length>=t.good_match&&(r>>=2),h>t.lookahead&&(h=t.lookahead);do{if(_[(a=e)+s]===c&&_[a+s-1]===f&&_[a]===_[i]&&_[++a]===_[i+1]){i+=2,a++;do{}while(_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&_[++i]===_[++a]&&i<u);if(n=H-(u-i),i=u-H,n>s){if(t.match_start=e,s=n,n>=h)break;f=_[i+s-1],c=_[i+s]}}}while((e=d[e&o])>l&&0!==--r);return s<=t.lookahead?s:t.lookahead},at=function(t){var e,a,n,r,i,s=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=s+(s-J)){t.window.set(t.window.subarray(s,s+s),0),t.match_start-=s,t.strstart-=s,t.block_start-=s,e=a=t.hash_size;do{n=t.head[--e],t.head[e]=n>=s?n-s:0}while(--a);e=a=s;do{n=t.prev[--e],t.prev[e]=n>=s?n-s:0}while(--a);r+=s}if(0===t.strm.avail_in)break;if(a=tt(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=a,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=W(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=W(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<J&&0!==t.strm.avail_in)},nt=function(t,e){for(var a,n;;){if(t.lookahead<J){if(at(t),t.lookahead<J&&0===e)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=W(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-J&&(t.match_length=et(t,a)),t.match_length>=3)if(n=F(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=W(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=W(t,t.ins_h,t.window[t.strstart+1]);else n=F(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Y(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(Y(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Y(t,!1),0===t.strm.avail_out)?1:2},rt=function(t,e){for(var a,n,r;;){if(t.lookahead<J){if(at(t),t.lookahead<J&&0===e)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=W(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-J&&(t.match_length=et(t,a),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=F(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=W(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Y(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=F(t,0,t.window[t.strstart-1]))&&Y(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=F(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(Y(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Y(t,!1),0===t.strm.avail_out)?1:2};function it(t,e,a,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=n,this.func=r}var st=[new it(0,0,0,0,function(t,e){var a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(at(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+a;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,Y(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-J&&(Y(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Y(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Y(t,!1),t.strm.avail_out),1)}),new it(4,4,8,4,nt),new it(4,5,16,8,nt),new it(4,6,32,32,nt),new it(4,4,16,16,rt),new it(8,16,32,32,rt),new it(8,16,128,128,rt),new it(8,32,128,256,rt),new it(32,128,258,1024,rt),new it(32,258,258,4096,rt)];function ht(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}for(var lt=function(t){var e,i=function(t){if(!t||!t.state)return Q(t,G);t.total_in=t.total_out=0,t.data_type=2;var e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:N,t.adler=2===e.wrap?0:1,e.last_flush=0,function(t){D||(function(){var t,e,i,g,v,w=Array(16);for(i=0,g=0;g<28;g++)for(o[g]=i,t=0;t<1<<a[g];t++)_[i++]=g;for(_[i-1]=g,v=0,g=0;g<16;g++)for(c[g]=v,t=0;t<1<<n[g];t++)l[v++]=g;for(v>>=7;g<30;g++)for(c[g]=v<<7,t=0;t<1<<n[g]-7;t++)l[256+v++]=g;for(e=0;e<=15;e++)w[e]=0;for(t=0;t<=143;)s[2*t+1]=8,t++,w[8]++;for(;t<=255;)s[2*t+1]=9,t++,w[9]++;for(;t<=279;)s[2*t+1]=7,t++,w[7]++;for(;t<=287;)s[2*t+1]=8,t++,w[8]++;for(z(s,287,w),t=0;t<30;t++)h[2*t+1]=5,h[2*t]=y(t,5);d=new p(s,a,257,286,15),u=new p(h,n,0,30,15),f=new p([],r,0,19,7)}(),D=!0),t.l_desc=new g(t.dyn_ltree,d),t.d_desc=new g(t.dyn_dtree,u),t.bl_desc=new g(t.bl_tree,f),t.bi_buf=0,t.bi_valid=0,k(t)}(e),0}(t);return 0===i&&((e=t.state).window_size=2*e.w_size,V(e.head),e.max_lazy_match=st[e.level].max_lazy,e.good_match=st[e.level].good_length,e.nice_match=st[e.level].nice_length,e.max_chain_length=st[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),i},_t=function(t,e){var a,n;if(!t||!t.state||e>5||e<0)return t?Q(t,G):G;var r=t.state;if(!t.output||!t.input&&0!==t.avail_in||r.status===P&&4!==e)return Q(t,0===t.avail_out?-5:G);r.strm=t;var i=r.last_flush;if(r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Z(r,31),Z(r,139),Z(r,8),r.gzhead?(Z(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Z(r,255&r.gzhead.time),Z(r,r.gzhead.time>>8&255),Z(r,r.gzhead.time>>16&255),Z(r,r.gzhead.time>>24&255),Z(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Z(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Z(r,255&r.gzhead.extra.length),Z(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=T(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Z(r,0),Z(r,0),Z(r,0),Z(r,0),Z(r,0),Z(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Z(r,3),r.status=N);else{var h=8+(r.w_bits-8<<4)<<8;h|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(h|=32),h+=31-h%31,r.status=N,$(r,h),0!==r.strstart&&($(r,t.adler>>>16),$(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),X(t),a=r.pending,r.pending!==r.pending_buf_size));)Z(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),X(t),a=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Z(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),X(t),a=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Z(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>a&&(t.adler=T(t.adler,r.pending_buf,r.pending-a,a)),0===n&&(r.status=K)}else r.status=K;if(r.status===K&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&X(t),r.pending+2<=r.pending_buf_size&&(Z(r,255&t.adler),Z(r,t.adler>>8&255),t.adler=0,r.status=N)):r.status=N),0!==r.pending){if(X(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&R(e)<=R(i)&&4!==e)return Q(t,-5);if(r.status===P&&0!==t.avail_in)return Q(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==P){var l=2===r.strategy?function(t,e){for(var a;;){if(0===t.lookahead&&(at(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,a=F(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(Y(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Y(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Y(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var a,n,r,i,s=t.window;;){if(t.lookahead<=H){if(at(t),t.lookahead<=H&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=s[r=t.strstart-1])===s[++r]&&n===s[++r]&&n===s[++r]){i=t.strstart+H;do{}while(n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&r<i);t.match_length=H-(i-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=F(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=F(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(Y(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(Y(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Y(t,!1),0===t.strm.avail_out)?1:2}(r,e):st[r.level].func(r,e);if(3!==l&&4!==l||(r.status=P),1===l||3===l)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===l&&(1===e?function(t){m(t,2,3),b(t,256,s),function(t){16===t.bi_valid?(w(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}(r):5!==e&&(q(r,0,0,!1),3===e&&(V(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),X(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(Z(r,255&t.adler),Z(r,t.adler>>8&255),Z(r,t.adler>>16&255),Z(r,t.adler>>24&255),Z(r,255&t.total_in),Z(r,t.total_in>>8&255),Z(r,t.total_in>>16&255),Z(r,t.total_in>>24&255)):($(r,t.adler>>>16),$(r,65535&t.adler)),X(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},ot=function(t){if(!t||!t.state)return G;var e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==K&&e!==N&&e!==P?Q(t,G):(t.state=null,e===N?Q(t,-3):0)},dt=new Uint8Array(256),ut=0;ut<256;ut++)dt[ut]=ut>=252?6:ut>=248?5:ut>=240?4:ut>=224?3:ut>=192?2:1;dt[254]=dt[254]=1;var ft=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ct=Object.prototype.toString;function pt(){this.options={level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0};var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ft,this.strm.avail_out=0;var e,a,n=function(t,e,a,n,r,i){if(!t)return G;var s=1;if(-1===e&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),r<1||r>9||8!==a||n<8||n>15||e<0||e>9||i<0||i>4)return Q(t,G);8===n&&(n=9);var h=new ht;return t.state=h,h.strm=t,h.wrap=s,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=r+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<r+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=i,h.method=a,lt(t)}(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw Error(O[n]);if(t.header&&(e=this.strm,a=t.header,e&&e.state&&(2!==e.state.wrap||(e.state.gzhead=a))),t.dictionary){var r;if(r="[object ArrayBuffer]"===ct.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=function(t,e){var a=e.length;if(!t||!t.state)return G;var n=t.state,r=n.wrap;if(2===r||1===r&&42!==n.status||n.lookahead)return G;if(1===r&&(t.adler=L(t.adler,e,a,0)),n.wrap=0,a>=n.w_size){0===r&&(V(n.head),n.strstart=0,n.block_start=0,n.insert=0);var i=new Uint8Array(n.w_size);i.set(e.subarray(a-n.w_size,a),0),e=i,a=n.w_size}var s=t.avail_in,h=t.next_in,l=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,at(n);n.lookahead>=3;){var _=n.strstart,o=n.lookahead-2;do{n.ins_h=W(n,n.ins_h,n.window[_+3-1]),n.prev[_&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=_,_++}while(--o);n.strstart=_,n.lookahead=2,at(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=h,t.input=l,t.avail_in=s,n.wrap=r,0}(this.strm,r)))throw Error(O[n]);this._dict_set=!0}}function gt(t,e,a){try{t.postMessage({type:"errored",error:e,streamId:a})}catch(n){t.postMessage({type:"errored",error:e+"",streamId:a})}}function vt(t){const e=t.strm.adler;return new Uint8Array([3,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e])}pt.prototype.push=function(t,e){var a,n,r=this.strm,i=this.options.chunkSize;if(this.ended)return!1;for(n=e===~~e?e:!0===e?4:0,"[object ArrayBuffer]"===ct.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(2===n||3===n)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(1===(a=_t(r,n)))return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=ot(this.strm),this.onEnd(a),this.ended=!0,0===a;if(0!==r.avail_out){if(n>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},pt.prototype.onData=function(t){this.chunks.push(t)},pt.prototype.onEnd=function(t){0===t&&(this.result=function(t){for(var e=0,a=0,n=t.length;a<n;a++)e+=t[a].length;for(var r=new Uint8Array(e),i=0,s=0,h=t.length;i<h;i++){var l=t[i];r.set(l,s),s+=l.length}return r}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},function(e=self){try{const a=new Map;e.addEventListener("message",n=>{try{const r=function(e,a){switch(a.action){case"init":return{type:"initialized",version:"6.18.1"};case"write":{let n=e.get(a.streamId);n||(n=new pt,e.set(a.streamId,n));const r=n.chunks.length,i=function(t){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,n,r,i,s=t.length,h=0;for(r=0;r<s;r++)a=t.charCodeAt(r),55296==(64512&a)&&r+1<s&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),r++)),h+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(h),i=0,r=0;i<h;r++)a=t.charCodeAt(r),55296==(64512&a)&&r+1<s&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),r++)),a<128?e[i++]=a:a<2048?(e[i++]=192|a>>>6,e[i++]=128|63&a):a<65536?(e[i++]=224|a>>>12,e[i++]=128|a>>>6&63,e[i++]=128|63&a):(e[i++]=240|a>>>18,e[i++]=128|a>>>12&63,e[i++]=128|a>>>6&63,e[i++]=128|63&a);return e}(a.data);return n.push(i,2),{type:"wrote",id:a.id,streamId:a.streamId,result:t(n.chunks.slice(r)),trailer:vt(n),additionalBytesCount:i.length}}case"reset":e.delete(a.streamId)}}(a,n.data);r&&e.postMessage(r)}catch(t){gt(e,t,n.data&&"streamId"in n.data?n.data.streamId:void 0)}})}catch(t){gt(e,t)}}()})();'])))}let V={status:0};function zo(t,e,n,i=$o){switch(V.status===0&&Jp(t,e,i),V.status){case 1:return V.initializationFailureCallbacks.push(n),V.worker;case 3:return V.worker}}function qr(){return V.status}function Jp(t,e,n=$o){try{const i=n(t),{stop:r}=U(t,i,"error",a=>{ri(t,e,a)}),{stop:s}=U(t,i,"message",({data:a})=>{a.type==="errored"?ri(t,e,a.error,a.streamId):a.type==="initialized"&&tm(a.version)});i.postMessage({action:"init"}),H(()=>Qp(e),Zp),V={status:1,worker:i,stop:()=>{r(),s()},initializationFailureCallbacks:[]}}catch(i){ri(t,e,i)}}function Qp(t){V.status===1&&(x.error(`${t} failed to start: a timeout occurred while initializing the Worker`),V.initializationFailureCallbacks.forEach(e=>e()),V={status:2})}function tm(t){V.status===1&&(V={status:3,worker:V.worker,stop:V.stop,version:t})}function ri(t,e,n,i){V.status===1||V.status===0?(Bi({configuredUrl:t.workerUrl,error:n,source:e,scriptType:"worker"}),V.status===1&&V.initializationFailureCallbacks.forEach(r=>r()),V={status:2}):Ii(n,{worker_version:V.status===3&&V.version,stream_id:i})}function Go(){return typeof Array.from=="function"&&typeof CSSSupportsRule=="function"&&typeof URL.createObjectURL=="function"&&"forEach"in NodeList.prototype}function em(t,e,n,i){const r=e.findTrackedSession(),s=nm(r,i),o=n.findView();return qp(t,{viewContext:o,errorType:s,session:r})}function nm(t,e){if(!Go())return"browser-not-supported";if(!t)return"rum-not-tracked";if(t.sessionReplay===0)return"incorrect-session-plan";if(!e)return"replay-not-started"}const im="Recorder init metrics";function rm(t,e,n){if(!(e.enabled&&Tt(t.replayTelemetrySampleRate)))return{stop:N};let r,s,o;const{unsubscribe:a}=n.subscribe(c=>{switch(c.type){case"start":r={forced:c.forced,timestamp:z()},s=void 0,o=void 0;break;case"document-ready":r&&(s=B(r.timestamp,z()));break;case"recorder-settled":r&&(o=B(r.timestamp,z()));break;case"aborted":case"deflate-encoder-load-failed":case"recorder-load-failed":case"succeeded":a(),r&&ki(im,{metrics:sm(r.forced,o,B(r.timestamp,z()),c.type,s)});break}});return{stop:a}}function sm(t,e,n,i,r){return{forced:t,loadRecorderModuleDuration:e,recorderInitDuration:n,result:i,waitForDocReadyDuration:r}}function om(t,e,n,i,r,s,o){let a=0,c;e.subscribe(9,()=>{(a===2||a===3)&&(h(),a=1)}),e.subscribe(10,()=>{a===1&&d()});const l=new R;rm(t,o,l);const u=async p=>{l.notify({type:"start",forced:p});const[f]=await Promise.all([Wr(l,{type:"recorder-settled"},r()),Wr(l,{type:"document-ready"},au(t,"interactive"))]);if(a!==2){l.notify({type:"aborted"});return}if(!f){a=0,l.notify({type:"recorder-load-failed"});return}const v=s();if(!v){a=0,l.notify({type:"deflate-encoder-load-failed"});return}({stop:c}=f(e,t,n,i,v,o)),a=3,l.notify({type:"succeeded"})};function d(p){const f=n.findTrackedSession();if(am(f,p)){a=1;return}if(cm(a))return;a=2;const v=lm(f,p)||!1;u(v).catch(he),v&&n.setForcedReplay()}function h(){a===3&&c?.(),a=0}return{start:d,stop:h,getSessionReplayLink(){return em(t,n,i,a!==0)},isRecording:()=>a===3}}function am(t,e){return!t||t.sessionReplay===0&&(!e||!e.force)}function cm(t){return t===2||t===3}function lm(t,e){return e&&e.force&&t.sessionReplay===0}async function Wr(t,e,n){try{return await n}finally{t.notify(e)}}function um(){let t=0;return{strategy:{start(){t=1},stop(){t=2},isRecording:()=>!1,getSessionReplayLink:N},shouldStartImmediately(e){return t===1||t===0&&!e.startSessionReplayRecordingManually}}}function dm(t,e){if(me()&&!Ns("records")||!Go())return{start:N,stop:N,getReplayStats:()=>{},onRumStart:N,isRecording:()=>!1,getSessionReplayLink:()=>{}};let{strategy:n,shouldStartImmediately:i}=um();return{start:s=>n.start(s),stop:()=>n.stop(),getSessionReplayLink:()=>n.getSessionReplayLink(),onRumStart:r,isRecording:()=>qr()===3&&n.isRecording(),getReplayStats:s=>qr()===3?Kp(s):void 0};function r(s,o,a,c,l,u){let d;function h(){return d||(l??(l=zo(o,"Datadog Session Replay",()=>{n.stop()},e)),l&&(d=Vo(o,l,1))),d}n=om(o,s,a,c,t,h,u),i(o)&&n.start()}}const hm="modulepreload",fm=function(t){return"/practice/"+t},jr={},qo=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");r=c(n.map(l=>{if(l=fm(l),l in jr)return;jr[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":hm,u||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};async function pm(t=mm){try{return await t()}catch(e){Bi({error:e,source:"Recorder",scriptType:"module"})}}async function mm(){return(await qo(()=>import("./startRecording-BSApxsfU.js"),[])).startRecording}function gm(){return ft().Profiler!==void 0}const vm=t=>{let e={status:"starting"};return t.register(0,({eventType:n})=>n!==C.VIEW&&n!==C.LONG_TASK?ct:{type:n,_dd:{profiling:e}}),{get:()=>e,set:n=>{e=n}}};async function bm(t=ym){try{return await t()}catch(e){Bi({error:e,source:"Profiler",scriptType:"module"})}}async function ym(){return(await qo(()=>import("./profiler-BvYfIdCp.js"),[])).createRumProfiler}function _m(){let t;function e(n,i,r,s,o){const a=s.findTrackedSession();if(!a||!ro(a.id,r.profilingSampleRate))return;const c=vm(i);if(!gm()){c.set({status:"error",error_reason:"not-supported-by-browser"});return}bm().then(l=>{if(!l){Dt("[DD_RUM] Failed to lazy load the RUM Profiler"),c.set({status:"error",error_reason:"failed-to-lazy-load"});return}t=l(r,n,s,c),t.start(o.findView())}).catch(he)}return{onRumStart:e,stop:()=>{t?.stop().catch(he)}}}const Sm=dm(pm),wm=_m(),rn=ud(zp,Sm,wm,{startDeflateWorker:zo,createDeflateEncoder:Vo,sdkName:"rum"});$l(ft(),"DD_RUM",rn);function Em(){console.log("practice-recorder v2.139.0"),rn.init({applicationId:"cf5b1a0f-eb93-4fa2-a37f-6a5f3b2f9a76",clientToken:"pub43c914b5be206019b947216e1f4b9d3c",site:"datadoghq.com",service:"practice-recorder",env:"prod",version:"v2.139.0",sessionSampleRate:100,sessionReplaySampleRate:20,defaultPrivacyLevel:"mask-user-input"})}let Fi="";function Tm(t,e,n){Fi=e,rn.setUser({id:e.replace("@","_at_"),name:t,email:e,googleId:n})}function Im(t){t.user=Fi,rn.addAction("Recording",t)}function km(t){t.user=Fi,rn.addAction("Playback",t)}function Cm(){const t="1060381388264-frcdkvrnei1hv30mnbjdn0u0mm6mlaf2.apps.googleusercontent.com",e=function(r){let o=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(o).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)},n=r=>{const s=e(r.credential);Tm(s.name,s.email,s.sub),document.getElementById("user").innerText=`Welcome ${s.given_name}`},i=()=>{if(typeof window.google>"u"||!window.google.accounts){console.warn("Google Identity Services library not loaded yet, retrying..."),setTimeout(i,100);return}window.google.accounts.id.initialize({client_id:t,callback:n,auto_select:!0,itp_support:!0,use_fedcm_for_prompt:!1,context:"signin"}),window.google.accounts.id.prompt()};i()}var si,Hr;function xm(){if(Hr)return si;Hr=1,si=t;function t(o,a){a=a||{};var c=o.numberOfChannels,l=o.sampleRate,u=a.float32?3:1,d=u===3?32:16,h;return c===2?h=n(o.getChannelData(0),o.getChannelData(1)):h=o.getChannelData(0),e(h,u,l,c,d)}function e(o,a,c,l,u){var d=u/8,h=l*d,p=new ArrayBuffer(44+o.length*d),f=new DataView(p);return s(f,0,"RIFF"),f.setUint32(4,36+o.length*d,!0),s(f,8,"WAVE"),s(f,12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,a,!0),f.setUint16(22,l,!0),f.setUint32(24,c,!0),f.setUint32(28,c*h,!0),f.setUint16(32,h,!0),f.setUint16(34,u,!0),s(f,36,"data"),f.setUint32(40,o.length*d,!0),a===1?r(f,44,o):i(f,44,o),p}function n(o,a){for(var c=o.length+a.length,l=new Float32Array(c),u=0,d=0;u<c;)l[u++]=o[d],l[u++]=a[d],d++;return l}function i(o,a,c){for(var l=0;l<c.length;l++,a+=4)o.setFloat32(a,c[l],!0)}function r(o,a,c){for(var l=0;l<c.length;l++,a+=2){var u=Math.max(-1,Math.min(1,c[l]));o.setInt16(a,u<0?u*32768:u*32767,!0)}}function s(o,a,c){for(var l=0;l<c.length;l++)o.setUint8(a+l,c.charCodeAt(l))}return si}var Am=xm();const Rm=Yo(Am);class Lm{constructor(e,n,i,r){this.recordingPrelay=100,this.recordClicks=e,this.playClicks=n,this.recordSpeed=i;const{startRecordingDelay:s,stopRecordingDelay:o,stopDelay:a}=this.getRecordDelays();this.startRecordingDelay=s/this.recordSpeed,this.stopRecordingDelay=o/this.recordSpeed+this.recordingPrelay*4,this.stopDelay=a/this.recordSpeed+this.recordingPrelay*2,this.latency=r}getRecordDelays(){let e=0,n=0,i=0,r=!1,s=!1;for(const o of this.recordClicks)r=r||o.recording,s=r&&!o.recording,i+=o.delay,s||(n+=o.delay),!o.recording&&!r&&(e+=o.delay);return{startRecordingDelay:e,stopRecordingDelay:n,stopDelay:i}}}class Om{constructor(e,n){this.latency=0,this.audioBuffer=n,this.playClicks=e.playClicks,this.recordSpeed=e.recordSpeed,this.latency=e.latency}download(){const e=Rm(this.audioBuffer),n=new Blob([e],{type:"audio/wav"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=`recording-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.wav`,r.click(),setTimeout(()=>{URL.revokeObjectURL(i)},1e3)}}class Wo{constructor(e,n){this.clickHz=1e3,this.offbeatHz=750,this.clickSounds={1:{hz:1e3,vol:2},2:{hz:900,vol:2},3:{hz:800,vol:1},4:{hz:700,vol:1},0:{hz:0,vol:0}},this.oscillatorType="square",this.flashBox=document.getElementById("click-flash-box"),this.isPlaying=!1,this.nextClickTime=0,this.clickIter=null,this.playbackRate=1,this.scheduleLookahead=25,this.scheduleInterval=25,this.clickSilencing=()=>0,this.flash=()=>!1,this.scheduler=()=>{if(this.clickIter){for(;this.nextClickTime<this.audioContext.currentTime+this.scheduleLookahead/1e3;){const{value:i,done:r}=this.clickIter.next();if(r)return;this.createClickSound(this.nextClickTime,i),this.nextClickTime+=i.delay/this.playbackRate/1e3}this.isPlaying&&setTimeout(this.scheduler,this.scheduleInterval)}},this.audioContext=n,this.enabled=Xe(`${e}-metronome-enabled`,{initial:!0})}createClickSound(e,n){if(this.flash()){const o=e-this.audioContext.currentTime;setTimeout(()=>this.flashBox.hidden=!1,o),setTimeout(()=>this.flashBox.hidden=!0,o+50)}if(n.recording&&Math.random()*100<this.clickSilencing())return;const i=this.clickSounds[n.level];if(i.vol===0)return;const r=this.audioContext.createOscillator(),s=this.audioContext.createGain();r.type=this.oscillatorType,r.frequency.setValueAtTime(i.hz,e),s.gain.setValueAtTime(0,e),s.gain.linearRampToValueAtTime(i.vol,e+.001),s.gain.exponentialRampToValueAtTime(.001,e+.05),r.connect(s),s.connect(this.audioContext.destination),r.start(e),r.stop(e+.05)}_start(e,n,i){this.enabled()&&(this.isPlaying&&this.stop(),this.nextClickTime=e,this.clickIter=n[Symbol.iterator](),this.playbackRate=i,this.isPlaying=!0,this.scheduler())}stop(){this.isPlaying=!1}}class Dm extends Wo{constructor(e){super("rec",e),this.flash=Xe("rec-click-flash",{initial:!1}),this.clickSilencing=Kr("rec-silencing",{initial:0,min:0,max:100,step:1,valueSuffix:"%",label:"Random Click Silencing"})}start(e,n){super._start(e+n.recordingPrelay/1e3,n.recordClicks,n.recordSpeed)}}class Nm extends Wo{constructor(e){super("play",e)}start(e,n,i){const r=e+n.latency/i/1e3;super._start(r,n.playClicks.filter(s=>s.recording),i*n.recordSpeed)}}window.location.hostname==="purple4reina.github.io"&&(Em(),Cm());class Mm{constructor(){this.audioContext=new AudioContext,this.recorder=new la(this.audioContext),this.player=new ca(this.audioContext),this.blockManager=new sa,this.recordingMetronome=new Dm(this.audioContext),this.playbackMetronome=new Nm(this.audioContext),this.visualizer=new wa(this.audioContext),this.latencyCompensator=new aa,this.tapper=new da,this.drone=new oa(this.audioContext),this.startRecordingTimeout=0,this.stopRecordingTimeout=0,this.stopTimeout=0,this.clip=null,this.recordSpeed=Kr("rec-speed",{initial:100,min:0,max:100,step:1,valueSuffix:"%",label:"Recording Speed"}),this.playbackSpeed=ta("playback",{initNum:1,initDen:4,arrowKeys:!0}),this.playRecordControls=new Xo,this.autoPlay=Xe("auto-play",{initial:!0}),this.playRecordControls.initializeEventListeners({record:this.record.bind(this),stopRecording:this.stopRecording.bind(this),play:this.play.bind(this),stopPlaying:this.stopPlaying.bind(this)}),this.recorder.initialize().catch(e=>{console.error("Failed to initialize recorder:",e)}),this.clipSettings=this.getClipSettings(),document.getElementById("download")?.addEventListener("click",()=>{this.clip?this.clip.download():console.error("No clip available for download")})}getClipSettings(){return new Lm(this.blockManager.recordClicks(),this.blockManager.playClicks(),this.recordSpeed()/100,this.latencyCompensator.getLatency())}async record(){this.audioContext.state==="suspended"&&await this.audioContext.resume(),await this.recorder.reset(),this.stopMetronomes(),this.visualizer.clear(),await oi(100),this.clipSettings=this.getClipSettings(),this.recordingMetronome.enabled()&&this.recordingMetronome.start(this.audioContext.currentTime,this.clipSettings),this.startRecordingTimeout=setTimeout(()=>this.recorder.start(),this.clipSettings.startRecordingDelay),this.stopRecordingTimeout=setTimeout(()=>this.recorder.stop(),this.clipSettings.stopRecordingDelay),this.stopTimeout=setTimeout(()=>this.stopRecording(),this.clipSettings.stopDelay),this.playRecordControls.markRecording()}stopRecording(){clearTimeout(this.startRecordingTimeout),clearTimeout(this.stopRecordingTimeout),clearTimeout(this.stopTimeout),this.recorder.stop(),this.stopMetronomes(),this.playRecordControls.markStopped();const e=this.recorder.getAudioBuffer();e&&(this.clip=new Om(this.clipSettings,e),Im({duration:this.clip.audioBuffer.duration})),this.clip&&this.visualizer.drawVisualization(this.clip),e&&this.autoPlay()&&setTimeout(()=>this.play(),500)}play(){if(!this.clip?.audioBuffer){console.error("No audio buffer available for playback"),this.playRecordControls.reset();return}this.stopMetronomes();const e=this.playbackSpeed(),n=this.player.play(this.clip.audioBuffer,e,()=>{this.stopPlaying()});this.playbackMetronome.enabled()&&this.playbackMetronome.start(n,this.clip,e),this.visualizer.startPlayback(e),km({duration:this.clip.audioBuffer.duration,playbackSpeed:e}),this.playRecordControls.markPlaying()}stopPlaying(){this.player.stop(),this.stopMetronomes(),this.visualizer.stopPlayback(),this.playRecordControls.markStopped()}stopMetronomes(){this.recordingMetronome.stop(),this.playbackMetronome.stop()}}window.addEventListener("load",()=>{new Mm,new ua});export{jt as $,Ni as A,Um as B,Qn as C,gu as D,fd as E,I as F,Ui as G,Ts as H,jm as I,qm as J,Wm as K,Hm as L,Xc as M,O as N,dt as O,jd as P,H as Q,C as R,oh as S,K as T,Tt as U,ki as V,en as W,Ds as X,me as Y,Dl as Z,xa as _,$m as a,L as a0,q as a1,ft as a2,he as a3,x as a4,Jr as a5,wn as a6,Ri as b,Ad as c,Pm as d,zm as e,_o as f,$d as g,Vm as h,Vd as i,Bm as j,Fm as k,B as l,vo as m,Tn as n,Lt as o,Dt as p,yo as q,Yd as r,So as s,z as t,Af as u,Gm as v,U as w,Rf as x,N as y,yt as z};
